<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>simba.video_processors.video_processing &mdash; SimBA 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/simba_theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />

  
    <link rel="shortcut icon" href="../../../_static/readthedocs_logo.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            SimBA
              <img src="../../../_static/readthedocs_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">API REFERENCE:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">NOTEBOOKS:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks.html">Notebooks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">USER GUIDE / TUTORIALS:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">WALKTHROUGHS:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../walkthroughs.html">Walkthroughs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">LABELLING TUTORIALS:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../labelling.html">Labelling</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials_rst/FAQ.html">Friendly Asked Questions (FAQ)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DOCS:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/workflow.html">SimBA basic workflow</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ABOUT:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../credits.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../credits.html#who-writes-this-stuff">Who writes this stuff??</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../links.html">Links</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">SimBA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">simba.video_processors.video_processing</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for simba.video_processors.video_processing</h1><div class="highlight"><pre>
<span></span><span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Simon Nilsson&quot;</span>


<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageTk</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span>

<span class="kn">from</span> <span class="nn">simba.mixins.config_reader</span> <span class="kn">import</span> <span class="n">ConfigReader</span>
<span class="kn">from</span> <span class="nn">simba.mixins.image_mixin</span> <span class="kn">import</span> <span class="n">ImageMixin</span>
<span class="kn">from</span> <span class="nn">simba.utils.checks</span> <span class="kn">import</span> <span class="p">(</span><span class="n">check_ffmpeg_available</span><span class="p">,</span>
                                <span class="n">check_file_exist_and_readable</span><span class="p">,</span> <span class="n">check_float</span><span class="p">,</span>
                                <span class="n">check_if_dir_exists</span><span class="p">,</span>
                                <span class="n">check_if_filepath_list_is_empty</span><span class="p">,</span>
                                <span class="n">check_if_string_value_is_valid_video_timestamp</span><span class="p">,</span>
                                <span class="n">check_instance</span><span class="p">,</span> <span class="n">check_int</span><span class="p">,</span>
                                <span class="n">check_nvidea_gpu_available</span><span class="p">,</span> <span class="n">check_str</span><span class="p">,</span>
                                <span class="n">check_that_hhmmss_start_is_before_end</span><span class="p">,</span>
                                <span class="n">check_valid_lst</span><span class="p">,</span> <span class="n">check_valid_tuple</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">simba.utils.data</span> <span class="kn">import</span> <span class="n">find_frame_numbers_from_time_stamp</span>
<span class="kn">from</span> <span class="nn">simba.utils.enums</span> <span class="kn">import</span> <span class="n">OS</span><span class="p">,</span> <span class="n">ConfigKey</span><span class="p">,</span> <span class="n">Formats</span><span class="p">,</span> <span class="n">Options</span><span class="p">,</span> <span class="n">Paths</span>
<span class="kn">from</span> <span class="nn">simba.utils.errors</span> <span class="kn">import</span> <span class="p">(</span><span class="n">CountError</span><span class="p">,</span> <span class="n">DirectoryExistError</span><span class="p">,</span>
                                <span class="n">FFMPEGCodecGPUError</span><span class="p">,</span> <span class="n">FFMPEGNotFoundError</span><span class="p">,</span>
                                <span class="n">FileExistError</span><span class="p">,</span> <span class="n">FrameRangeError</span><span class="p">,</span>
                                <span class="n">InvalidFileTypeError</span><span class="p">,</span> <span class="n">InvalidInputError</span><span class="p">,</span>
                                <span class="n">InvalidVideoFileError</span><span class="p">,</span> <span class="n">NoDataError</span><span class="p">,</span>
                                <span class="n">NoFilesFoundError</span><span class="p">,</span> <span class="n">NotDirectoryError</span><span class="p">,</span>
                                <span class="n">ResolutionError</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">simba.utils.lookups</span> <span class="kn">import</span> <span class="p">(</span><span class="n">get_ffmpeg_crossfade_methods</span><span class="p">,</span> <span class="n">get_fonts</span><span class="p">,</span>
                                 <span class="n">percent_to_crf_lookup</span><span class="p">,</span> <span class="n">percent_to_qv_lk</span><span class="p">,</span>
                                 <span class="n">video_quality_to_preset_lookup</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">simba.utils.printing</span> <span class="kn">import</span> <span class="n">SimbaTimer</span><span class="p">,</span> <span class="n">stdout_success</span>
<span class="kn">from</span> <span class="nn">simba.utils.read_write</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">check_if_hhmmss_timestamp_is_valid_part_of_video</span><span class="p">,</span>
    <span class="n">concatenate_videos_in_folder</span><span class="p">,</span> <span class="n">find_all_videos_in_directory</span><span class="p">,</span> <span class="n">find_core_cnt</span><span class="p">,</span>
    <span class="n">find_files_of_filetypes_in_directory</span><span class="p">,</span> <span class="n">get_fn_ext</span><span class="p">,</span> <span class="n">get_video_meta_data</span><span class="p">,</span>
    <span class="n">read_config_entry</span><span class="p">,</span> <span class="n">read_config_file</span><span class="p">,</span> <span class="n">read_frm_of_video</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">simba.utils.warnings</span> <span class="kn">import</span> <span class="p">(</span><span class="n">FileExistWarning</span><span class="p">,</span> <span class="n">FrameRangeWarning</span><span class="p">,</span>
                                  <span class="n">InValidUserInputWarning</span><span class="p">,</span>
                                  <span class="n">SameInputAndOutputWarning</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">simba.video_processors.extract_frames</span> <span class="kn">import</span> <span class="n">video_to_frames</span>
<span class="kn">from</span> <span class="nn">simba.video_processors.roi_selector</span> <span class="kn">import</span> <span class="n">ROISelector</span>
<span class="kn">from</span> <span class="nn">simba.video_processors.roi_selector_circle</span> <span class="kn">import</span> <span class="n">ROISelectorCircle</span>
<span class="kn">from</span> <span class="nn">simba.video_processors.roi_selector_polygon</span> <span class="kn">import</span> <span class="n">ROISelectorPolygon</span>

<span class="n">MAX_FRM_SIZE</span> <span class="o">=</span> <span class="mi">1080</span><span class="p">,</span> <span class="mi">650</span>

<div class="viewcode-block" id="change_img_format"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.change_img_format">[docs]</a><span class="k">def</span> <span class="nf">change_img_format</span><span class="p">(</span><span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                      <span class="n">file_type_in</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                      <span class="n">file_type_out</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                      <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert the file type of all image files within a directory.</span>

<span class="sd">    :parameter Union[str, os.PathLike] directory: Path to directory holding image files</span>
<span class="sd">    :parameter str file_type_in: Input file type, e.g., &#39;bmp&#39; or &#39;png.</span>
<span class="sd">    :parameter str file_type_out: Output file type, e.g., &#39;bmp&#39; or &#39;png.</span>
<span class="sd">    :parameter Optional[bool] verbose: If True, prints progress. Default False.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = change_img_format(directory=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/two_black_animals_14bp/test_img&#39;, file_type_in=&#39;png&#39;, file_type_out=&#39;bmp&#39;, verbose=True)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">change_img_format</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">files_found</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">directory</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;/*.</span><span class="si">{</span><span class="n">file_type_in</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files_found</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SIMBA ERROR: No </span><span class="si">{</span><span class="n">file_type_in</span><span class="si">}</span><span class="s2"> files (with .</span><span class="si">{</span><span class="n">file_type_in</span><span class="si">}</span><span class="s2"> file extension) found in the </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> directory&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">change_img_format</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files_found</span><span class="p">)</span><span class="si">}</span><span class="s2"> image files found in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files_found</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting file </span><span class="si">{</span><span class="n">file_cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files_found</span><span class="p">)</span><span class="si">}</span><span class="s2"> ...&quot;</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">save_name</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_type_in</span><span class="p">),</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_type_out</span><span class="p">))</span>
        <span class="n">im</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_name</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA COMPLETE: Files in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> directory converted to </span><span class="si">{</span><span class="n">file_type_out</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">change_img_format</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="convert_to_jpeg"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.convert_to_jpeg">[docs]</a><span class="k">def</span> <span class="nf">convert_to_jpeg</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]],</span>
                    <span class="n">quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">95</span><span class="p">,</span>
                    <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert the file type of all image files within a directory to jpeg format of passed quality.</span>

<span class="sd">    .. note::</span>
<span class="sd">       Quality above 95 should be avoided; 100 disables portions of the JPEG compression algorithm, and results in large files with hardly any gain in image quality</span>

<span class="sd">    .. image:: _static/img/convert_to_jpeg.jpeg</span>
<span class="sd">       :width: 600</span>
<span class="sd">       :align: center</span>

<span class="sd">    :parameter Union[str, os.PathLike] directory: Path to directory holding image files, a single image file, or a list of paths to image files.</span>
<span class="sd">    :parameter Optional[int] quality: The quality of the output images (0-100).</span>
<span class="sd">    :param Optional[bool] save_dir: If not None, then the directory where to store converted images. If None, then stores the images in a subdirectory within the first passed image directory.</span>
<span class="sd">    :parameter Optional[bool] verbose: If True, prints progress. Default False.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; convert_to_jpeg(path=&#39;/Users/simon/Desktop/imgs&#39;, verbose=False, quality=15)</span>
<span class="sd">    &gt;&gt;&gt; convert_to_jpeg(path=&#39;/Users/simon/Desktop/my_image.png&#39;, verbose=False, quality=15)</span>
<span class="sd">    &gt;&gt;&gt; convert_to_jpeg(path=[&#39;/Users/simon/Desktop/my_image_1.png&#39;, &#39;/Users/simon/Desktop/my_image_2.png&#39;], verbose=True, quality=40)</span>
<span class="sd">    &gt;&gt;&gt; convert_to_jpeg(path=&#39;/Users/simon/Desktop/imgs&#39;, save_dir=&#39;/Users/simon/Desktop/test_jpg_/test__/HELLO&#39;, verbose=False, quality=15)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">datetime_</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">check_valid_lst</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_jpeg</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> path&#39;</span><span class="p">,</span> <span class="n">valid_dtypes</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,),</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span> <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="n">find_files_of_filetypes_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="n">Options</span><span class="o">.</span><span class="n">ALL_IMAGE_FORMAT_OPTIONS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1"> is not a valid file path, directory path, or list of file paths&#39;</span><span class="p">,</span>  <span class="n">source</span><span class="o">=</span><span class="n">convert_to_jpeg</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">directory</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;jpeg_</span><span class="si">{</span><span class="n">datetime_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_jpeg</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> save_dir&#39;</span><span class="p">,</span> <span class="n">create_if_not_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_jpeg</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> quality&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">quality</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> image file(s) to JPEG at quality </span><span class="si">{</span><span class="n">quality</span><span class="si">}</span><span class="s2"> ...&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_paths</span><span class="p">):</span>
        <span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">.jpeg&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting file </span><span class="si">{</span><span class="n">file_cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> ...&quot;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="s1">&#39;LA&#39;</span><span class="p">):</span> <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">)</span>
        <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;JPEG&#39;</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="n">quality</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA COMPLETE: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> image file(s) in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> directory converted to JPEG and stored in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> directory&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_jpeg</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>


<div class="viewcode-block" id="convert_to_bmp"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.convert_to_bmp">[docs]</a><span class="k">def</span> <span class="nf">convert_to_bmp</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]],</span>
                   <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert images in a directory to BMP format.</span>

<span class="sd">    :param Union[str, os.PathLike] path: path to directory containing images, or path to a single image file, or a list of paths to image files.</span>
<span class="sd">    :param Optional[bool] save_dir: If not None, then the directory where to store converted images. If None, then stores the images in a subdirectory within the first passed image directory.</span>
<span class="sd">    :param Optional[bool] verbose: If True, print conversion progress. Default is False.</span>
<span class="sd">    :return: None.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; convert_to_bmp(path=&#39;/Users/simon/Desktop/test_jpg_/landing_40.jpeg&#39;, save_dir=&#39;/Users/simon/Desktop/test_jpg_/test__&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">datetime_</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">check_valid_lst</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_bmp</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> path&#39;</span><span class="p">,</span> <span class="n">valid_dtypes</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,),</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span> <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="n">find_files_of_filetypes_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
                                                          <span class="n">extensions</span><span class="o">=</span><span class="n">Options</span><span class="o">.</span><span class="n">ALL_IMAGE_FORMAT_OPTIONS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                          <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1"> is not a valid file path or directory path or list of file paths&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_bmp</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">directory</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;bmp_</span><span class="si">{</span><span class="n">datetime_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_bmp</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> save_dir&#39;</span><span class="p">,</span> <span class="n">create_if_not_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> image file(s) to BMP ...&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_paths</span><span class="p">):</span>
        <span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">.bmp&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting file </span><span class="si">{</span><span class="n">file_cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> ...&quot;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="s1">&#39;LA&#39;</span><span class="p">):</span> <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">)</span>
        <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;BMP&#39;</span><span class="p">)</span>
        <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA COMPLETE: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> image file(s) in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> directory converted to BMP and stored in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> directory&quot;</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">convert_to_bmp</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>


<div class="viewcode-block" id="convert_to_png"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.convert_to_png">[docs]</a><span class="k">def</span> <span class="nf">convert_to_png</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                   <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert images to PNG format.</span>

<span class="sd">    :param Union[str, os.PathLike] path: path to directory containing images, or path to a single image file, or a list of paths to image files.</span>
<span class="sd">    :param Optional[bool] save_dir: If not None, then the directory where to store converted images. If None, then stores the images in a subdirectory within the first passed image directory.</span>
<span class="sd">    :param Optional[bool] verbose: If True, print conversion progress. Default is False.</span>
<span class="sd">    :return: None.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; convert_to_png(path=[&#39;/Users/simon/Desktop/test_jpg_/test__/landing_40.bmp&#39;, &#39;/Users/simon/Desktop/test_jpg_/landing_30.jpeg&#39;], save_dir=&#39;/Users/simon/Desktop/test_jpg_/test__/HELLO_3&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">datetime_</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">check_valid_lst</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_png</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> path&#39;</span><span class="p">,</span> <span class="n">valid_dtypes</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,),</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span> <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="n">find_files_of_filetypes_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
                                                          <span class="n">extensions</span><span class="o">=</span><span class="n">Options</span><span class="o">.</span><span class="n">ALL_IMAGE_FORMAT_OPTIONS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                          <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1"> is not a valid file path or directory path or list of file paths&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_png</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">directory</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;png_</span><span class="si">{</span><span class="n">datetime_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_png</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> save_dir&#39;</span><span class="p">,</span> <span class="n">create_if_not_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> image file(s) to PNG ...&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_paths</span><span class="p">):</span>
        <span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting file </span><span class="si">{</span><span class="n">file_cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> ...&quot;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="s1">&#39;LA&#39;</span><span class="p">):</span> <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">)</span>
        <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s1">&#39;PNG&#39;</span><span class="p">)</span>
        <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA COMPLETE: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> image file(s) in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> directory converted to PNG and stored in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> directory&quot;</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">convert_to_png</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>

<div class="viewcode-block" id="convert_to_tiff"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.convert_to_tiff">[docs]</a><span class="k">def</span> <span class="nf">convert_to_tiff</span><span class="p">(</span><span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                    <span class="n">stack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">compression</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="s1">&#39;tiff_deflate&#39;</span><span class="p">,</span> <span class="s1">&#39;tiff_lzw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;raw&#39;</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert images in a directory to TIFF format.</span>

<span class="sd">    :param Union[str, os.PathLike] directory: The directory containing the images.</span>
<span class="sd">    :param Optional[bool] stack: If True, create a TIFF stack from the images. Default is False.</span>
<span class="sd">    :param Literal[&#39;raw&#39;, &#39;tiff_deflate&#39;, &#39;tiff_lzw&#39;] compression: Compression method for the TIFF file. Options are &#39;raw&#39; (no compression), &#39;tiff_deflate&#39;, and &#39;tiff_lzw&#39;. Default is &#39;raw&#39;.</span>
<span class="sd">    :param Optional[bool] verbose: If True, print conversion progress. Default is False.</span>
<span class="sd">    :return: None.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; convert_to_tiff(&#39;/Users/simon/Desktop/imgs&#39;, stack=True, compression=&#39;tiff_lzw&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_tiff</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">file_paths</span> <span class="o">=</span> <span class="n">find_files_of_filetypes_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="n">Options</span><span class="o">.</span><span class="n">ALL_IMAGE_FORMAT_OPTIONS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_tiff</span><span class="si">}</span><span class="s1"> compression&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="s1">&#39;tiff_deflate&#39;</span><span class="p">,</span> <span class="s1">&#39;tiff_lzw&#39;</span><span class="p">])</span>
    <span class="n">datetime_</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> image file(s) found in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;tiff_</span><span class="si">{</span><span class="n">datetime_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stack</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_paths</span><span class="p">):</span>
            <span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">.tiff&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting file </span><span class="si">{</span><span class="n">file_cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> ...&quot;</span><span class="p">)</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="s1">&#39;LA&#39;</span><span class="p">):</span> <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">)</span>
            <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;TIFF&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
            <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
        <span class="n">stdout_success</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA COMPLETE: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> image file(s) in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> directory converted to TIFF and stored in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> directory&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">convert_to_tiff</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="si">}</span><span class="s1">.tiff&#39;</span><span class="p">)</span>
        <span class="n">file_paths</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">as</span> <span class="n">first_img</span><span class="p">:</span>
            <span class="n">mode</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">first_img</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="n">first_img</span><span class="o">.</span><span class="n">size</span>
            <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_paths</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting file </span><span class="si">{</span><span class="n">file_cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> ...&quot;</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">img</span><span class="p">:</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
                    <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">append_images</span><span class="o">=</span><span class="n">images</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;TIFF&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
        <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
        <span class="n">stdout_success</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA COMPLETE: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> image file(s) in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> directory converted to TIFF stack and stored in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> directory&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">convert_to_tiff</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>


<div class="viewcode-block" id="convert_to_webp"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.convert_to_webp">[docs]</a><span class="k">def</span> <span class="nf">convert_to_webp</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                    <span class="n">quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">95</span><span class="p">,</span>
                    <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert the file type of all image files within a directory to WEBP format of passed quality.</span>

<span class="sd">    .. image:: _static/img/convert_to_webp.webp</span>
<span class="sd">       :width: 600</span>
<span class="sd">       :align: center</span>

<span class="sd">    :parameter Union[str, os.PathLike] directory: Path to directory holding image files</span>
<span class="sd">    :parameter Optional[int] quality: The quality of the output images (0-100).</span>
<span class="sd">    :param Optional[bool] save_dir: If not None, then the directory where to store converted images. If None, then stores the images in a subdirectory within the first passed image directory.</span>
<span class="sd">    :parameter Optional[bool] verbose: If True, prints progress. Default False.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; convert_to_webp(&#39;/Users/simon/Desktop/imgs&#39;, quality=80)</span>
<span class="sd">    &gt;&gt;&gt; convert_to_webp(path=[&#39;/Users/simon/Desktop/test_jpg_/test__/landing_40.bmp&#39;, &#39;/Users/simon/Desktop/test_jpg_/landing_30.jpeg&#39;], save_dir=&#39;/Users/simon/Desktop/test_jpg_/test__/HELLO_4&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">datetime_</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">check_valid_lst</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_png</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> path&#39;</span><span class="p">,</span> <span class="n">valid_dtypes</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,),</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span> <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="n">find_files_of_filetypes_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="n">Options</span><span class="o">.</span><span class="n">ALL_IMAGE_FORMAT_OPTIONS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1"> is not a valid file path or directory path&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_webp</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">directory</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;webp_</span><span class="si">{</span><span class="n">datetime_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_png</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> save_dir&#39;</span><span class="p">,</span> <span class="n">create_if_not_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> image file(s) to WEBP ...&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_paths</span><span class="p">):</span>
        <span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">.webp&#39;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting file </span><span class="si">{</span><span class="n">file_cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> ...&quot;</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">IMWRITE_WEBP_QUALITY</span><span class="p">,</span> <span class="n">quality</span><span class="p">])</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA COMPLETE: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> image file(s) in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> directory converted to WEBP and stored in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> directory&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_webp</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>

<div class="viewcode-block" id="clahe_enhance_video"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.clahe_enhance_video">[docs]</a><span class="k">def</span> <span class="nf">clahe_enhance_video</span><span class="p">(</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">clip_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">tile_grid_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
    <span class="n">out_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a single video file to clahe-enhanced greyscale .avi file. The result is saved with prefix</span>
<span class="sd">    ``CLAHE_`` in the same directory as in the input file if out_path is not passed. Else saved at the out_path.</span>

<span class="sd">    .. image:: _static/img/clahe_enhance_video.gif</span>
<span class="sd">       :width: 800</span>
<span class="sd">       :align: center</span>

<span class="sd">    :parameter Union[str, os.PathLike] file_path: Path to video file.</span>
<span class="sd">    :parameter Optional[int] clip_limit: CLAHE amplification limit. Inccreased clip limit reduce noise in output. Default: 2.</span>
<span class="sd">    :parameter Optional[Tuple[int]] tile_grid_size: The histogram kernel size.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = clahe_enhance_video(file_path: &#39;project_folder/videos/Video_1.mp4&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">clahe_enhance_video</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> clip_limit&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">clip_limit</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">check_valid_tuple</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">tile_grid_size</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clahe_enhance_video</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> tile_grid_size&#39;</span><span class="p">,</span>
        <span class="n">accepted_lengths</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,),</span>
        <span class="n">valid_dtypes</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tile_grid_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">tile_grid_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">])</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The tile grid size (</span><span class="si">{</span><span class="n">tile_grid_size</span><span class="si">}</span><span class="s1">) is larger than the video size (</span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;resolution_str&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">clahe_enhance_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">out_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;CLAHE_</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">.avi&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">out_path</span><span class="p">),</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clahe_enhance_video</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> out_path&#39;</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">out_path</span>
    <span class="n">fourcc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter_fourcc</span><span class="p">(</span><span class="o">*</span><span class="n">Formats</span><span class="o">.</span><span class="n">AVI_CODEC</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Applying CLAHE on video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">, this might take awhile...&quot;</span><span class="p">)</span>
    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter</span><span class="p">(</span>
        <span class="n">save_path</span><span class="p">,</span>
        <span class="n">fourcc</span><span class="p">,</span>
        <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">],</span>
        <span class="p">(</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]),</span>
        <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">clahe_filter</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">createCLAHE</span><span class="p">(</span>
        <span class="n">clipLimit</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">clip_limit</span><span class="p">),</span> <span class="n">tileGridSize</span><span class="o">=</span><span class="n">tile_grid_size</span>
    <span class="p">)</span>
    <span class="n">frm_cnt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">img</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
                <span class="n">frm_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
                <span class="n">clahe_frm</span> <span class="o">=</span> <span class="n">clahe_filter</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">clahe_frm</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;CLAHE converted frame </span><span class="si">{</span><span class="n">frm_cnt</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;frame_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">)...&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CLAHE video created: </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">se</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CLAHE conversion failed for video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="k">raise</span> <span class="n">InvalidVideoFileError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Could not convert file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> to CLAHE enhanced video&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">clahe_enhance_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="extract_frame_range"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.extract_frame_range">[docs]</a><span class="k">def</span> <span class="nf">extract_frame_range</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                        <span class="n">start_frame</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                        <span class="n">end_frame</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                        <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract a user-defined range of frames from a video file to `png` format. Images</span>
<span class="sd">    are saved in a folder with the suffix `_frames` within the same directory as the video file.</span>

<span class="sd">    :parameter Union[str, os.PathLike] file_path: Path to video file</span>
<span class="sd">    :parameter int start_frame: First frame in range to extract</span>
<span class="sd">    :parameter int end_frame: Last frame in range to extract.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = extract_frame_range(file_path=&#39;project_folder/videos/Video_1.mp4&#39;, start_frame=100, end_frame=500)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;start frame&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">start_frame</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">file_dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;end frame&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">end_frame</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">])</span>
    <span class="n">frame_range</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">start_frame</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">end_frame</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">_frames&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">extract_frame_range</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">frm_cnt</span><span class="p">,</span> <span class="n">frm_number</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frame_range</span><span class="p">):</span>
        <span class="n">frm_timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">read_frm_of_video</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">cap</span><span class="p">,</span> <span class="n">frame_index</span><span class="o">=</span><span class="n">frm_cnt</span><span class="p">)</span>
        <span class="n">frm_save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">frm_number</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">frm_save_path</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>
        <span class="n">frm_timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frame </span><span class="si">{</span><span class="n">frm_number</span><span class="si">}</span><span class="s2"> saved (Frame </span><span class="si">{</span><span class="n">frm_cnt</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">frame_range</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s2">) (elapsed time: </span><span class="si">{</span><span class="n">frm_timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">frame_range</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s2"> frames extracted for video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> saved in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">extract_frame_range</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>


<div class="viewcode-block" id="change_single_video_fps"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.change_single_video_fps">[docs]</a><span class="k">def</span> <span class="nf">change_single_video_fps</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                            <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Change the fps of a single video file. Results are stored in the same directory as in the input file with</span>
<span class="sd">    the suffix ``_fps_new_fps``.</span>

<span class="sd">    .. note::</span>
<span class="sd">       To change the FPS of all videos in a directory, use ``simba.video_processors.video_processing.change_fps_of_multiple_videos``.</span>

<span class="sd">    .. video:: _static/img/change_single_video_fps.webm</span>
<span class="sd">       :loop:</span>

<span class="sd">    :param Union[str, os.PathLike] file_path: Path to video file</span>
<span class="sd">    :param int fps: FPS of the new video file.</span>
<span class="sd">    :param Optional[bool] gpu: If True, use NVIDEA GPU codecs. Default False.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = change_single_video_fps(file_path=&#39;project_folder/videos/Video_1.mp4&#39;, fps=15)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None)&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">change_single_video_fps</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;New fps&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">fps</span><span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">fps</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">]):</span>
        <span class="n">SameInputAndOutputWarning</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;The new fps is the same as the input fps for video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">fps</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">change_single_video_fps</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_fps_</span><span class="si">{</span><span class="n">fps</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting the FPS to </span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s2"> for video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> ...&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;.webm&#39;</span><span class="p">:</span>
        <span class="n">codec</span> <span class="o">=</span> <span class="s1">&#39;libvpx-vp9&#39;</span>
    <span class="k">elif</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;.avi&#39;</span><span class="p">:</span>
        <span class="n">codec</span> <span class="o">=</span> <span class="s1">&#39;mpeg4&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">codec</span> <span class="o">=</span> <span class="s1">&#39;libx264&#39;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
        <span class="n">FileExistWarning</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Overwriting existing file at </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">change_single_video_fps</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,)</span>
    <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;fps=</span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s1">&quot; -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -y&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -filter:v fps=fps=</span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s1"> -c:v </span><span class="si">{</span><span class="n">codec</span><span class="si">}</span><span class="s1"> -c:a aac &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;SIMBA COMPLETE: FPS of video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1"> changed from </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">])</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">fps</span><span class="p">)</span><span class="si">}</span><span class="s1"> and saved in directory </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">change_single_video_fps</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>


<div class="viewcode-block" id="change_fps_of_multiple_videos"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.change_fps_of_multiple_videos">[docs]</a><span class="k">def</span> <span class="nf">change_fps_of_multiple_videos</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]],</span>
                                  <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                  <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Change the fps of all video files in a folder. Results are stored in the same directory as in the input files with</span>
<span class="sd">    the suffix ``_fps_new_fps``.</span>

<span class="sd">    :parameter Union[str, os.PathLike] path: Path to video file directory, or a list of video file paths.</span>
<span class="sd">    :parameter int fps: Fps of the new video files.</span>
<span class="sd">    :param Optional[bool] save_dir: If not None, then the directory where to store converted videos. If None, then stores the new videos in the same directory as the input video with the ``_new_fps.file_extension`` suffix.</span>
<span class="sd">    :parameter Optional[bool] gpu: If True, use NVIDEA GPU codecs. Default False.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = change_fps_of_multiple_videos(path=&#39;project_folder/videos/Video_1.mp4&#39;, fps=15)</span>
<span class="sd">    &gt;&gt;&gt; change_fps_of_multiple_videos(path=&#39;/Users/simon/Desktop/imgs&#39;, save_dir=&#39;/Users/simon/Desktop/imgs_4&#39;, fps=15)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None)&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">change_fps_of_multiple_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;New fps&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">check_valid_lst</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">change_fps_of_multiple_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> path&#39;</span><span class="p">,</span> <span class="n">valid_dtypes</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,),</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span> <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="n">find_all_videos_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1"> is not a valid file path or directory path or list of file paths&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">change_fps_of_multiple_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">change_fps_of_multiple_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> save_dir&#39;</span><span class="p">,</span> <span class="n">create_if_not_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">video_timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">fps</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">]):</span>
            <span class="n">SameInputAndOutputWarning</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;The new FPS (</span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s2">) is the same or lower than the original FPS (</span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;fps&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">) for video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">change_fps_of_multiple_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting FPS from </span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;fps&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_fps_</span><span class="si">{</span><span class="n">fps</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;.webm&#39;</span><span class="p">:</span> <span class="n">codec</span> <span class="o">=</span> <span class="s1">&#39;libvpx-vp9&#39;</span>
        <span class="k">elif</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;.avi&#39;</span><span class="p">:</span> <span class="n">codec</span> <span class="o">=</span> <span class="s1">&#39;mpeg4&#39;</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">codec</span> <span class="o">=</span> <span class="s1">&#39;libx264&#39;</span>
        <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;fps=</span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s1">&quot; -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -filter:v fps=fps=</span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s1"> -c:v </span><span class="si">{</span><span class="n">codec</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">video_timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> complete (saved at </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">)... (elapsed time: </span><span class="si">{</span><span class="n">video_timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA COMPLETE: FPS of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> video(s) changed to </span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">change_fps_of_multiple_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,)</span></div>


<div class="viewcode-block" id="convert_video_powerpoint_compatible_format"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.convert_video_powerpoint_compatible_format">[docs]</a><span class="k">def</span> <span class="nf">convert_video_powerpoint_compatible_format</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span> <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create MS PowerPoint compatible copy of a video file. The result is stored in the same directory as the</span>
<span class="sd">    input file with the ``_powerpointready`` suffix.</span>

<span class="sd">    :parameter Union[str, os.PathLike] file_path: Path to video file.</span>
<span class="sd">    :parameter Optional[bool] gpu: If True, use NVIDEA GPU codecs. Default False.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = convert_video_powerpoint_compatible_format(file_path=&#39;project_folder/videos/Video_1.mp4&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None)&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">convert_video_powerpoint_compatible_format</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">save_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot;_powerpointready.mp4&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">save_name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">FileExistError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;SIMBA ERROR: The outfile file already exist: </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">save_name</span><span class="p">),</span>
            <span class="n">source</span><span class="o">=</span><span class="n">convert_video_powerpoint_compatible_format</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{}</span><span class="s1">&quot; -c:v h264_nvenc -preset slow -profile:v high -level:v 4.0 -pix_fmt yuv420p -crf 22 -c:a aac &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">file_path</span><span class="p">,</span> <span class="n">save_name</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -c:v libx264 -preset slow -profile:v high -level:v 4.0 -pix_fmt yuv420p -crf 22 -c:v libx264 -codec:a aac &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -y&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating video in powerpoint compatible format... &quot;</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA COMPLETE: Video converted! </span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s2"> generated!&quot;</span><span class="p">,</span>
        <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">convert_video_powerpoint_compatible_format</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="video_to_greyscale"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.video_to_greyscale">[docs]</a><span class="k">def</span> <span class="nf">video_to_greyscale</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span> <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a video file to greyscale mp4 format. The result is stored in the same directory as the</span>
<span class="sd">    input file with the ``_grayscale.mp4`` suffix.</span>

<span class="sd">    .. image:: _static/img/to_greyscale.gif</span>
<span class="sd">       :width: 700</span>
<span class="sd">       :align: center</span>

<span class="sd">    :parameter Union[str, os.PathLike] file_path: Path to video file.</span>
<span class="sd">    :parameter Optional[bool] gpu: If True, use NVIDEA GPU codecs. Default False.</span>
<span class="sd">    :raise FFMPEGCodecGPUError: If no GPU is found and ``gpu == True``.</span>
<span class="sd">    :raise FileExistError: If video name with ``_grayscale`` suffix already exist.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = video_to_greyscale(file_path=&#39;project_folder/videos/Video_1.avi&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None)&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">video_to_greyscale</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">save_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot;_grayscale.mp4&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">save_name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">FileExistError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;SIMBA ERROR: The outfile file already exist: </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">save_name</span><span class="p">),</span>
            <span class="n">source</span><span class="o">=</span><span class="n">video_to_greyscale</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;hwupload_cuda,hwdownload,format=nv12,format=gray&quot; -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf format=gray -c:v libx264 &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> to greyscale... &quot;</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA COMPLETE: Video converted! </span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s2"> generated!&quot;</span><span class="p">,</span>
        <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">video_to_greyscale</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="batch_video_to_greyscale"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.batch_video_to_greyscale">[docs]</a><span class="k">def</span> <span class="nf">batch_video_to_greyscale</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]],</span>
                             <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a directory of video file to greyscale mp4 format. The results are stored in the same directory as the</span>
<span class="sd">    input files with the ``_grayscale.mp4`` suffix.</span>

<span class="sd">    .. image:: _static/img/to_greyscale.gif</span>
<span class="sd">       :width: 700</span>
<span class="sd">       :align: center</span>

<span class="sd">    :param Union[str, os.PathLike] path: Path to directory holding video files in color, or a list of file paths to videos in color.</span>
<span class="sd">    :param Optional[bool] save_dir: If not None, then the directory where to store converted videos. If None, then stores the new videos in the same directory as the input video with the ``_grayscale`` suffix.</span>
<span class="sd">    :param Optional[bool] gpu: If True, use NVIDEA GPU codecs. Default False.</span>
<span class="sd">    :raise FFMPEGCodecGPUError: If no GPU is found and ``gpu == True``.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = batch_video_to_greyscale(path=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/mouse_open_field/project_folder/videos/test_2&#39;)</span>
<span class="sd">    &gt;&gt;&gt; batch_video_to_greyscale(path=&#39;/Users/simon/Desktop/imgs_4&#39;, save_dir=&#39;/Users/simon/Desktop/imgs_4/test&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None)&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">batch_video_to_greyscale</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">check_valid_lst</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">batch_video_to_greyscale</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> path&#39;</span><span class="p">,</span> <span class="n">valid_dtypes</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,),</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span> <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">batch_video_to_greyscale</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="n">find_all_videos_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1"> is not a valid directory path or a valid list of video paths&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">batch_video_to_greyscale</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">batch_video_to_greyscale</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> save_dir&#39;</span><span class="p">,</span> <span class="n">create_if_not_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">video_timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">in_dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">in_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">_grayscale.mp4&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">save_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}{</span><span class="n">file_ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;hwupload_cuda,hwdownload,format=nv12,format=gray&quot; -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf format=gray -c:v libx264 &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -hide_banner -loglevel error -y&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> to greyscale (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2">)... &quot;</span><span class="p">)</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">video_timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Video </span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s2"> complete (saved at </span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s2">), (elapsed time: </span><span class="si">{</span><span class="n">video_timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> video(s) converted to grayscale!&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">batch_video_to_greyscale</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>


<div class="viewcode-block" id="superimpose_frame_count"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.superimpose_frame_count">[docs]</a><span class="k">def</span> <span class="nf">superimpose_frame_count</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                            <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">font</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Arial&#39;</span><span class="p">,</span>
                            <span class="n">font_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                            <span class="n">bg_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span>
                            <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">loc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;top_left&#39;</span><span class="p">,</span> <span class="s1">&#39;top_middle&#39;</span><span class="p">,</span> <span class="s1">&#39;top_right&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_left&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_middle&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_right&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;bottom_middle&#39;</span><span class="p">,</span>
                            <span class="n">fontsize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Superimpose frame count on a video file. The result is stored in the same directory as the</span>
<span class="sd">    input file with the ``_frame_no.mp4`` suffix if ``save_path`` is None.</span>

<span class="sd">    .. image:: _static/img/superimpose_frame_count.png</span>
<span class="sd">       :width: 700</span>
<span class="sd">       :align: center</span>

<span class="sd">    .. image:: _static/img/superimpose_frame_count.gif</span>
<span class="sd">       :width: 500</span>
<span class="sd">       :align: center</span>

<span class="sd">    :parameter Union[str, os.PathLike] file_path: Path to video file.</span>
<span class="sd">    :parameter Optional[bool] gpu: If True, use NVIDEA GPU codecs. Default False.</span>
<span class="sd">    :parameter Optional[int] fontsize: The size of the font represetnting the current frame. Default: 20.</span>
<span class="sd">    :parameter Optional[Union[str, os.PathLike]] save_path: Optional save location for the video with frame numbers. If None, then the new video is saved in the same directory as the input video with the ``_frame_no`` suffix.</span>
<span class="sd">    :parameter Optional[str] font_color: The color of frame number text. Default: &#39;Black&#39;.</span>
<span class="sd">    :parameter Optional[str] loc: The location of the font number text. Options: &#39;top_left&#39;, &#39;top_middle&#39;, &#39;top_right&#39;, &#39;bottom_left&#39;, &#39;bottom_middle&#39;, &#39;bottom_right&#39;. Default: Bottom middle.</span>
<span class="sd">    :parameter Optional[str] bg_color: The color of the box which the frame number is printed in. Default: &#39;White&#39;.</span>
<span class="sd">    :parameter Optional[str] font: The font to use for the frame number. Default Arial.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = superimpose_frame_count(file_path=&#39;/Users/simon/Downloads/1_LH_0_3.mp4&#39;, fontsize=90)</span>
<span class="sd">    &gt;&gt;&gt; superimpose_frame_count(file_path=&#39;/Users/simon/Desktop/imgs_4/test/Screen Recording 2024-02-26 at 4.43.26 PM_frame_no.mp4&#39;, save_path=&#39;/Users/simon/Desktop/imgs_4/test/blahhhh.mp4&#39;, fontsize=90)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">superimpose_frame_count</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> fontsize&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">font_color</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isalnum</span><span class="p">,</span> <span class="n">font_color</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">bg_color</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isalnum</span><span class="p">,</span> <span class="n">bg_color</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">font_dict</span> <span class="o">=</span> <span class="n">get_fonts</span><span class="p">()</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">font_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;loc&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;top_left&#39;</span><span class="p">,</span> <span class="s1">&#39;top_middle&#39;</span><span class="p">,</span> <span class="s1">&#39;top_right&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_left&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_middle&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_right&#39;</span><span class="p">))</span>
    <span class="n">font_path</span> <span class="o">=</span> <span class="n">font_dict</span><span class="p">[</span><span class="n">font</span><span class="p">]</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">_frame_no.mp4&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">save_path</span><span class="p">)),</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">superimpose_frame_count</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> save_path&#39;</span><span class="p">,</span> <span class="n">create_if_not_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">save_name</span> <span class="o">=</span> <span class="n">save_path</span>
    <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">loc</span> <span class="o">==</span> <span class="s1">&#39;top_left&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;drawtext=fontfile=&#39;</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">&#39;:text=%</span><span class="se">{{</span><span class="s1">n</span><span class="se">}}</span><span class="s1">:x=10:y=10:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:fontsize=</span><span class="si">{</span><span class="n">fontsize</span><span class="si">}</span><span class="s1">:box=1:boxcolor=</span><span class="si">{</span><span class="n">bg_color</span><span class="si">}</span><span class="s1">@0.5&quot; -c:v h264_nvenc -c:a copy -loglevel error -stats &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -y&#39;&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">loc</span> <span class="o">==</span> <span class="s1">&#39;top_center&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;drawtext=fontfile=&#39;</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">&#39;:text=%</span><span class="se">{{</span><span class="s1">n</span><span class="se">}}</span><span class="s1">:x=(w-tw)/2:y=10:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:fontsize=</span><span class="si">{</span><span class="n">fontsize</span><span class="si">}</span><span class="s1">:box=1:boxcolor=</span><span class="si">{</span><span class="n">bg_color</span><span class="si">}</span><span class="s1">@0.5&quot; -c:v h264_nvenc -c:a copy -loglevel error -stats &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -y&#39;&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">loc</span> <span class="o">==</span> <span class="s1">&#39;top_right&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;drawtext=fontfile=&#39;</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">&#39;:text=%</span><span class="se">{{</span><span class="s1">n</span><span class="se">}}</span><span class="s1">:x=w-tw-10:y=10:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:fontsize=</span><span class="si">{</span><span class="n">fontsize</span><span class="si">}</span><span class="s1">:box=1:boxcolor=</span><span class="si">{</span><span class="n">bg_color</span><span class="si">}</span><span class="s1">@0.5&quot; -c:v h264_nvenc -c:a copy -loglevel error -stats &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -y&#39;&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">loc</span> <span class="o">==</span> <span class="s1">&#39;bottom_left&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;drawtext=fontfile=&#39;</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">&#39;:text=%</span><span class="se">{{</span><span class="s1">n</span><span class="se">}}</span><span class="s1">:x=10:y=h-th-10:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:fontsize=</span><span class="si">{</span><span class="n">fontsize</span><span class="si">}</span><span class="s1">:box=1:boxcolor=</span><span class="si">{</span><span class="n">bg_color</span><span class="si">}</span><span class="s1">@0.5&quot; -c:v h264_nvenc -c:a copy -loglevel error -stats &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -y&#39;&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">loc</span> <span class="o">==</span> <span class="s1">&#39;bottom_right&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;drawtext=fontfile=&#39;</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">&#39;:text=%</span><span class="se">{{</span><span class="s1">n</span><span class="se">}}</span><span class="s1">:x=w-tw-10:y=h-th-10:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:fontsize=</span><span class="si">{</span><span class="n">fontsize</span><span class="si">}</span><span class="s1">:box=1:boxcolor=</span><span class="si">{</span><span class="n">bg_color</span><span class="si">}</span><span class="s1">@0.5&quot; -c:v h264_nvenc -c:a copy -loglevel error -stats &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -y&#39;&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;drawtext=fontfile=&#39;</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">&#39;:text=%</span><span class="se">{{</span><span class="s1">n</span><span class="se">}}</span><span class="s1">:x=(w-tw)/2:y=h-th-10:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:fontsize=</span><span class="si">{</span><span class="n">fontsize</span><span class="si">}</span><span class="s1">:box=1:boxcolor=</span><span class="si">{</span><span class="n">bg_color</span><span class="si">}</span><span class="s1">@0.5&quot; -c:v h264_nvenc -c:a copy -loglevel error -stats &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -y&#39;&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">loc</span> <span class="o">==</span> <span class="s1">&#39;top_left&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;ffmpeg -y -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;drawtext=fontfile=&#39;</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">&#39;: text=&#39;%</span><span class="se">{{</span><span class="s1">frame_num</span><span class="se">}}</span><span class="s1">&#39;: start_number=0: x=10: y=10: fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">: fontsize=</span><span class="si">{</span><span class="n">fontsize</span><span class="si">}</span><span class="s1">: box=1: boxcolor=</span><span class="si">{</span><span class="n">bg_color</span><span class="si">}</span><span class="s1">: boxborderw=5&quot; -c:a copy -loglevel error -stats &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -y&#39;&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">loc</span> <span class="o">==</span> <span class="s1">&#39;top_middle&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;ffmpeg -y -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;drawtext=fontfile=&#39;</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">&#39;: text=&#39;%</span><span class="se">{{</span><span class="s1">frame_num</span><span class="se">}}</span><span class="s1">&#39;: start_number=0: x=(w-tw)/2: y=10: fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">: fontsize=</span><span class="si">{</span><span class="n">fontsize</span><span class="si">}</span><span class="s1">: box=1: boxcolor=</span><span class="si">{</span><span class="n">bg_color</span><span class="si">}</span><span class="s1">: boxborderw=5&quot; -c:a copy -loglevel error -stats &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -y&#39;&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">loc</span> <span class="o">==</span> <span class="s1">&#39;bottom_left&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;ffmpeg -y -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;drawtext=fontfile=&#39;</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">&#39;: text=&#39;%</span><span class="se">{{</span><span class="s1">frame_num</span><span class="se">}}</span><span class="s1">&#39;: start_number=0: x=10: y=h-th-10: fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">: fontsize=</span><span class="si">{</span><span class="n">fontsize</span><span class="si">}</span><span class="s1">: box=1: boxcolor=</span><span class="si">{</span><span class="n">bg_color</span><span class="si">}</span><span class="s1">: boxborderw=5&quot; -c:a copy -loglevel error -stats &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -y&#39;&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">loc</span> <span class="o">==</span> <span class="s1">&#39;bottom_right&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;ffmpeg -y -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;drawtext=fontfile=&#39;</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">&#39;: text=&#39;%</span><span class="se">{{</span><span class="s1">frame_num</span><span class="se">}}</span><span class="s1">&#39;: start_number=0: x=w-tw-10: y=h-th-10: fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">: fontsize=</span><span class="si">{</span><span class="n">fontsize</span><span class="si">}</span><span class="s1">: box=1: boxcolor=</span><span class="si">{</span><span class="n">bg_color</span><span class="si">}</span><span class="s1">: boxborderw=5&quot; -c:a copy -loglevel error -stats &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -y&#39;&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;ffmpeg -y -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;drawtext=fontfile=&#39;</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">&#39;: text=&#39;%</span><span class="se">{{</span><span class="s1">frame_num</span><span class="se">}}</span><span class="s1">&#39;: start_number=0: x=(w-tw)/2: y=h-th-10: fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">: fontsize=</span><span class="si">{</span><span class="n">fontsize</span><span class="si">}</span><span class="s1">: box=1: boxcolor=</span><span class="si">{</span><span class="n">bg_color</span><span class="si">}</span><span class="s1">: boxborderw=5&quot; -c:a copy -loglevel error -stats &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -y&#39;&#39;&#39;</span>

    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Superimposed video converted! </span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s2"> generated!&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>

<div class="viewcode-block" id="remove_beginning_of_video"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.remove_beginning_of_video">[docs]</a><span class="k">def</span> <span class="nf">remove_beginning_of_video</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                              <span class="n">time</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                              <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                              <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove N seconds from the beginning of a video file. If save_path is not passed,</span>
<span class="sd">    the result is stored in the same directory as the input file with the ``_shorten.mp4`` suffix.</span>

<span class="sd">    :param Union[str, os.PathLike] file_path: Path to video file</span>
<span class="sd">    :param int time: Number of seconds to remove from the beginning of the video.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_path: Optional save location for the shortened video. If None, then the new video is saved in the same directory as the input video with the ``_shortened`` suffix.</span>
<span class="sd">    :param Optional[bool] gpu: If True, use NVIDEA GPU codecs. Default False.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = remove_beginning_of_video(file_path=&#39;project_folder/videos/Video_1.avi&#39;, time=10)</span>
<span class="sd">    &gt;&gt;&gt; remove_beginning_of_video(file_path=f&#39;/Users/simon/Desktop/imgs_4/test/blahhhh.mp4&#39;, save_path=&#39;/Users/simon/Desktop/imgs_4/test/CUT.mp4&#39;, time=3)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None)&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">remove_beginning_of_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Cut time&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;video_length_s&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">time</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;The cut time </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">s is invalid for video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> with length </span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;video_length_s&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">remove_beginning_of_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">_shorten.mp4&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">save_path</span><span class="p">)),</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">remove_beginning_of_video</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> save_path&#39;</span><span class="p">,</span> <span class="n">create_if_not_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">save_name</span> <span class="o">=</span> <span class="n">save_path</span>
    <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -ss </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s1"> -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -c:v h264_nvenc -c:a aac &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -ss </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s1"> -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -c:v libx264 -c:a aac &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing initial </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">s from </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">... &quot;</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA COMPLETE: Video converted! </span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s2"> generated!&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">remove_beginning_of_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>


<div class="viewcode-block" id="clip_video_in_range"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.clip_video_in_range">[docs]</a><span class="k">def</span> <span class="nf">clip_video_in_range</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                        <span class="n">start_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">end_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">out_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">overwrite</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">include_clip_time_in_filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clip video within a specific range. The result is stored in the same directory as the</span>
<span class="sd">    input file with the ``_clipped.mp4`` suffix.</span>

<span class="sd">    :parameter Union[str, os.PathLike] file_path: Path to video file</span>
<span class="sd">    :parameter str start_time: Start time in HH:MM:SS format.</span>
<span class="sd">    :parameter str end_time: End time in HH:MM:SS format.</span>
<span class="sd">    :parameter Optional[Union[str, os.PathLike]] out_dir: If None, then the clip will be stored in the same dir as the input video. If directory, then the location of the output files.</span>
<span class="sd">    :parameter Optional[bool] include_clip_time_in_filename: If True, include the clip start and end in HH-MM-SS format as suffix in the filename. If False, then use integer suffic representing the count.</span>
<span class="sd">    :parameter Optional[bool] overwrite: If True, the overwrite output file if path already exist. If False, then raise FileExistError.</span>
<span class="sd">    :parameter Optional[bool] gpu: If True, use NVIDEA GPU codecs. Default False.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = clip_video_in_range(file_path=&#39;project_folder/videos/Video_1.avi&#39;, start_time=&#39;00:00:05&#39;, end_time=&#39;00:00:10&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None)&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">clip_video_in_range</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">out_dir</span><span class="p">)</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="n">out_dir</span>
    <span class="n">check_if_string_value_is_valid_video_timestamp</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;START TIME&quot;</span><span class="p">)</span>
    <span class="n">check_if_string_value_is_valid_video_timestamp</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;END TIME&quot;</span><span class="p">)</span>
    <span class="n">check_that_hhmmss_start_is_before_end</span><span class="p">(</span><span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> timestamps&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">include_clip_time_in_filename</span><span class="p">:</span>
        <span class="n">save_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot;_clipped.mp4&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">start_time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">end_time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.mp4&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">save_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">overwrite</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">FileExistError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA ERROR: The outfile file already exist: </span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">clip_video_in_range</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -ss </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s1"> -to </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s1"> -async 1 &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -ss </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s1"> -to </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s1"> -async 1 -c:v libvpx-vp9 &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Clipping video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> between </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s2">... &quot;</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Video converted! </span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s2"> generated!&quot;</span><span class="p">,</span>
        <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">clip_video_in_range</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="downsample_video"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.downsample_video">[docs]</a><span class="k">def</span> <span class="nf">downsample_video</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                     <span class="n">video_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                     <span class="n">video_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                     <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Down-sample a video file. The result is stored in the same directory as the</span>
<span class="sd">    input file with the ``_downsampled.mp4`` suffix.</span>

<span class="sd">    :parameter Union[str, os.PathLike] file_path: Path to video file.</span>
<span class="sd">    :parameter int video_height: height of new video.</span>
<span class="sd">    :parameter int video_width: width of new video.</span>
<span class="sd">    :parameter Optional[bool] gpu: If True, use NVIDEA GPU codecs. Default False.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = downsample_video(file_path=&#39;project_folder/videos/Video_1.avi&#39;, video_height=600, video_width=400)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None)&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">downsample_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Video height&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">video_height</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Video width&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">video_width</span><span class="p">)</span>
    <span class="n">video_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">video_height</span><span class="p">)</span>
    <span class="n">video_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">video_width</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">video_width</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">video_width</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">video_height</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">video_height</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">save_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot;_downsampled.mp4&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">save_name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">FileExistError</span><span class="p">(</span><span class="s2">&quot;SIMBA ERROR: The outfile file already exist: </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">save_name</span><span class="p">),</span> <span class="n">source</span><span class="o">=</span><span class="n">downsample_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,)</span>
    <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -y -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;scale_cuda=w=</span><span class="si">{</span><span class="n">video_width</span><span class="si">}</span><span class="s1">:h=</span><span class="si">{</span><span class="n">video_height</span><span class="si">}</span><span class="s1">:force_original_aspect_ratio=decrease:flags=bicubic&quot; -c:v h264_nvenc &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf scale=</span><span class="si">{</span><span class="n">video_width</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">video_height</span><span class="si">}</span><span class="s1"> -c:v libx264 &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Down-sampling video... &quot;</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA COMPLETE: Video converted! </span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s2"> generated!&quot;</span><span class="p">,</span>
        <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">downsample_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="gif_creator"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.gif_creator">[docs]</a><span class="k">def</span> <span class="nf">gif_creator</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                <span class="n">start_time</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
                <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">fps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
                <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a sample gif from a video file. The result is stored in the same directory as the</span>
<span class="sd">    input file with the ``.gif`` file extension if ``save_path`` is passed as None.</span>

<span class="sd">    .. note::</span>
<span class="sd">       The height is auto-computed to retain aspect ratio.</span>

<span class="sd">    .. seealso:</span>
<span class="sd">       GIFs are typically for online use but can be costly in terms of time to create and file size. For smaller files,</span>
<span class="sd">       consider ``webm`` format which are for online publication and ``simba.video_processors.video_processing.convert_to_webm``.</span>

<span class="sd">    :param Union[str, os.PathLike] file_path: Path to video file.</span>
<span class="sd">    :param int start_time: Start time of the gif in relation to the video in seconds.</span>
<span class="sd">    :param int duration: Duration of the gif.</span>
<span class="sd">    :param int width: Width of the gif. If None, then retains the width and height of the input video.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_path: Optional save location for the gif. If None, then the new video is saved in the same directory.</span>
<span class="sd">    :param int fps: FPS of the gif. Defaults to 15.</span>
<span class="sd">    :param int quality: Quality of the GIF on scale 1-100. Smaller values gives smaller GIFs by filesize with worse quality. Default: 100.</span>
<span class="sd">    :param Optional[bool] gpu: If True, use NVIDEA GPU codecs. Default False.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = gif_creator(file_path=&#39;project_folder/videos/Video_1.avi&#39;, start_time=5, duration=10, width=600)</span>
<span class="sd">    &gt;&gt;&gt; gif_creator(file_path=r&#39;/Users/simon/Desktop/envs/simba/troubleshooting/mouse_open_field/project_folder/videos/SI_DAY3_308_CD1_PRESENT.mp4&#39;, start_time=5, duration=15, width=600, gpu=False, save_path=&#39;/Users/simon/Desktop/imgs_4/Test.gif&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;NVIDEA GPU not available (as evaluated by nvidea-smi returning None&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">gif_creator</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Start time&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Duration&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Width&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;FPS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;QUALITY&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">quality</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">quality</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">quality</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">256</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">width</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">width</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">quality</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">quality</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;video_length_s&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">FrameRangeError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The end of the gif (start time: </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s1"> + duration: </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s1">) is longer than the </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> video: </span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;video_length_s&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">gif_creator</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">.gif&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">save_path</span><span class="p">)),</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">gif_creator</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> save_path&#39;</span><span class="p">,</span> <span class="n">create_if_not_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">save_name</span> <span class="o">=</span> <span class="n">save_path</span>
    <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -ss </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s1"> -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -to </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s1"> -vf &quot;fps=10,scale=</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s1">:-1&quot; -c:v gif -pix_fmt rgb24 -y &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -y&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -ss </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s1"> -t </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s1"> -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[0:v] fps=</span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s1">,scale=w=</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s1">:h=-1:flags=lanczos,split [a][b];[a] palettegen=stats_mode=single:max_colors=</span><span class="si">{</span><span class="n">quality</span><span class="si">}</span><span class="s1"> [p];[b][p] paletteuse=dither=bayer:bayer_scale=3&quot; &quot;</span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating gif sample... &quot;</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA COMPLETE: Video converted! </span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s2"> generated!&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">gif_creator</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>


<div class="viewcode-block" id="batch_convert_video_format"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.batch_convert_video_format">[docs]</a><span class="k">def</span> <span class="nf">batch_convert_video_format</span><span class="p">(</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">input_format</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_format</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Batch convert all videos in a folder of specific format into a different video format. The results are</span>
<span class="sd">    stored in the same directory as the input files.</span>

<span class="sd">    :parameter Union[str, os.PathLike] directory: Path to video file directory.</span>
<span class="sd">    :parameter str input_format: Format of the input files (e.g., avi).</span>
<span class="sd">    :parameter str output_format: Format of the output files (e.g., mp4).</span>
<span class="sd">    :parameter Optional[bool] gpu: If True, use NVIDEA GPU codecs. Default False.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = batch_convert_video_format(directory=&#39;project_folder/videos&#39;, input_format=&#39;avi&#39;, output_format=&#39;mp4&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;NVIDEA GPU not available (as evaluated by nvidea-smi returning None&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">batch_convert_video_format</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">input_format</span> <span class="o">==</span> <span class="n">output_format</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidFileTypeError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;The input format (</span><span class="si">{</span><span class="n">input_format</span><span class="si">}</span><span class="s2">) is the same as the output format (</span><span class="si">{</span><span class="n">output_format</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">batch_convert_video_format</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">NotDirectoryError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;SIMBA ERROR: </span><span class="si">{}</span><span class="s2"> is not a valid directory&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directory</span><span class="p">),</span>
            <span class="n">source</span><span class="o">=</span><span class="n">batch_convert_video_format</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">video_paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">file_paths_in_folder</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">directory</span> <span class="o">+</span> <span class="s2">&quot;/*&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_paths_in_folder</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
            <span class="n">video_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;SIMBA ERROR: No files with .</span><span class="si">{}</span><span class="s2"> file extension found in the </span><span class="si">{}</span><span class="s2"> directory&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">input_format</span><span class="p">,</span> <span class="n">directory</span>
            <span class="p">),</span>
            <span class="n">source</span><span class="o">=</span><span class="n">batch_convert_video_format</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">video_timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot;.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_format</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FileExistError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;SIMBA ERROR: The outfile file already exist: </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">save_path</span>
                <span class="p">),</span>
                <span class="n">source</span><span class="o">=</span><span class="n">batch_convert_video_format</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{}</span><span class="s1">&quot; -c:v h264_nvenc -cq 23 -preset:v medium -c:a copy &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">file_path</span><span class="p">,</span> <span class="n">save_path</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -y -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -c:v libx264 -crf 21 -preset medium -c:a libmp3lame -b:a 320k &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">video_timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> complete, (elapsed time: </span><span class="si">{</span><span class="n">video_timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="si">}</span><span class="s2">s) (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2">)...&quot;</span>
        <span class="p">)</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA COMPLETE: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">))</span><span class="si">}</span><span class="s2"> videos converted in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> directory!&quot;</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">batch_convert_video_format</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">)</span></div>


<span class="c1"># _ = batch_convert_video_format(directory=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/mouse_open_field/project_folder/videos/test_2&#39;,input_format=&#39;mp4&#39;, output_format=&#39;avi&#39;)</span>


<div class="viewcode-block" id="batch_create_frames"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.batch_create_frames">[docs]</a><span class="k">def</span> <span class="nf">batch_create_frames</span><span class="p">(</span><span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract all frames for all videos in a directory. Results are stored within sub-directories in the input</span>
<span class="sd">    directory named according to the video files.</span>

<span class="sd">    :parameter str directory: Path to directory containing video files.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = batch_create_frames(directory=&#39;project_folder/videos&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">NotDirectoryError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;SIMBA ERROR: </span><span class="si">{}</span><span class="s2"> is not a valid directory&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directory</span><span class="p">),</span>
            <span class="n">source</span><span class="o">=</span><span class="n">batch_create_frames</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">video_paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">file_paths_in_folder</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">directory</span> <span class="o">+</span> <span class="s2">&quot;/*&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_paths_in_folder</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.avi&quot;</span><span class="p">,</span> <span class="s2">&quot;.mp4&quot;</span><span class="p">,</span> <span class="s2">&quot;.mov&quot;</span><span class="p">,</span> <span class="s2">&quot;.flv&quot;</span><span class="p">]:</span>
            <span class="n">video_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;SIMBA ERROR: No files with .mp4, .avi, .mov, .flv file ending found in the </span><span class="si">{}</span><span class="s2"> directory&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">directory</span>
            <span class="p">),</span>
            <span class="n">source</span><span class="o">=</span><span class="n">batch_create_frames</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing video </span><span class="si">{}</span><span class="s2">...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
        <span class="n">video_to_frames</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">every</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Video </span><span class="si">{}</span><span class="s2"> complete, (Video </span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">)...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">file_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_cnt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">))</span><span class="si">}</span><span class="s2"> videos converted into frames in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> directory!&quot;</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">batch_create_frames</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="extract_frames_single_video"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.extract_frames_single_video">[docs]</a><span class="k">def</span> <span class="nf">extract_frames_single_video</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                                <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract all frames for a single video.</span>

<span class="sd">    .. note::</span>
<span class="sd">       Image frames are saved as PNG files named with integers in order of appearance, i.e., ``0.png, 1.png ...``</span>

<span class="sd">    :parameter Union[str, os.PathLike] file_path: Path to video file.</span>
<span class="sd">    :parameter Optional[Union[str, os.PathLike]] save_dir: Optional directory where to save the frames. If ``save_dir`` is not passed,</span>
<span class="sd">    results are stored within a subdirectory in the same directory as the input file.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = extract_frames_single_video(file_path=&#39;project_folder/videos/Video_1.mp4&#39;)</span>
<span class="sd">    &gt;&gt;&gt; extract_frames_single_video(file_path=&#39;/Users/simon/Desktop/imgs_4/test.mp4&#39;, save_dir=&#39;/Users/simon/Desktop/imgs_4/frames&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_dir</span><span class="p">):</span> <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">extract_frames_single_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">create_if_not_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="n">video_to_frames</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">every</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> converted to images in </span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s2"> directory!&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">extract_frames_single_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>


<span class="c1">#_ = extract_frames_single_video(file_path=&#39;/Users/simon/Desktop/video_test/Screen Recording 2024-05-06 at 1.23.31 PM_clipped.mp4&#39;)</span>


<div class="viewcode-block" id="multi_split_video"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.multi_split_video">[docs]</a><span class="k">def</span> <span class="nf">multi_split_video</span><span class="p">(</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">start_times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">end_times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">out_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">include_clip_time_in_filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Divide a video file into multiple video files from specified start and stop times.</span>

<span class="sd">    :parameter str file_path: Path to input video file.</span>
<span class="sd">    :parameter List[str] start_times: Start times in HH:MM:SS format.</span>
<span class="sd">    :parameter List[str] end_times: End times in HH:MM:SS format.</span>
<span class="sd">    :parameter Optional[Union[str, os.PathLike]] out_dir: If None, then the clips will be stored in the same dir as the input video. If directory, then the location of the output files.</span>
<span class="sd">    :parameter Optional[bool] include_clip_time_in_filename: If True, include the clip start and end in HH-MM-SS format as suffix in the filename. If False, then use integer suffic representing the count.</span>
<span class="sd">    :parameter Optional[bool] gpu: If True, use NVIDEA GPU codecs. Default False.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = multi_split_video(file_path=&#39;project_folder/videos/Video_1.mp4&#39;, start_times=[&#39;00:00:05&#39;, &#39;00:00:20&#39;], end_times=[&#39;00:00:10&#39;, &#39;00:00:25&#39;])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">out_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span>
        <span class="n">dir_name</span> <span class="o">=</span> <span class="n">out_dir</span>
    <span class="k">for</span> <span class="n">start_time_cnt</span><span class="p">,</span> <span class="n">start_time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">start_times</span><span class="p">):</span>
        <span class="n">check_if_string_value_is_valid_video_timestamp</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Start time for clip </span><span class="si">{</span><span class="n">start_time_cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">for</span> <span class="n">end_time_cnt</span><span class="p">,</span> <span class="n">end_time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">end_times</span><span class="p">):</span>
        <span class="n">check_if_string_value_is_valid_video_timestamp</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;End time for clip </span><span class="si">{</span><span class="n">end_time_cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">for</span> <span class="n">clip_cnt</span><span class="p">,</span> <span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">start_times</span><span class="p">,</span> <span class="n">end_times</span><span class="p">)):</span>
        <span class="n">check_that_hhmmss_start_is_before_end</span><span class="p">(</span>
            <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Clip </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">clip_cnt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">check_if_hhmmss_timestamp_is_valid_part_of_video</span><span class="p">(</span>
            <span class="n">timestamp</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">video_path</span><span class="o">=</span><span class="n">file_path</span>
        <span class="p">)</span>
        <span class="n">check_if_hhmmss_timestamp_is_valid_part_of_video</span><span class="p">(</span>
            <span class="n">timestamp</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span> <span class="n">video_path</span><span class="o">=</span><span class="n">file_path</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">include_clip_time_in_filename</span><span class="p">:</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot;_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">clip_cnt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;.mp4&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">dir_name</span><span class="p">,</span>
                <span class="n">file_name</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">start_time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">end_time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.mp4&#39;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FileExistError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;The outfile file already exist: </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">multi_split_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span>
                    <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;NVIDEA GPU not available (as evaluated by nvidea-smi returning None&quot;</span><span class="p">,</span>
                    <span class="n">source</span><span class="o">=</span><span class="n">multi_split_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{}</span><span class="s1">&quot; -ss </span><span class="si">{}</span><span class="s1"> -to </span><span class="si">{}</span><span class="s1"> -c:v h264_nvenc -async 1 &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">file_path</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">save_path</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -ss </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s1"> -to </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s1"> -async 1 &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing video clip </span><span class="si">{}</span><span class="s2">...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">clip_cnt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> converted into </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">start_times</span><span class="p">))</span><span class="si">}</span><span class="s2"> clips in directory </span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">,</span>
        <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">multi_split_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">)</span></div>


<span class="c1"># multi_split_video(file_path=r&#39;/Users/simon/Desktop/time_s_converted.mp4&#39;, start_times=[&#39;00:00:01&#39;, &#39;00:00:02&#39;], end_times=[&#39;00:00:04&#39;, &#39;00:00:05&#39;], gpu=False)</span>


<div class="viewcode-block" id="crop_single_video"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.crop_single_video">[docs]</a><span class="k">def</span> <span class="nf">crop_single_video</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span> <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crop a single video using ``simba.video_processors.roi_selector.ROISelector`` interface. Results is saved in the same directory as input video with the</span>
<span class="sd">    ``_cropped.mp4`` suffix`.</span>

<span class="sd">    .. image:: _static/img/crop_single_video.gif</span>
<span class="sd">       :width: 700</span>
<span class="sd">       :align: center</span>

<span class="sd">    :parameter str file_path: Path to video file.</span>
<span class="sd">    :parameter Optional[bool] gpu: If True, use NVIDEA GPU codecs. Default False.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = crop_single_video(file_path=&#39;project_folder/videos/Video_1.mp4&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;NVIDEA GPU not available (as evaluated by nvidea-smi returning None&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">crop_single_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">roi_selector</span> <span class="o">=</span> <span class="n">ROISelector</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">roi_selector</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">top_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">top_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">bottom_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">bottom_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="n">CountError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;CROP FAILED: Cannot use negative crop coordinates.&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">crop_multiple_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">_cropped.mp4&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">FileExistError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA ERROR: The out file  already exist: </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">crop_single_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;crop=</span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">width</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">height</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">top_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">top_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot; -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -y -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;crop=</span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">width</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">height</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">top_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">top_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot; -c:v libx264 -crf 17 -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> cropped and saved at </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">crop_single_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">)</span></div>


<span class="c1"># _ = crop_single_video(file_path=&#39;/Users/simon/Desktop/envs/troubleshooting/ARES_data/Termite Test 1/Termite Test 1.mp4&#39;)</span>

<span class="c1"># crop_single_video(file_path=r&#39;C:\Users\Nape_Computer_2\Desktop\test_videos\Box1_PM2_day_5_20211104T171021.mp4&#39;, gpu=False)</span>


<div class="viewcode-block" id="crop_multiple_videos"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.crop_multiple_videos">[docs]</a><span class="k">def</span> <span class="nf">crop_multiple_videos</span><span class="p">(</span>
    <span class="n">directory_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">output_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crop multiple videos in a folder according to crop-coordinates defined in the **first** video.</span>

<span class="sd">    :parameter str directory_path: Directory containing input videos.</span>
<span class="sd">    :parameter str output_path: Directory where to save the cropped videos.</span>
<span class="sd">    :parameter Optional[bool] gpu: If True, use NVIDEA GPU codecs. Default False.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = crop_multiple_videos(directory_path=&#39;project_folder/videos&#39;, output_path=&#39;project_folder/videos/my_new_folder&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;NVIDEA GPU not available (as evaluated by nvidea-smi returning None&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">crop_multiple_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">NotDirectoryError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;SIMBA ERROR: </span><span class="si">{}</span><span class="s2"> is not a valid directory&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directory_path</span><span class="p">),</span>
            <span class="n">source</span><span class="o">=</span><span class="n">crop_multiple_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">video_paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">file_paths_in_folder</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">directory_path</span> <span class="o">+</span> <span class="s2">&quot;/*&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_paths_in_folder</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Options</span><span class="o">.</span><span class="n">ALL_VIDEO_FORMAT_OPTIONS</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">video_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;SIMBA ERROR: No files with .mp4, .avi, .mov, .flv file ending found in the </span><span class="si">{}</span><span class="s2"> directory&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">directory_path</span>
            <span class="p">),</span>
            <span class="n">source</span><span class="o">=</span><span class="n">crop_multiple_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">roi_selector</span> <span class="o">=</span> <span class="n">ROISelector</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">file_paths_in_folder</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">roi_selector</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">width</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">roi_selector</span><span class="o">.</span><span class="n">height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">roi_selector</span><span class="o">.</span><span class="n">width</span>
        <span class="o">+</span> <span class="n">roi_selector</span><span class="o">.</span><span class="n">height</span>
        <span class="o">+</span> <span class="n">roi_selector</span><span class="o">.</span><span class="n">top_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="o">+</span> <span class="n">roi_selector</span><span class="o">.</span><span class="n">top_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">==</span> <span class="mi">0</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="n">CountError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;CROP FAILED: Cropping height and width are both 0. Please try again.&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">crop_multiple_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">top_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">top_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">bottom_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">bottom_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="n">CountError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;CROP FAILED: Cannot use negative crop coordinates.&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">crop_multiple_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">video_timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cropping video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">bottom_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">roi_selector</span><span class="o">.</span><span class="n">bottom_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Cannot crop video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1"> of size </span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;resolution_str&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> at location top left: </span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">top_left</span><span class="si">}</span><span class="s1">, bottom right: </span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">bottom_right</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">crop_multiple_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot;_cropped.mp4&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;crop=</span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">width</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">height</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">top_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">top_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot; -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;crop=</span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">width</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">height</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">top_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">roi_selector</span><span class="o">.</span><span class="n">top_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot; -c:v libx264 -crf 17 -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">video_timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> cropped (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2">, elapsed time: </span><span class="si">{</span><span class="n">video_timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">))</span><span class="si">}</span><span class="s2"> videos cropped and saved in </span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2"> directory&quot;</span><span class="p">,</span>
        <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">crop_multiple_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">)</span></div>


<span class="c1"># _ = crop_multiple_videos(directory_path=&#39;/Users/simon/Desktop/envs/troubleshooting/two_black_animals_14bp/videos&#39;, output_path=&#39;/Users/simon/Desktop/envs/troubleshooting/two_black_animals_14bp/test/test&#39;)</span>


<div class="viewcode-block" id="frames_to_movie"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.frames_to_movie">[docs]</a><span class="k">def</span> <span class="nf">frames_to_movie</span><span class="p">(</span><span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                    <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">quality</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">out_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;mp4&#39;</span><span class="p">,</span> <span class="s1">&#39;avi&#39;</span><span class="p">,</span> <span class="s1">&#39;webm&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;mp4&#39;</span><span class="p">,</span>
                    <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merge all image files in a folder to a mp4 video file. Video file is stored in the same directory as the</span>
<span class="sd">    input directory sub-folder.</span>

<span class="sd">    .. note::</span>
<span class="sd">       The Image files have to have ordered numerical names e.g., ``1.png``, ``2.png`` etc...</span>

<span class="sd">    :parameter str directory: Directory containing the images.</span>
<span class="sd">    :parameter int fps: The frame rate of the output video.</span>
<span class="sd">    :parameter int quality: Integer representing quatlity of the output video: 10, 20, 30.. 100. Higher values gives larger videos at higher quality. Higher values may negatively affect runtime.</span>
<span class="sd">    :parameter Optional[Literal[&#39;mp4&#39;, &#39;avi&#39;, &#39;webm&#39;, &#39;mov&#39;]] out_format: The format of the output video: &#39;mp4&#39;, &#39;avi&#39;, &#39;webm&#39;, or &#39;mov&#39;. Default: mp4.</span>
<span class="sd">    :parameter Optional[bool] gpu: If True, use NVIDEA GPU codecs. Default False.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; frames_to_movie(directory=&#39;/Users/simon/Desktop/blah&#39;, fps=60, quality=60, out_format=&#39;mp4&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">natural_sort_key</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="n">part</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)]</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;NVIDEA GPU not available (as evaluated by nvidea-smi returning None&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">frames_to_movie</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">frames_to_movie</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;out_format&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">out_format</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mp4&#39;</span><span class="p">,</span> <span class="s1">&#39;avi&#39;</span><span class="p">,</span> <span class="s1">&#39;webm&#39;</span><span class="p">])</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;FPS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;quality&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">quality</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">out_format</span> <span class="o">==</span> <span class="s1">&#39;webm&#39;</span><span class="p">:</span>
        <span class="n">codec</span> <span class="o">=</span> <span class="s1">&#39;libvpx-vp9&#39;</span>
    <span class="k">elif</span> <span class="n">out_format</span> <span class="o">==</span> <span class="s1">&#39;avi&#39;</span><span class="p">:</span>
        <span class="n">codec</span> <span class="o">=</span> <span class="s1">&#39;mpeg4&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">codec</span> <span class="o">=</span> <span class="s1">&#39;libx264&#39;</span>
    <span class="n">crf_lk</span> <span class="o">=</span> <span class="n">percent_to_crf_lookup</span><span class="p">()</span>
    <span class="n">crf</span> <span class="o">=</span> <span class="n">crf_lk</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">quality</span><span class="p">)]</span>
    <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">directory</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">out_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">img_paths</span> <span class="o">=</span> <span class="n">find_files_of_filetypes_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="n">Options</span><span class="o">.</span><span class="n">ALL_IMAGE_FORMAT_OPTIONS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sorted_filepaths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">img_paths</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">natural_sort_key</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">start_id</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">sorted_filepaths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -framerate </span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s1"> -start_number </span><span class="si">{</span><span class="n">start_id</span><span class="si">}</span><span class="s1"> -pattern_type glob -i &quot;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s1">/*.png&quot; -c:v </span><span class="si">{</span><span class="n">codec</span><span class="si">}</span><span class="s1"> -crf </span><span class="si">{</span><span class="n">crf</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -framerate </span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s1"> -start_number </span><span class="si">{</span><span class="n">start_id</span><span class="si">}</span><span class="s1"> -pattern_type glob -i &quot;$(ls -v </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s1">/*.png)&quot; -c:v h264_nvenc -crf </span><span class="si">{</span><span class="n">crf</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Video created at </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">frames_to_movie</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>


<div class="viewcode-block" id="video_concatenator"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.video_concatenator">[docs]</a><span class="k">def</span> <span class="nf">video_concatenator</span><span class="p">(</span><span class="n">video_one_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                       <span class="n">video_two_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                       <span class="n">resolution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;video 1&#39;</span><span class="p">,</span>
                       <span class="n">horizontal</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                       <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Concatenate two videos to a single video either horizontally or vertically</span>

<span class="sd">    .. image:: _static/img/horizontal_video_concatenator.gif</span>
<span class="sd">       :width: 1000</span>
<span class="sd">       :align: center</span>

<span class="sd">    .. video:: _static/img/vertical_concat.webm</span>
<span class="sd">       :width: 800</span>
<span class="sd">       :autoplay:</span>
<span class="sd">       :loop:</span>

<span class="sd">    :param str video_one_path: Path to the first video in the concatenated video</span>
<span class="sd">    :param str video_two_path: Path to the second video in the concatenated video</span>
<span class="sd">    :param int or str resolution: If str, then the name of the video which resolution you want to retain. E.g., `Video_1`. Else int, representing the video width (if vertical concat) or height (if horizontal concat). Aspect raio will be retained.</span>
<span class="sd">    :param horizontal: If true, then horizontal concatenation. Else vertical concatenation.</span>
<span class="sd">    :parameter Optional[bool] gpu: If True, use NVIDEA GPU codecs. Default False.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; video_concatenator(video_one_path=&#39;project_folder/videos/Video_1.mp4&#39;, video_two_path=&#39;project_folder/videos/Video_2.mp4&#39;, resolution=800, horizontal=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;NVIDEA GPU not available (as evaluated by nvidea-smi returning None&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">video_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_ffmpeg_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGNotFoundError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;FFMPEG not found on the computer. Install FFMPEG to use the concatenation method.&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">video_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="p">[</span><span class="n">video_one_path</span><span class="p">,</span> <span class="n">video_two_path</span><span class="p">]:</span>
        <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">check_instance</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">video_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">accepted_types</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;resolution&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">video_meta_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resolution</span>
        <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resolution</span>
    <span class="k">elif</span> <span class="n">resolution</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">is</span> <span class="s2">&quot;video 1&quot;</span><span class="p">:</span>
        <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_one_path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_two_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="nb">dir</span><span class="p">,</span> <span class="n">file_name_1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_one_path</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">file_name_2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_two_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Concatenating videos </span><span class="si">{</span><span class="n">file_name_1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">file_name_2</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name_1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_name_2</span><span class="si">}</span><span class="s2">_concat.mp4&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">horizontal</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -y -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">video_one_path</span><span class="si">}</span><span class="s1">&quot; -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">video_two_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[0:v]scale=-1:</span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">[v0];[v0][1:v]hstack=inputs=2&quot; -c:v h264_nvenc &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -hide_banner -loglevel error -stats -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ffmpeg -y -i &quot;</span><span class="si">{</span><span class="n">video_one_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">video_two_path</span><span class="si">}</span><span class="s1">&quot; &#39;</span>
                   <span class="sa">f</span><span class="s1">&#39;-filter_complex &quot;[0:v]scale=ceil(iw/2)*2:</span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">[v0];&#39;</span>
                   <span class="sa">f</span><span class="s1">&#39;[1:v]scale=ceil(iw/2)*2:</span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">[v1];&#39;</span>
                   <span class="sa">f</span><span class="s1">&#39;[v0][v1]hstack=inputs=2&quot; &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -hide_banner -loglevel error -stats -y&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -y -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">video_one_path</span><span class="si">}</span><span class="s1">&quot; -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">video_two_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[0:v]scale=</span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">:-1[v0];[v0][1:v]vstack=inputs=2&quot; -c:v h264_nvenc &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -hide_banner -loglevel error -stats -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ffmpeg -y -i &quot;</span><span class="si">{</span><span class="n">video_one_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">video_two_path</span><span class="si">}</span><span class="s1">&quot; &#39;</span>
                   <span class="sa">f</span><span class="s1">&#39;-filter_complex &quot;[0:v]scale=</span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">:-1[v0];&#39;</span>
                   <span class="sa">f</span><span class="s1">&#39;[1:v]scale=</span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">:-1[v1];&#39;</span>
                   <span class="sa">f</span><span class="s1">&#39;[v0][v1]vstack=inputs=2&quot; &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -hide_banner -loglevel error -stats -y&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;Unknown decoder&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;GPU codec not found: reverting to CPU. Properly configure FFMpeg and ensure you have GPU available or use CPU.&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">video_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;GPU error. Properly configure FFMpeg and ensure you have GPU available, or use CPU.&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">video_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Videos concatenated and saved at </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">video_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>


<span class="c1"># video_concatenator(video_one_path=r&#39;/Users/simon/Desktop/envs/simba/troubleshooting/mouse_open_field/project_folder/videos/SI_DAY3_308_CD1_PRESENT_downsampled.mp4&#39;,</span>
<span class="c1">#                    video_two_path=r&#39;/Users/simon/Desktop/envs/simba/troubleshooting/mouse_open_field/project_folder/videos/SI_DAY3_308_CD1_PRESENT_downsampled.mp4&#39;, resolution=&#39;Video_1&#39;,</span>
<span class="c1">#                    horizontal=True,</span>
<span class="c1">#                    gpu=False)</span>


<div class="viewcode-block" id="VideoRotator"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.VideoRotator">[docs]</a><span class="k">class</span> <span class="nc">VideoRotator</span><span class="p">(</span><span class="n">ConfigReader</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    GUI Tool for rotating video. Rotated video is saved with the ``_rotated_DATETIME.mp4`` suffix.</span>


<span class="sd">    .. image:: _static/img/VideoRotator.gif</span>
<span class="sd">       :width: 700</span>
<span class="sd">       :align: center</span>

<span class="sd">    :parameter str input_path: Path to video to rotate.</span>
<span class="sd">    :parameter str output_dir: Directory where to save the rotated video.</span>
<span class="sd">    :parameter Optional[bool] gpu: If True, use FFMPEG NVIDEA GPU codecs. Else CPU codecs.</span>
<span class="sd">    :parameter Optional[bool] gpu: If True, use FFPMPEG. Else, OpenCV.</span>




<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; VideoRotator(input_path=&#39;project_folder/videos/Video_1.mp4&#39;, output_dir=&#39;project_folder/videos&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
        <span class="n">output_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
        <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ffmpeg</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None)&quot;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">ffmpeg</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_ffmpeg_available</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">FFMPEGNotFoundError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;FFMPEG not found on the computer (as evaluated by &quot;ffmpeg&quot; returning None)&#39;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu_cnt</span> <span class="o">=</span> <span class="n">find_core_cnt</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gpu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ffmpeg</span> <span class="o">=</span> <span class="n">gpu</span><span class="p">,</span> <span class="n">ffmpeg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span> <span class="o">=</span> <span class="n">output_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">input_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">video_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">input_path</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">video_paths</span> <span class="o">=</span> <span class="n">find_all_videos_in_directory</span><span class="p">(</span>
                <span class="n">directory</span><span class="o">=</span><span class="n">input_path</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="n">check_if_filepath_list_is_empty</span><span class="p">(</span>
                <span class="n">filepaths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">video_paths</span><span class="p">,</span>
                <span class="n">error_msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;No videos found in </span><span class="si">{</span><span class="n">input_path</span><span class="si">}</span><span class="s2"> directory&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__insert_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
        <span class="n">current_frm_pil</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">current_frm_pil</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">(</span><span class="n">MAX_FRM_SIZE</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">ANTIALIAS</span><span class="p">)</span>
        <span class="n">current_frm_pil</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span>
            <span class="n">master</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_frm</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">current_frm_pil</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video_frame</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_frm</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">current_frm_pil</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video_frame</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">current_frm_pil</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dif_angle</span> <span class="o">+=</span> <span class="n">value</span>
        <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getRotationMatrix2D</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dif_angle</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span>
            <span class="n">img</span><span class="p">,</span>
            <span class="n">rotation_matrix</span><span class="p">,</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__insert_img</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">img</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__run_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_frm</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ffmpeg</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">video_cnt</span><span class="p">,</span> <span class="p">(</span><span class="n">video_path</span><span class="p">,</span> <span class="n">rotation</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
                <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_rotated_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="si">}</span><span class="s2">.mp4&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu</span><span class="p">:</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;hwupload_cuda,rotate=</span><span class="si">{</span><span class="n">rotation</span><span class="si">}</span><span class="s1">*(PI/180),format=nv12|cuda&quot; -c:v h264_nvenc &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -y&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;rotate=</span><span class="si">{</span><span class="n">rotation</span><span class="si">}</span><span class="s1">*(PI/180)&quot; &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -y&#39;</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">video_cnt</span><span class="p">,</span> <span class="p">(</span><span class="n">video_path</span><span class="p">,</span> <span class="n">rotation</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
                <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getRotationMatrix2D</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">rotation</span><span class="p">,</span>
                    <span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_rotated_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="si">}</span><span class="s2">.mp4&quot;</span>
                <span class="p">)</span>
                <span class="n">video_meta</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
                <span class="n">fourcc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter_fourcc</span><span class="p">(</span><span class="o">*</span><span class="n">Formats</span><span class="o">.</span><span class="n">MP4_CODEC</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">writer</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter</span><span class="p">(</span>
                    <span class="n">save_path</span><span class="p">,</span>
                    <span class="n">fourcc</span><span class="p">,</span>
                    <span class="n">video_meta</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">],</span>
                    <span class="p">(</span><span class="n">video_meta</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span> <span class="n">video_meta</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]),</span>
                <span class="p">)</span>
                <span class="n">img_cnt</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">ret</span><span class="p">,</span> <span class="n">img</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span>
                        <span class="n">img</span><span class="p">,</span>
                        <span class="n">rotation_matrix</span><span class="p">,</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]),</span>
                    <span class="p">)</span>
                    <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
                    <span class="n">img_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;Rotating frame </span><span class="si">{</span><span class="n">img_cnt</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">video_meta</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> (Video </span><span class="si">{</span><span class="n">video_cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s1">) &#39;</span>
                    <span class="p">)</span>
                <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">stdout_success</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;All videos rotated and saved in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">elapsed_time</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">),</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">process</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dif_angle</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video_paths</span><span class="p">):</span>
            <span class="n">process</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__run_rotation</span><span class="p">())</span>
            <span class="n">process</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__run_interface</span><span class="p">(</span>
                <span class="n">file_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">video_paths</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">process</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__bind_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_frm</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
            <span class="s2">&quot;&lt;Left&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rotate</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">img</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_orig_img</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_frm</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
            <span class="s2">&quot;&lt;Right&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rotate</span><span class="p">(</span><span class="n">value</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">img</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_orig_img</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_frm</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Escape&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__save</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__run_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dif_angle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
        <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_frm</span> <span class="o">=</span> <span class="n">Toplevel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_frm</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ROTATE VIDEO </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">video_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video_frm</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_frm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video_frm</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instruction_frm</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_frm</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instruction_frm</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">NW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key_lbls</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instruction_frm</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> Navigation: &quot;</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Left arrow = 1° left&quot;</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Right arrow = 1° right&quot;</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Esc = Save&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">key_lbls</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">sticky</span><span class="o">=</span><span class="n">NW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_RGB2BGR</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__insert_img</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_orig_img</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bind_keys</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_paths</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__run_interface</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_frm</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span></div>


<div class="viewcode-block" id="extract_frames_from_all_videos_in_directory"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.extract_frames_from_all_videos_in_directory">[docs]</a><span class="k">def</span> <span class="nf">extract_frames_from_all_videos_in_directory</span><span class="p">(</span><span class="n">config_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                                                <span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract all frames from all videos in a directory. The results are saved in the project_folder/frames/input directory of the SimBA project</span>

<span class="sd">    :parameter str config_path: path to SimBA project config file in Configparser format.</span>
<span class="sd">    :parameter str directory: path to file or folder containing videos in mp4 and/or avi format.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; extract_frames_from_all_videos_in_directory(config_path=&#39;project_folder/project_config.ini&#39;, source=&#39;/tests/test_data/video_tests&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">video_paths</span> <span class="o">=</span> <span class="n">find_all_videos_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">video_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">video_paths</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">read_config_file</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span>
    <span class="n">project_path</span> <span class="o">=</span> <span class="n">read_config_entry</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;General settings&quot;</span><span class="p">,</span> <span class="s2">&quot;project_path&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;folder_path&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extracting frames for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> video(s) into project_folder/frames/input directory...&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="n">video_paths</span><span class="p">:</span>
        <span class="n">dir_name</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;frames&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">video_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frames for video </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2"> already extracted. SimBA is overwriting prior frames...&quot;</span><span class="p">)</span>
        <span class="n">video_to_frames</span><span class="p">(</span><span class="n">video_path</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">every</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frames created for </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">))</span><span class="si">}</span><span class="s2"> videos&quot;</span><span class="p">,</span><span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">extract_frames_from_all_videos_in_directory</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>


<div class="viewcode-block" id="copy_img_folder"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.copy_img_folder">[docs]</a><span class="k">def</span> <span class="nf">copy_img_folder</span><span class="p">(</span>
    <span class="n">config_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span> <span class="n">source</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Copy directory of png files to the SimBA project. The directory is stored in the project_folder/frames/input folder of the SimBA project</span>

<span class="sd">    :parameter str config_path: path to SimBA project config file in Configparser format.</span>
<span class="sd">    :parameter str source: path to image folder outside SimBA project.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; copy_img_folder(config_path=&#39;MySimBAprojectConfig&#39;, source=&#39;/DirectoryWithVideos/&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">NotDirectoryError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA ERROR: source </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2"> is not a directory.&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">copy_img_folder</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">source</span> <span class="o">+</span> <span class="s2">&quot;/*.png&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA ERROR: source </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2"> does not contain any .png files.&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">copy_img_folder</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">input_basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">read_config_file</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span>
    <span class="n">project_path</span> <span class="o">=</span> <span class="n">read_config_entry</span><span class="p">(</span>
        <span class="n">config</span><span class="p">,</span>
        <span class="n">ConfigKey</span><span class="o">.</span><span class="n">GENERAL_SETTINGS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">ConfigKey</span><span class="o">.</span><span class="n">PROJECT_PATH</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;folder_path&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">input_frames_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_path</span><span class="p">,</span> <span class="n">Paths</span><span class="o">.</span><span class="n">INPUT_FRAMES_DIR</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">destination</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_frames_dir</span><span class="p">,</span> <span class="n">input_basename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">destination</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DirectoryExistError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA ERROR: </span><span class="si">{</span><span class="n">destination</span><span class="si">}</span><span class="s2"> already exist in SimBA project.&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">copy_img_folder</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Importing image files for </span><span class="si">{</span><span class="n">input_basename</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">destination</span><span class="si">}</span><span class="s2"> imported to SimBA project&quot;</span><span class="p">,</span>
        <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">copy_img_folder</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="append_audio"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.append_audio">[docs]</a><span class="k">def</span> <span class="nf">append_audio</span><span class="p">(</span>
    <span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">audio_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">audio_src_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="s2">&quot;audio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;video&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Append audio track from one video to another video without an audio track.</span>

<span class="sd">    :param Union[str, os.PathLike] video_one_path: Path to video file without audio track.</span>
<span class="sd">    :param Union[str, os.PathLike] audio_path: Path to file (e.g., video) with audio track.</span>
<span class="sd">    :param Literal[&#39;video&#39;, &#39;audio&#39;] audio_src_type: Type of audio source of &quot;video_two_path&quot; (e.g., video or audio file).</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; append_audio(video_path=&#39;/Users/simon/Desktop/envs/troubleshooting/two_black_animals_14bp/project_folder/videos/merged_video_20230425201637.mp4&#39;,</span>
<span class="sd">    &gt;&gt;&gt; audio_path=&quot;/Users/simon/Documents/Zoom/ddd/video1180732233.mp4&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_ffmpeg_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGNotFoundError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;FFMpeg not found on computer. See SimBA docs for install instructions.&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">append_audio</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">audio_path</span><span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">audio_src_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">audio_path</span><span class="p">)</span>
    <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">video_path</span><span class="p">),</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">video_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_w_audio.mp4&quot;</span>
    <span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;ffprobe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
        <span class="s2">&quot;error&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-select_streams&quot;</span><span class="p">,</span>
        <span class="s2">&quot;a:0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-show_entries&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stream=codec_name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-of&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default=noprint_wrappers=1:nokey=1&quot;</span><span class="p">,</span>
        <span class="n">audio_path</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">track_type</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
            <span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoDataError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;No audio track found in file </span><span class="si">{</span><span class="n">audio_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">append_audio</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">audio_src_meta_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">]:</span>
        <span class="n">InValidUserInputWarning</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The video (</span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">) and audio source (</span><span class="si">{</span><span class="n">audio_src_meta_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">) does not have an equal number of frames.&#39;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">append_audio</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">audio_path</span><span class="si">}</span><span class="s1">&quot; -c:v copy -map 0:v:0 -map 1:a:0 &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -y&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Audio merged successfully, file saved at </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">append_audio</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="crop_single_video_circle"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.crop_single_video_circle">[docs]</a><span class="k">def</span> <span class="nf">crop_single_video_circle</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crop a video based on circular regions of interest (ROIs) selected by the user.</span>

<span class="sd">    .. image:: _static/img/crop_single_video_circle.gif</span>
<span class="sd">       :width: 600</span>
<span class="sd">       :align: center</span>
<span class="sd">    .. note::</span>
<span class="sd">       This function crops the input video based on circular regions of interest (ROIs) selected by the user.</span>
<span class="sd">       The user is prompted to select a circular ROI on the video frame, and the function then crops the video</span>
<span class="sd">       based on the selected ROI. The cropped video is saved with &quot;_circle_cropped&quot; suffix in the same directory</span>
<span class="sd">       as the input video file.</span>

<span class="sd">    :param  Union[str, os.PathLike] file_path: The path to the input video file.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; crop_single_video_circle(file_path=&#39;/Users/simon/Desktop/AGGRESSIVITY_4_11_21_Trial_2_camera1_rotated_20240211143355.mp4&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">dir</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2">_circle_cropped.mp4&quot;</span><span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">circle_selector</span> <span class="o">=</span> <span class="n">ROISelectorCircle</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">circle_selector</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">circle_selector</span><span class="o">.</span><span class="n">circle_radius</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">circle_selector</span><span class="o">.</span><span class="n">circle_center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">circle_selector</span><span class="o">.</span><span class="n">circle_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="n">x</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">y</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)])</span>
    <span class="n">polygons</span> <span class="o">=</span> <span class="p">[</span><span class="n">polygon</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">])]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">get_start_method</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">multiprocessing</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">polygons</span> <span class="o">=</span> <span class="n">ImageMixin</span><span class="p">()</span><span class="o">.</span><span class="n">slice_shapes_in_imgs</span><span class="p">(</span><span class="n">imgs</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">polygons</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">ImageMixin</span><span class="o">.</span><span class="n">img_stack_to_video</span><span class="p">(</span><span class="n">imgs</span><span class="o">=</span><span class="n">polygons</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">])</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Circle-based cropped saved at to </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,)</span></div>


<div class="viewcode-block" id="crop_multiple_videos_circles"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.crop_multiple_videos_circles">[docs]</a><span class="k">def</span> <span class="nf">crop_multiple_videos_circles</span><span class="p">(</span><span class="n">in_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span> <span class="n">out_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crop multiple videos based on circular regions of interest (ROIs) selected by the user.</span>


<span class="sd">    .. image:: _static/img/crop_single_video_circle.gif</span>
<span class="sd">       :width: 600</span>
<span class="sd">       :align: center</span>

<span class="sd">    .. note::</span>
<span class="sd">       This function crops multiple videos based on circular ROIs selected by the user.</span>
<span class="sd">       The user is asked to define a circle manually in one video within the input directory.</span>
<span class="sd">       The function then crops all the video in the input directory according to the shape defined</span>
<span class="sd">       using the first video and saves the videos in the ``out_dir`` with the same filenames as the original videos..</span>



<span class="sd">    :param  Union[str, os.PathLike] in_dir: The directory containing input video files.</span>
<span class="sd">    :param  Union[str, os.PathLike] out_dir: The directory to save the cropped video files.</span>


<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; crop_multiple_videos_circles(in_dir=&#39;/Users/simon/Desktop/edited/tests&#39;, out_dir=&#39;/Users/simon/Desktop&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">in_dir</span><span class="p">)</span>
    <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">out_dir</span><span class="p">)</span>
    <span class="n">video_files</span> <span class="o">=</span> <span class="n">find_all_videos_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">in_dir</span><span class="p">)</span>
    <span class="n">circle_selector</span> <span class="o">=</span> <span class="n">ROISelectorCircle</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">in_dir</span><span class="p">,</span> <span class="n">video_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">circle_selector</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">circle_selector</span><span class="o">.</span><span class="n">circle_radius</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">circle_selector</span><span class="o">.</span><span class="n">circle_center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">circle_selector</span><span class="o">.</span><span class="n">circle_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">y</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">get_start_method</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">multiprocessing</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">video_cnt</span><span class="p">,</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_files</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Circle cropping video </span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">video_cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_files</span><span class="p">)</span><span class="si">}</span><span class="s2">)...&quot;</span>
        <span class="p">)</span>
        <span class="n">video_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">in_dir</span><span class="p">,</span> <span class="n">video_path</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2">.mp4&quot;</span><span class="p">)</span>
        <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
        <span class="n">polygons</span> <span class="o">=</span> <span class="p">[</span><span class="n">polygon</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">])]</span>
        <span class="n">polygons</span> <span class="o">=</span> <span class="n">ImageMixin</span><span class="p">()</span><span class="o">.</span><span class="n">slice_shapes_in_imgs</span><span class="p">(</span>
            <span class="n">imgs</span><span class="o">=</span><span class="n">video_path</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">polygons</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">ImageMixin</span><span class="o">.</span><span class="n">img_stack_to_video</span><span class="p">(</span>
            <span class="n">imgs</span><span class="o">=</span><span class="n">polygons</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Circle-based cropped </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> files to directory </span><span class="si">{</span><span class="n">out_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="crop_single_video_polygon"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.crop_single_video_polygon">[docs]</a><span class="k">def</span> <span class="nf">crop_single_video_polygon</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crop a video based on polygonal regions of interest (ROIs) selected by the user.</span>

<span class="sd">    .. image:: _static/img/roi_selector_polygon.gif</span>
<span class="sd">       :width: 400</span>
<span class="sd">       :align: center</span>

<span class="sd">    :param  Union[str, os.PathLike] file_path: The path to the input video file.</span>

<span class="sd">    .. note::</span>
<span class="sd">       This function crops the input video based on polygonal regions of interest (ROIs) selected by the user.</span>
<span class="sd">       The user is prompted to select a polygonal ROI on the video frame, and the function then crops the video</span>
<span class="sd">       based on the selected ROI. The cropped video is saved with &quot;_polygon_cropped&quot; suffix in the same directory</span>
<span class="sd">       as the input video file.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; crop_single_video_polygon(file_path=&#39;/Users/simon/Desktop/AGGRESSIVITY_4_11_21_Trial_2_camera1_rotated_20240211143355.mp4&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">dir</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2">_polygon_cropped.mp4&quot;</span><span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">polygon_selector</span> <span class="o">=</span> <span class="n">ROISelectorPolygon</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">polygon_selector</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">polygon_selector</span><span class="o">.</span><span class="n">polygon_vertices</span>
    <span class="n">polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
    <span class="n">polygons</span> <span class="o">=</span> <span class="p">[</span><span class="n">polygon</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">])]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">get_start_method</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">multiprocessing</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">polygons</span> <span class="o">=</span> <span class="n">ImageMixin</span><span class="p">()</span><span class="o">.</span><span class="n">slice_shapes_in_imgs</span><span class="p">(</span>
        <span class="n">imgs</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">polygons</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">ImageMixin</span><span class="o">.</span><span class="n">img_stack_to_video</span><span class="p">(</span>
        <span class="n">imgs</span><span class="o">=</span><span class="n">polygons</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Polygon-based cropped saved at to </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span>
    <span class="p">)</span></div>

<span class="c1">#crop_single_video_polygon(file_path=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/spontenous_alternation/project_folder/videos/F1 HAB.mp4&#39;)</span>

<div class="viewcode-block" id="crop_multiple_videos_polygons"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.crop_multiple_videos_polygons">[docs]</a><span class="k">def</span> <span class="nf">crop_multiple_videos_polygons</span><span class="p">(</span>
    <span class="n">in_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span> <span class="n">out_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crop multiple videos based on polygonal regions of interest (ROIs) selected by the user.</span>

<span class="sd">    :param  Union[str, os.PathLike] in_dir: The directory containing input video files.</span>
<span class="sd">    :param  Union[str, os.PathLike] out_dir: The directory to save the cropped video files.</span>

<span class="sd">    .. note::</span>
<span class="sd">       This function crops multiple videos based on polygonal ROIs selected by the user.</span>
<span class="sd">       The user is asked to define a polygon manually in one video within the input directory.</span>
<span class="sd">       The function then crops all the video in the input directory according to the shape defined</span>
<span class="sd">       using the first video and saves the videos in the ``out_dir`` with the same filenames as the original videos..</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; crop_multiple_videos_polygons(in_dir=&#39;/Users/simon/Desktop/edited/tests&#39;, out_dir=&#39;/Users/simon/Desktop&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">in_dir</span><span class="p">)</span>
    <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">out_dir</span><span class="p">)</span>
    <span class="n">video_files</span> <span class="o">=</span> <span class="n">find_all_videos_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">in_dir</span><span class="p">)</span>
    <span class="n">polygon_selector</span> <span class="o">=</span> <span class="n">ROISelectorPolygon</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">in_dir</span><span class="p">,</span> <span class="n">video_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">polygon_selector</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">polygon_selector</span><span class="o">.</span><span class="n">polygon_vertices</span>
    <span class="n">polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">video_cnt</span><span class="p">,</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_files</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Polygon cropping video </span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">video_cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_files</span><span class="p">)</span><span class="si">}</span><span class="s2">)...&quot;</span>
        <span class="p">)</span>
        <span class="n">video_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">in_dir</span><span class="p">,</span> <span class="n">video_path</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2">.mp4&quot;</span><span class="p">)</span>
        <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
        <span class="n">polygons</span> <span class="o">=</span> <span class="p">[</span><span class="n">polygon</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">])]</span>
        <span class="n">polygons</span> <span class="o">=</span> <span class="n">ImageMixin</span><span class="p">()</span><span class="o">.</span><span class="n">slice_shapes_in_imgs</span><span class="p">(</span>
            <span class="n">imgs</span><span class="o">=</span><span class="n">video_path</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">polygons</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">ImageMixin</span><span class="o">.</span><span class="n">img_stack_to_video</span><span class="p">(</span>
            <span class="n">imgs</span><span class="o">=</span><span class="n">polygons</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Polygon-based cropped </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> files to directory </span><span class="si">{</span><span class="n">out_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="resize_videos_by_height"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.resize_videos_by_height">[docs]</a><span class="k">def</span> <span class="nf">resize_videos_by_height</span><span class="p">(</span><span class="n">video_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]],</span>
                            <span class="n">height</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
                            <span class="n">overwrite</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">suffix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Re-size a list of videos to a specified height while retaining their aspect ratios.</span>

<span class="sd">    :param List[Union[str, os.PathLike]] video_paths: List of path to videos.</span>
<span class="sd">    :param Union[int, str] height: The height of the output videos. If int, then the height in pixels. If str, then the index in ``video_paths`` from which to grab the height.</span>
<span class="sd">    :param Optional[bool] overwrite: If True, then overwrites the original videos. Default False.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_dir: If not None, then the directory where to store the re-sized videos.</span>
<span class="sd">    :param Optional[bool] gpu: If True, then use FFmpeg GPU codecs. Default False.</span>
<span class="sd">    :param Optional[bool] suffix: If not None, then stores the resized videos in the same directory as the input videos with the provided suffix.</span>
<span class="sd">    :param Optional[bool] verbose: If True, prints progress. Default True.</span>
<span class="sd">    :return Union[None, List[Union[str, os.PathLike]]]: If save_dir is not None, returns the paths of the re-sized videos. Else returns empty list.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; video_paths= [&#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/08102021_DOT_Rat7_8(2).mp4&#39;, &#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/08102021_DOT_Rat11_12.mp4&#39;]</span>
<span class="sd">    &gt;&gt;&gt; _ = resize_videos_by_height(video_paths=video_paths, height=300, overwrite=False, save_dir=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/new&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">overwrite</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Provide a save_dir, OR set overwrite to True, OR provide a suffix&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">resize_videos_by_height</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">overwrite</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Provide a save_dir, OR set overwrite to True, OR provide a suffix&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">resize_videos_by_height</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">overwrite</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">suffix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Provide a save_dir, OR set overwrite to True, OR provide a suffix&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">resize_videos_by_height</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">suffix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Provide a save_dir, OR set overwrite to True, OR provide a suffix&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">resize_videos_by_height</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="n">check_valid_lst</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">video_paths</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">resize_videos_by_height</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">video_paths</span><span class="p">]</span>
    <span class="n">new_video_paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">resize_videos_by_height</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> height&quot;</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">height</span><span class="p">,</span><span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">max_value</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">))</span>
        <span class="n">video_heights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">video_paths</span><span class="p">:</span>
            <span class="n">video_heights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">i</span><span class="p">)[</span><span class="s2">&quot;height&quot;</span><span class="p">])</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">video_heights</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">height</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">dir_name</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resizing height video </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2"> (Video </span><span class="si">{</span><span class="n">cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2">)...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dt</span><span class="si">}</span><span class="s2">.mp4&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2">.mp4&quot;</span><span class="p">)</span>
            <span class="n">new_video_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">resize_videos_by_height</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> suffix&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">.mp4&quot;</span><span class="p">)</span>
            <span class="n">new_video_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -y -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf scale_npp=-2:</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s1"> -c:v h264_nvenc &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -hide_banner -loglevel error -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -y -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf scale=-2:</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -hide_banner -loglevel error -stats -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">video_path</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resized video </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resized height </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> video(s). Elapsed time: </span><span class="si">{</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="si">}</span><span class="s2">s.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_video_paths</span></div>


<div class="viewcode-block" id="resize_videos_by_width"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.resize_videos_by_width">[docs]</a><span class="k">def</span> <span class="nf">resize_videos_by_width</span><span class="p">(</span><span class="n">video_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]],</span>
                           <span class="n">width</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
                           <span class="n">overwrite</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                           <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                           <span class="n">suffix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Re-size a list of videos to a specified width while retaining their aspect ratios.</span>

<span class="sd">    :param List[Union[str, os.PathLike]] video_paths: List of path to videos.</span>
<span class="sd">    :param Union[int, str] width: The width of the output videos. If int, then the width in pixels. If str, then the index in ``video_paths`` from which to grab the width.</span>
<span class="sd">    :param Optional[bool] overwrite: If True, then overwrites the original videos. Default False.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_dir: If not None, then the directory where to store the re-sized videos.</span>
<span class="sd">    :param Optional[bool] gpu: If True, then use FFmpeg GPU codecs. Default False.</span>
<span class="sd">    :param Optional[bool] suffix: If not None, then stores the resized videos in the same directory as the input videos with the provided suffix.</span>
<span class="sd">    :param Optional[bool] verbose: If True, prints progress. Default True.</span>
<span class="sd">    :return Union[None, List[Union[str, os.PathLike]]]: If save_dir is not None, returns the paths of the re-sized videos. Else returns empty list.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; video_paths= [&#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/08102021_DOT_Rat7_8(2).mp4&#39;, &#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/08102021_DOT_Rat11_12.mp4&#39;]</span>
<span class="sd">    &gt;&gt;&gt; _ = resize_videos_by_width(video_paths=video_paths, width=300, overwrite=False, save_dir=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/new&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">overwrite</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Provide a save_dir, OR set overwrite to True, OR provide a suffix&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">resize_videos_by_width</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">overwrite</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Provide a save_dir, OR set overwrite to True, OR provide a suffix&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">resize_videos_by_width</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">overwrite</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">suffix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Provide a save_dir, OR set overwrite to True, OR provide a suffix&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">resize_videos_by_width</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">suffix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Provide a save_dir, OR set overwrite to True, OR provide a suffix&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">resize_videos_by_width</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="n">check_valid_lst</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">video_paths</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">resize_videos_by_width</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">video_paths</span><span class="p">]</span>
    <span class="n">new_video_paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">check_int</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">resize_videos_by_width</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> height&quot;</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">max_value</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">video_widths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">video_paths</span><span class="p">:</span>
            <span class="n">video_widths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">i</span><span class="p">)[</span><span class="s2">&quot;width&quot;</span><span class="p">])</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">video_widths</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">width</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">dir_name</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Resizing width video </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2"> (Video </span><span class="si">{</span><span class="n">cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2">)...&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dt</span><span class="si">}</span><span class="s2">.mp4&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2">.mp4&quot;</span><span class="p">)</span>
            <span class="n">new_video_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">resize_videos_by_width</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> suffix&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">.mp4&quot;</span><span class="p">)</span>
            <span class="n">new_video_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -y -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf scale_npp=</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s1">:-2 -c:v h264_nvenc &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -hide_banner -loglevel error -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -y -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf scale=</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s1">:-2 &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -hide_banner -loglevel error -stats -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>

            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">video_path</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resized video </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resized width </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> video(s). Elapsed time: </span><span class="si">{</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="si">}</span><span class="s2">s.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_video_paths</span></div>


<div class="viewcode-block" id="create_blank_video"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.create_blank_video">[docs]</a><span class="k">def</span> <span class="nf">create_blank_video</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                       <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                       <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                       <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                       <span class="n">color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
                       <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a &quot;blank&quot; uni-colored video of specified size and length.</span>

<span class="sd">    .. note::</span>
<span class="sd">       Useful for when creating image mosaics with un-even number of videos and need a &quot;fill&quot; video in e.g. black color.</span>

<span class="sd">    :param Union[str, os.PathLike] path: Location where to store the blank video.</span>
<span class="sd">    :param int length: Length of the blank video in seconds.</span>
<span class="sd">    :param int width: Width of the blank video in pixels.</span>
<span class="sd">    :param int height: Height of the blank video in pixels.</span>
<span class="sd">    :param Optional[str] color: Color of the blank video. Default black.</span>
<span class="sd">    :param Optional[bool] gpu: If True, then use FFmpeg GPU codecs. Default False.</span>
<span class="sd">    :param Optional[bool] verbose: If True, prints progress. Default True.</span>
<span class="sd">    :return: None.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; _ = create_blank_video(path=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/new/blank_test.mp4&#39;, length=5, width=300, height=400, gpu=False, verbose=True, color=&#39;orange&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">create_blank_video</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> length&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">create_blank_video</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> width&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">create_blank_video</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> height&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">check_if_dir_exists</span><span class="p">(</span>
        <span class="n">in_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span>
        <span class="n">source</span><span class="o">=</span><span class="n">create_blank_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="n">create_if_not_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating blank video...&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -y -t </span><span class="si">{</span><span class="n">length</span><span class="si">}</span><span class="s1"> -f lavfi -i color=c=</span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s1">:s=</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s1">x</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s1"> -c:v h264_nvenc -preset slow -tune stillimage -pix_fmt yuv420p &quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&quot; -hide_banner -loglevel error -y&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -y -t </span><span class="si">{</span><span class="n">length</span><span class="si">}</span><span class="s1"> -f lavfi -i color=c=</span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s1">:s=</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s1">x</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s1"> -c:v libx264 -tune stillimage -pix_fmt yuv420p &quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&quot; -hide_banner -loglevel error -y&#39;</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Blank video complete. Saved at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">. Elapsed time: </span><span class="si">{</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="si">}</span><span class="s2">s.&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="horizontal_video_concatenator"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.horizontal_video_concatenator">[docs]</a><span class="k">def</span> <span class="nf">horizontal_video_concatenator</span><span class="p">(</span>
    <span class="n">video_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]],</span>
    <span class="n">save_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">height_px</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">height_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Concatenates multiple videos horizontally.</span>

<span class="sd">    .. image:: _static/img/horizontal_video_concatenator.gif</span>
<span class="sd">       :width: 1000</span>
<span class="sd">       :align: center</span>

<span class="sd">    :param List[Union[str, os.PathLike]] video_paths: List of input video file paths.</span>
<span class="sd">    :param Union[str, os.PathLike] save_path: File path to save the concatenated video.</span>
<span class="sd">    :param Optional[int] height_px: Height of the output video in pixels.</span>
<span class="sd">    :param Optional[int] height_idx: Index of the video to use for determining Height.</span>
<span class="sd">    :param Optional[bool] gpu: Whether to use GPU-accelerated codec (default: False).</span>
<span class="sd">    :param Optional[bool] verbose:Whether to print progress messages (default: True).</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; video_paths = [&#39;video1.mp4&#39;, &#39;video2.mp4&#39;]</span>
<span class="sd">    &gt;&gt;&gt; x = horizontal_video_concatenator(video_paths=video_paths, height_px=50, save_path=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/new/08102021_DOT_Rat7_8(2)_.mp4&#39;, gpu=False)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_ffmpeg_available</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;NVIDEA GPU not available (as evaluated by nvidea-smi returning None)&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">horizontal_video_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_valid_lst</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">video_paths</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">horizontal_video_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
    <span class="n">check_if_dir_exists</span><span class="p">(</span>
        <span class="n">in_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">save_path</span><span class="p">),</span> <span class="n">source</span><span class="o">=</span><span class="n">horizontal_video_concatenator</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="n">video_paths</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">height_px</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">height_idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">height_px</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">height_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Provide a height_px OR height_idx&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">horizontal_video_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">height_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_int</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">horizontal_video_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> height&quot;</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">height_idx</span><span class="p">,</span>
            <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">max_value</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">video_meta_data</span><span class="p">[</span><span class="n">height_idx</span><span class="p">][</span><span class="s2">&quot;height&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">check_int</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">horizontal_video_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> height&quot;</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">height_px</span><span class="p">,</span>
            <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">height_px</span><span class="p">)</span>
    <span class="n">video_path_str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;-i &quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&quot;&#39;</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">video_paths</span><span class="p">])</span>
    <span class="n">codec</span> <span class="o">=</span> <span class="s2">&quot;h264_nvenc&quot;</span> <span class="k">if</span> <span class="n">gpu</span> <span class="k">else</span> <span class="s2">&quot;libvpx-vp9&quot;</span>
    <span class="n">filter_complex</span> <span class="o">=</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">:v]scale=-1:</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s2">[v</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">]&quot;</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">))]</span>
    <span class="p">)</span>
    <span class="n">filter_complex</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;[v</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">]&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">))])</span><span class="si">}</span><span class="s2">hstack=inputs=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2">[v]&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Concatenating </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> videos horizontally with a </span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s2"> pixel height... &quot;</span>
        <span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg </span><span class="si">{</span><span class="n">video_path_str</span><span class="si">}</span><span class="s1"> -filter_complex &quot;</span><span class="si">{</span><span class="n">filter_complex</span><span class="si">}</span><span class="s1">&quot; -map &quot;[v]&quot; -c:v </span><span class="si">{</span><span class="n">codec</span><span class="si">}</span><span class="s1"> -loglevel error -stats &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -y&#39;</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Horizontal concatenation complete, saved at </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2"> (elapsed time: </span><span class="si">{</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="si">}</span><span class="s2">s.)&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="vertical_video_concatenator"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.vertical_video_concatenator">[docs]</a><span class="k">def</span> <span class="nf">vertical_video_concatenator</span><span class="p">(</span>
    <span class="n">video_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]],</span>
    <span class="n">save_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">width_px</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">width_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Concatenates multiple videos vertically.</span>

<span class="sd">    .. image:: _static/img/vertical_video_concatenator.png</span>
<span class="sd">       :width: 300</span>
<span class="sd">       :align: center</span>

<span class="sd">    :param List[Union[str, os.PathLike]] video_paths: List of input video file paths.</span>
<span class="sd">    :param Union[str, os.PathLike] save_path: File path to save the concatenated video.</span>
<span class="sd">    :param Optional[int] width_px: Width of the output video in pixels.</span>
<span class="sd">    :param Optional[int] width_idx: Index of the video to use for determining width.</span>
<span class="sd">    :param Optional[bool] gpu: Whether to use GPU-accelerated codec (default: False).</span>
<span class="sd">    :param Optional[bool] verbose:Whether to print progress messages (default: True).</span>
<span class="sd">    :raises FFMPEGCodecGPUError: If GPU is requested but not available.</span>
<span class="sd">    :raises InvalidInputError: If both or neither width_px and width_idx are provided.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; video_paths = [&#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/08102021_DOT_Rat7_8(2).mp4&#39;,</span>
<span class="sd">    &gt;&gt;&gt;                &#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/08102021_DOT_Rat11_12.mp4&#39;,</span>
<span class="sd">    &gt;&gt;&gt;                &#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/08102021_DOT_Rat11_12_1.mp4&#39;]</span>
<span class="sd">    &gt;&gt;&gt; _ = vertical_video_concatenator(video_paths=video_paths, width_idx=1, save_path=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/new/08102021_DOT_Rat7_8(2)_.mp4&#39;, gpu=False)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;NVIDIA GPU not available&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">vertical_video_concatenator</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="n">video_paths</span>
    <span class="p">]</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_valid_lst</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">video_paths</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">vertical_video_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
    <span class="n">check_if_dir_exists</span><span class="p">(</span>
        <span class="n">in_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">save_path</span><span class="p">),</span> <span class="n">source</span><span class="o">=</span><span class="n">vertical_video_concatenator</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">width_px</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">width_idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">width_px</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">width_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Provide a width_px OR width_idx&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">vertical_video_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">width_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_int</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">vertical_video_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> width index&quot;</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">width_idx</span><span class="p">,</span>
            <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">max_value</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">video_meta_data</span><span class="p">[</span><span class="n">width_idx</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">check_int</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">vertical_video_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> width&quot;</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">width_px</span><span class="p">,</span>
            <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">width_px</span><span class="p">)</span>
    <span class="n">video_path_str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;-i &quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&quot;&#39;</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">video_paths</span><span class="p">])</span>
    <span class="n">codec</span> <span class="o">=</span> <span class="s2">&quot;h264_nvenc&quot;</span> <span class="k">if</span> <span class="n">gpu</span> <span class="k">else</span> <span class="s2">&quot;libvpx-vp9&quot;</span>
    <span class="n">filter_complex</span> <span class="o">=</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">:v]scale=</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">:-1[v</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">]&quot;</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">))]</span>
    <span class="p">)</span>
    <span class="n">filter_complex</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;[v</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">]&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">))])</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">filter_complex</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;vstack=inputs=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2">[v]&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Concatenating </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> videos vertically with a </span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2"> pixel width...&quot;</span>
        <span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg </span><span class="si">{</span><span class="n">video_path_str</span><span class="si">}</span><span class="s1"> -filter_complex &quot;</span><span class="si">{</span><span class="n">filter_complex</span><span class="si">}</span><span class="s1">&quot; -map &quot;[v]&quot; -c:v </span><span class="si">{</span><span class="n">codec</span><span class="si">}</span><span class="s1"> -loglevel error -stats &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -y&#39;</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Vertical concatenation complete. Saved at </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2"> (Elapsed time: </span><span class="si">{</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="si">}</span><span class="s2">s.)&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="mosaic_concatenator"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.mosaic_concatenator">[docs]</a><span class="k">def</span> <span class="nf">mosaic_concatenator</span><span class="p">(</span>
    <span class="n">video_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]],</span>
    <span class="n">save_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">width_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">width_px</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">height_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">height_px</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">uneven_fill_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Concatenates multiple videos into a mosaic layout.</span>

<span class="sd">    .. image:: _static/img/mosaic_concatenator.png</span>
<span class="sd">       :width: 600</span>
<span class="sd">       :align: center</span>

<span class="sd">    .. note::</span>
<span class="sd">       if an uneven number of videos, the last index will be filled by ``uneven_fill_color``.</span>

<span class="sd">    :param List[Union[str, os.PathLike]] video_paths: List of input video file paths.</span>
<span class="sd">    :param Union[str, os.PathLike] save_path: File path to save the concatenated video.</span>
<span class="sd">    :param Optional[int] width_px: Width of the output video in pixels.</span>
<span class="sd">    :param Optional[int] width_idx: Index of the video to use for determining width.</span>
<span class="sd">    :param Optional[int] height_px: Height of the output video panels in pixels.</span>
<span class="sd">    :param Optional[int] height_idx: Height of the video to use for determining width.</span>
<span class="sd">    :param Optional[bool] gpu: Whether to use GPU-accelerated codec (default: False).</span>
<span class="sd">    :param Optional[bool] verbose: Whether to print progress messages (default: True).</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; video_paths = [&#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/08102021_DOT_Rat7_8(2).mp4&#39;, &#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/08102021_DOT_Rat11_12.mp4&#39;, &#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/new/2022-06-21_NOB_IOT_23.mp4&#39;]</span>
<span class="sd">    &gt;&gt;&gt; save_path = &#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/new/blank_test.mp4&#39;</span>
<span class="sd">    &gt;&gt;&gt; mosaic_concatenator(video_paths=video_paths, save_path=save_path, width_idx=1, height_idx=1, gpu=False)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;NVIDIA GPU not available&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">mosaic_concatenator</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
    <span class="n">check_valid_lst</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">video_paths</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mosaic_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> video_paths&quot;</span><span class="p">,</span>
        <span class="n">min_len</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="n">video_paths</span>
    <span class="p">]</span>
    <span class="n">max_video_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;video_length_s&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">video_meta_data</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">width_px</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">width_idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">width_px</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">width_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Provide a width_px OR width_idx&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">mosaic_concatenator</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">height_px</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">height_idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">height_px</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">height_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Provide a height_px OR height_idx&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">mosaic_concatenator</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">width_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_int</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">vertical_video_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> width index&quot;</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">width_idx</span><span class="p">,</span>
            <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">max_value</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">video_meta_data</span><span class="p">[</span><span class="n">width_idx</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">width_px</span>
    <span class="k">if</span> <span class="n">height_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_int</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">vertical_video_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> height index&quot;</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">width_idx</span><span class="p">,</span>
            <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">max_value</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">video_meta_data</span><span class="p">[</span><span class="n">width_idx</span><span class="p">][</span><span class="s2">&quot;height&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">height_px</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating mosaic video ...&quot;</span><span class="p">)</span>
    <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">video_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="sa">f</span><span class="s2">&quot;temp_</span><span class="si">{</span><span class="n">dt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">blank_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dt</span><span class="si">}</span><span class="s2">.mp4&quot;</span><span class="p">)</span>
        <span class="n">create_blank_video</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="n">blank_path</span><span class="p">,</span>
            <span class="n">length</span><span class="o">=</span><span class="n">max_video_length</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
            <span class="n">gpu</span><span class="o">=</span><span class="n">gpu</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">uneven_fill_color</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">video_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blank_path</span><span class="p">)</span>
    <span class="n">upper_videos</span><span class="p">,</span> <span class="n">lower_videos</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">video_paths</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">],</span>
        <span class="n">video_paths</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:],</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating upper mosaic... (Step 1/3)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">upper_videos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">upper_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;upper.mp4&quot;</span><span class="p">)</span>
        <span class="n">horizontal_video_concatenator</span><span class="p">(</span>
            <span class="n">video_paths</span><span class="o">=</span><span class="n">upper_videos</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">upper_path</span><span class="p">,</span>
            <span class="n">gpu</span><span class="o">=</span><span class="n">gpu</span><span class="p">,</span>
            <span class="n">height_px</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">upper_path</span> <span class="o">=</span> <span class="n">upper_videos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating lower mosaic... (Step 2/3)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lower_videos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lower_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;lower.mp4&quot;</span><span class="p">)</span>
        <span class="n">horizontal_video_concatenator</span><span class="p">(</span>
            <span class="n">video_paths</span><span class="o">=</span><span class="n">lower_videos</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">lower_path</span><span class="p">,</span>
            <span class="n">gpu</span><span class="o">=</span><span class="n">gpu</span><span class="p">,</span>
            <span class="n">height_px</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lower_path</span> <span class="o">=</span> <span class="n">lower_videos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">panels_meta</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="p">[</span><span class="n">lower_path</span><span class="p">,</span> <span class="n">upper_path</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Joining upper and lower mosaic... (Step 2/3)&quot;</span><span class="p">)</span>
    <span class="n">vertical_video_concatenator</span><span class="p">(</span>
        <span class="n">video_paths</span><span class="o">=</span><span class="p">[</span><span class="n">upper_path</span><span class="p">,</span> <span class="n">lower_path</span><span class="p">],</span>
        <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="n">gpu</span><span class="o">=</span><span class="n">gpu</span><span class="p">,</span>
        <span class="n">width_px</span><span class="o">=</span><span class="nb">max</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">panels_meta</span><span class="p">]),</span>
    <span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Mosaic concatenation complete. Saved at </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2"> (Elapsed time: </span><span class="si">{</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="si">}</span><span class="s2">s.)&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="mixed_mosaic_concatenator"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.mixed_mosaic_concatenator">[docs]</a><span class="k">def</span> <span class="nf">mixed_mosaic_concatenator</span><span class="p">(</span>
    <span class="n">video_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]],</span>
    <span class="n">save_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">uneven_fill_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a mixed mosaic video by concatenating multiple input videos in a mosaic layout of various sizes.</span>

<span class="sd">    .. image:: _static/img/mixed_mosaic_concatenator.png</span>
<span class="sd">       :width: 600</span>
<span class="sd">       :align: center</span>

<span class="sd">    .. note::</span>
<span class="sd">       The resolution of the output video is determined by the resolution of the video path at the first index.</span>

<span class="sd">       If an uneven number of right-panel videos ( if not (len(video_paths)-1) % 2) == 0), then the last index will be filled by ``uneven_fill_color``.</span>

<span class="sd">    :param List[Union[str, os.PathLike]] video_paths: List of input video file paths.</span>
<span class="sd">    :param Union[str, os.PathLike] save_path: File path to save the concatenated video.</span>
<span class="sd">    :param Optional[bool] gpu: Whether to use GPU-accelerated codec (default: False).</span>
<span class="sd">    :param Optional[bool] verbose: Whether to print progress messages (default: True).</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; video_paths = [&#39;video1.mp4&#39;, &#39;video2.mp4&#39;, &#39;video3.mp4&#39;]</span>
<span class="sd">    &gt;&gt;&gt; save_path = &#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/new/blank_test.mp4&#39;</span>
<span class="sd">    &gt;&gt;&gt; mixed_mosaic_concatenator(video_paths=video_paths, save_path=save_path, gpu=False, verbose=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;NVIDIA GPU not available&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">mixed_mosaic_concatenator</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_valid_lst</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">video_paths</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">mixed_mosaic_concatenator</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="n">video_paths</span>
    <span class="p">]</span>
    <span class="n">max_video_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;video_length_s&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">video_meta_data</span><span class="p">])</span>
    <span class="n">check_if_dir_exists</span><span class="p">(</span>
        <span class="n">in_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">save_path</span><span class="p">),</span> <span class="n">source</span><span class="o">=</span><span class="n">mixed_mosaic_concatenator</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="p">)</span>
    <span class="n">large_mosaic_path</span><span class="p">,</span> <span class="n">video_paths</span> <span class="o">=</span> <span class="n">video_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">video_paths</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">mosaic_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">video_meta_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating mixed mosaic video... &quot;</span><span class="p">)</span>
    <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">large_mosaic_path</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;temp_</span><span class="si">{</span><span class="n">dt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">blank_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dt</span><span class="si">}</span><span class="s2">.mp4&quot;</span><span class="p">)</span>
        <span class="n">create_blank_video</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="n">blank_path</span><span class="p">,</span>
            <span class="n">length</span><span class="o">=</span><span class="n">max_video_length</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_paths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
            <span class="n">height</span><span class="o">=</span><span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_paths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
            <span class="n">gpu</span><span class="o">=</span><span class="n">gpu</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">uneven_fill_color</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">video_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blank_path</span><span class="p">)</span>
    <span class="n">upper_videos</span><span class="p">,</span> <span class="n">lower_videos</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">video_paths</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">],</span>
        <span class="n">video_paths</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:],</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating upper right mosaic ... (Step 1/4)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">upper_videos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">upper_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;upper.mp4&quot;</span><span class="p">)</span>
        <span class="n">horizontal_video_concatenator</span><span class="p">(</span>
            <span class="n">video_paths</span><span class="o">=</span><span class="n">upper_videos</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">upper_path</span><span class="p">,</span>
            <span class="n">gpu</span><span class="o">=</span><span class="n">gpu</span><span class="p">,</span>
            <span class="n">height_px</span><span class="o">=</span><span class="n">mosaic_height</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">upper_path</span> <span class="o">=</span> <span class="n">upper_videos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating lower right mosaic ... (Step 2/4)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lower_videos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lower_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;lower.mp4&quot;</span><span class="p">)</span>
        <span class="n">horizontal_video_concatenator</span><span class="p">(</span>
            <span class="n">video_paths</span><span class="o">=</span><span class="n">lower_videos</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">lower_path</span><span class="p">,</span>
            <span class="n">gpu</span><span class="o">=</span><span class="n">gpu</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">height_px</span><span class="o">=</span><span class="n">mosaic_height</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lower_path</span> <span class="o">=</span> <span class="n">lower_videos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">panels_meta</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="p">[</span><span class="n">lower_path</span><span class="p">,</span> <span class="n">upper_path</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="n">mosaic_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;mosaic.mp4&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Joining upper and lower right mosaic... (Step 3/4)&quot;</span><span class="p">)</span>
    <span class="n">vertical_video_concatenator</span><span class="p">(</span>
        <span class="n">video_paths</span><span class="o">=</span><span class="p">[</span><span class="n">upper_path</span><span class="p">,</span> <span class="n">lower_path</span><span class="p">],</span>
        <span class="n">width_px</span><span class="o">=</span><span class="nb">max</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">panels_meta</span><span class="p">]),</span>
        <span class="n">save_path</span><span class="o">=</span><span class="n">mosaic_path</span><span class="p">,</span>
        <span class="n">gpu</span><span class="o">=</span><span class="n">gpu</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Joining left and right mosaic... (Step 4/4)&quot;</span><span class="p">)</span>
    <span class="n">horizontal_video_concatenator</span><span class="p">(</span>
        <span class="n">video_paths</span><span class="o">=</span><span class="p">[</span><span class="n">large_mosaic_path</span><span class="p">,</span> <span class="n">mosaic_path</span><span class="p">],</span>
        <span class="n">height_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span>
        <span class="n">gpu</span><span class="o">=</span><span class="n">gpu</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Mixed mosaic concatenation complete. Saved at </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2"> (Elapsed time: </span><span class="si">{</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="si">}</span><span class="s2">s.)&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="clip_videos_by_frame_ids"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.clip_videos_by_frame_ids">[docs]</a><span class="k">def</span> <span class="nf">clip_videos_by_frame_ids</span><span class="p">(</span><span class="n">file_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]],</span> <span class="n">frm_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clip videos specified by frame IDs (numbers).</span>

<span class="sd">    :param List[Union[str, os.PathLike]] file_paths: List of paths to input video files.</span>
<span class="sd">    :param List[List[int]] frm_ids: List of lists containing start and end frame IDs for each video.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_dir:  Directory to save the clipped videos. If None, videos will be saved in the same directory as the input videos with frame numbers as suffix.</span>
<span class="sd">    :return: None.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; file_paths = [&#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/frames/output/path_plots/Trial    10.mp4&#39;, &#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/frames/output/path_plots/Trial    10_1.mp4&#39;]</span>
<span class="sd">    &gt;&gt;&gt; frm_ids = [[0, 20], [20, 40]]</span>
<span class="sd">    &gt;&gt;&gt; clip_videos_by_frame_ids(file_paths=file_paths, frm_ids=frm_ids, save_dir=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/frames/output/path_plots/trial_cnt&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_valid_lst</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">clip_videos_by_frame_ids</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">valid_dtypes</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,),</span><span class="n">min_len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">check_valid_lst</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">frm_ids</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">clip_videos_by_frame_ids</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">valid_dtypes</span><span class="o">=</span><span class="p">(</span><span class="nb">list</span><span class="p">,),</span> <span class="n">exact_len</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frm_ids</span><span class="p">):</span>
        <span class="n">check_valid_lst</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;clip_videos_by_frame_count.__name_ frm_ids </span><span class="si">{</span><span class="n">cnt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">valid_dtypes</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,),</span> <span class="n">exact_len</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">FrameRangeError</span><span class="p">(</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Start frame for video </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> is after or the same as the end frame (</span><span class="si">{</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">clip_videos_by_frame_ids</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FrameRangeError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Start frame has to be at least 0 and end frame has to be at least 1&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">clip_videos_by_frame_ids</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">video_meta_data</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">frm_ids</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;frame_count&quot;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">frm_ids</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;frame_count&quot;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">FrameRangeError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Video </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> has </span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;frame_count&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> frames, cannot use start and end frame </span><span class="si">{</span><span class="n">frm_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">clip_videos_by_frame_ids</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">clip_videos_by_frame_ids</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">create_if_not_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_paths</span><span class="p">):</span>
        <span class="n">video_timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">dir</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">s_f</span><span class="p">,</span> <span class="n">e_f</span> <span class="o">=</span> <span class="n">frm_ids</span><span class="p">[</span><span class="n">cnt</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">frm_ids</span><span class="p">[</span><span class="n">cnt</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trimming </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2"> from frame </span><span class="si">{</span><span class="n">s_f</span><span class="si">}</span><span class="s2"> to frame </span><span class="si">{</span><span class="n">e_f</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">s_f</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">e_f</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf trim=start_frame=</span><span class="si">{</span><span class="n">s_f</span><span class="si">}</span><span class="s1">:end_frame=</span><span class="si">{</span><span class="n">e_f</span><span class="si">}</span><span class="s1"> -an &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">video_timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Video </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2"> complete (elapsed time </span><span class="si">{</span><span class="n">video_timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> video(s) clipped by frame&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> video(s) clipped by frame and saved in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>


<div class="viewcode-block" id="convert_to_mp4"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.convert_to_mp4">[docs]</a><span class="k">def</span> <span class="nf">convert_to_mp4</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                   <span class="n">codec</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;libx265&#39;</span><span class="p">,</span> <span class="s1">&#39;libx264&#39;</span><span class="p">,</span> <span class="s1">&#39;vp9&#39;</span><span class="p">,</span> <span class="s1">&#39;h264_cuvid&#39;</span><span class="p">,</span> <span class="s1">&#39;powerpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;libx265&#39;</span><span class="p">,</span>
                   <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a directory containing videos, or a single video, to MP4 format using passed quality and codec.</span>

<span class="sd">    .. image:: _static/img/convert_to_mp4_1.webp</span>
<span class="sd">       :width: 800</span>
<span class="sd">       :align: center</span>

<span class="sd">    .. image:: _static/img/convert_to_mp4_2.webp</span>
<span class="sd">       :width: 800</span>
<span class="sd">       :align: center</span>

<span class="sd">    :param Union[str, os.PathLike] path: Path to directory or file.</span>
<span class="sd">    :param Literal[&#39;libx265&#39;, &#39;libx264&#39;, &#39;vp9&#39;, &#39;powerpoint&#39;] codec:</span>
<span class="sd">    :param Optional[Optional[Union[str, os.PathLike]]] save_dir: Directory where to save the converted videos. If None, then creates a directory in the same directory as the input.</span>
<span class="sd">    :param Optional[int] quality: If CPU codec, then integer representing the quality: 10, 20, 30.. 100. If GPU codec, then string: &#39;Low&#39;, &#39;Medium&#39;, &#39;High&#39;</span>
<span class="sd">    :return: None.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; convert_to_mp4(path=&#39;/Users/simon/Desktop/video_test&#39;, quality=&quot;60&quot;, codec=&#39;vp9&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_mp4</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> codec&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">codec</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;libx265&#39;</span><span class="p">,</span> <span class="s1">&#39;libx264&#39;</span><span class="p">,</span> <span class="s1">&#39;powerpoint&#39;</span><span class="p">,</span> <span class="s1">&#39;vp9&#39;</span><span class="p">,</span> <span class="s1">&#39;h264_cuvid&#39;</span><span class="p">))</span>
    <span class="n">check_instance</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_mp4</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> path&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">accepted_types</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,))</span>
    <span class="n">datetime_</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
    <span class="n">crf_lk</span> <span class="o">=</span> <span class="n">percent_to_crf_lookup</span><span class="p">()</span>
    <span class="n">preset_lookup</span> <span class="o">=</span> <span class="n">video_quality_to_preset_lookup</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">codec</span> <span class="o">!=</span> <span class="s1">&#39;h264_cuvid&#39;</span><span class="p">:</span>
        <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_mp4</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> quality&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">quality</span><span class="p">)</span>
        <span class="n">quality</span> <span class="o">=</span> <span class="n">crf_lk</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">quality</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None). Select a different codec&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_mp4</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_mp4</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> quality&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">quality</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Low&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium&#39;</span><span class="p">,</span> <span class="s1">&#39;High&#39;</span><span class="p">))</span>
        <span class="n">quality</span> <span class="o">=</span> <span class="n">preset_lookup</span><span class="p">[</span><span class="n">quality</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_mp4</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;mp4_</span><span class="si">{</span><span class="n">datetime_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="n">find_files_of_filetypes_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="n">Options</span><span class="o">.</span><span class="n">ALL_VIDEO_FORMAT_OPTIONS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;mp4_</span><span class="si">{</span><span class="n">datetime_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Paths is not a valid file or directory path.&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_mp4</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_paths</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Converting video </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1"> to MP4 (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s1">)...&#39;</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">out_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">.mp4&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">codec</span> <span class="o">==</span> <span class="s1">&#39;powerpoint&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -c:v libx264 -preset slow -profile:v high -level:v 4.0 -pix_fmt yuv420p -crf </span><span class="si">{</span><span class="n">quality</span><span class="si">}</span><span class="s1"> -c:v libx264 -codec:a aac &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">codec</span> <span class="o">==</span> <span class="s1">&#39;vp9&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -c:v libvpx-vp9 -crf </span><span class="si">{</span><span class="n">quality</span><span class="si">}</span><span class="s1"> -b:v 0 -an &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">codec</span> <span class="o">==</span> <span class="s1">&#39;h264_cuvid&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -c:v h264_nvenc -preset </span><span class="si">{</span><span class="n">quality</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -c:v </span><span class="si">{</span><span class="n">codec</span><span class="si">}</span><span class="s1"> -crf </span><span class="si">{</span><span class="n">quality</span><span class="si">}</span><span class="s1"> -c:a copy -an &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> video(s) converted to MP4 and saved in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> directory.&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_mp4</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,)</span></div>

<span class="c1">#convert_to_mp4(path=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/two_black_animals_14bp/project_folder/videos/temp/Together_1_frame_no.mp4&#39;, quality=100, codec=&#39;libx265&#39;)</span>

<div class="viewcode-block" id="convert_to_avi"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.convert_to_avi">[docs]</a><span class="k">def</span> <span class="nf">convert_to_avi</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                   <span class="n">codec</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;xvid&#39;</span><span class="p">,</span> <span class="s1">&#39;divx&#39;</span><span class="p">,</span> <span class="s1">&#39;mjpeg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;divx&#39;</span><span class="p">,</span>
                   <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a directory containing videos, or a single video, to AVI format using passed quality and codec.</span>

<span class="sd">    .. image:: _static/img/convert_to_avi.webp</span>
<span class="sd">       :width: 800</span>
<span class="sd">       :align: center</span>

<span class="sd">    :param Union[str, os.PathLike] path: Path to directory or file.</span>
<span class="sd">    :param Literal[&#39;xvid&#39;, &#39;divx&#39;, &#39;mjpeg&#39;] codec: Method to encode the AVI format. Default: xvid.</span>
<span class="sd">    :param Optional[Optional[Union[str, os.PathLike]]] save_dir: Directory where to save the converted videos. If None, then creates a directory in the same directory as the input.</span>
<span class="sd">    :param Optional[int] quality: Integer representing the quality: 10, 20, 30.. 100.</span>
<span class="sd">    :return: None.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; convert_to_avi(path=&#39;/Users/simon/Desktop/video_test/Screen Recording 2024-05-06 at 5.34.34 PM_converted.mp4&#39;, quality=100, codec=&#39;xvid&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_avi</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> codec&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">codec</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;xvid&#39;</span><span class="p">,</span> <span class="s1">&#39;divx&#39;</span><span class="p">,</span> <span class="s1">&#39;mjpeg&#39;</span><span class="p">))</span>
    <span class="n">check_instance</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_avi</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> path&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">accepted_types</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,))</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_avi</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> quality&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">quality</span><span class="p">)</span>
    <span class="n">datetime_</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
    <span class="n">crf_lk</span> <span class="o">=</span> <span class="n">percent_to_crf_lookup</span><span class="p">()</span>
    <span class="n">cv_lk</span> <span class="o">=</span> <span class="n">percent_to_qv_lk</span><span class="p">()</span>
    <span class="n">crf</span> <span class="o">=</span> <span class="n">crf_lk</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">quality</span><span class="p">)]</span>
    <span class="n">qv</span> <span class="o">=</span> <span class="n">cv_lk</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">quality</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_avi</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;avi_</span><span class="si">{</span><span class="n">datetime_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="n">find_files_of_filetypes_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="n">Options</span><span class="o">.</span><span class="n">ALL_VIDEO_FORMAT_OPTIONS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;avi_</span><span class="si">{</span><span class="n">datetime_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Paths is not a valid file or directory path.&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_avi</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_paths</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Converting video </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1"> to avi (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s1">)...&#39;</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">out_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">.avi&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">codec</span> <span class="o">==</span> <span class="s1">&#39;divx&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -c:v mpeg4 -crf </span><span class="si">{</span><span class="n">crf</span><span class="si">}</span><span class="s1"> -vtag DIVX &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">codec</span> <span class="o">==</span> <span class="s1">&#39;xvid&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -c:v libxvid -q:v </span><span class="si">{</span><span class="n">qv</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -c:v mjpeg -q:v </span><span class="si">{</span><span class="n">qv</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> video(s) converted to AVI and saved in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> directory.&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_avi</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,)</span></div>


<div class="viewcode-block" id="convert_to_webm"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.convert_to_webm">[docs]</a><span class="k">def</span> <span class="nf">convert_to_webm</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                    <span class="n">codec</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;vp8&#39;</span><span class="p">,</span> <span class="s1">&#39;vp9&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;vp9&#39;</span><span class="p">,</span>
                    <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a directory containing videos, or a single video, to WEBM format using passed quality and codec.</span>

<span class="sd">    .. image:: _static/img/convert_to_webm.webp</span>
<span class="sd">       :width: 800</span>
<span class="sd">       :align: center</span>

<span class="sd">    :param Union[str, os.PathLike] path: Path to directory or file.</span>
<span class="sd">    :param Literal[&#39;vp8&#39;, &#39;vp9&#39;, &#39;av1&#39;] codec: Method to encode the WEBM format. Default: vp9.</span>
<span class="sd">    :param Optional[Optional[Union[str, os.PathLike]]] save_dir: Directory where to save the converted videos. If None, then creates a directory in the same directory as the input.</span>
<span class="sd">    :param Optional[int] quality: Integer representing the quality: 10, 20, 30.. 100.</span>
<span class="sd">    :return: None.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; convert_to_webm(path=&#39;/Users/simon/Desktop/video_test/Screen Recording 2024-05-06 at 5.34.34 PM_converted.mp4&#39;, quality=100, codec=&#39;vp8&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_webm</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> codec&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">codec</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;vp8&#39;</span><span class="p">,</span> <span class="s1">&#39;vp9&#39;</span><span class="p">))</span>
    <span class="n">check_instance</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_webm</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> path&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">accepted_types</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,))</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_webm</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> quality&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">quality</span><span class="p">)</span>
    <span class="n">datetime_</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
    <span class="n">crf_lk</span> <span class="o">=</span> <span class="n">percent_to_crf_lookup</span><span class="p">()</span>
    <span class="n">crf</span> <span class="o">=</span> <span class="n">crf_lk</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">quality</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_webm</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;webm_</span><span class="si">{</span><span class="n">datetime_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="n">find_files_of_filetypes_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="n">Options</span><span class="o">.</span><span class="n">ALL_VIDEO_FORMAT_OPTIONS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;webm_</span><span class="si">{</span><span class="n">datetime_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Paths is not a valid file or directory path.&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_webm</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_paths</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Converting video </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1"> to WEBM (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s1">)...&#39;</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">out_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">.webm&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">codec</span> <span class="o">==</span> <span class="s1">&#39;vp8&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -c:v libvpx -crf </span><span class="si">{</span><span class="n">crf</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">codec</span> <span class="o">==</span> <span class="s1">&#39;vp9&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -c:v libvpx-vp9 -crf </span><span class="si">{</span><span class="n">crf</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -c:v libaom-av1 -crf </span><span class="si">{</span><span class="n">crf</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> video(s) converted to WEBM and saved in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> directory.&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_webm</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,)</span></div>

<span class="c1">#convert_to_webm(path=&#39;/Users/simon/Desktop/video_test/Screen Recording 2024-05-06 at 5.34.34 PM_converted.mp4&#39;, quality=100, codec=&#39;vp8&#39;)</span>


<div class="viewcode-block" id="convert_to_mov"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.convert_to_mov">[docs]</a><span class="k">def</span> <span class="nf">convert_to_mov</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                    <span class="n">codec</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;prores&#39;</span><span class="p">,</span> <span class="s1">&#39;animation&#39;</span><span class="p">,</span> <span class="s1">&#39;dnxhd&#39;</span><span class="p">,</span> <span class="s1">&#39;cineform&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;prores&#39;</span><span class="p">,</span>
                    <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a directory containing videos, or a single video, to MOV format using passed quality and codec.</span>

<span class="sd">    :param Union[str, os.PathLike] path: Path to directory or file.</span>
<span class="sd">    :param Literal[&#39;prores&#39;, &#39;animation&#39;] codec: Method to encode the MOV format. Default: prores.</span>
<span class="sd">    :param Optional[Optional[Union[str, os.PathLike]]] save_dir: Directory where to save the converted videos. If None, then creates a directory in the same directory as the input.</span>
<span class="sd">    :param Optional[int] quality: Integer representing the quality: 10, 20, 30.. 100.</span>
<span class="sd">    :return: None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_mov</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> codec&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">codec</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;prores&#39;</span><span class="p">,</span> <span class="s1">&#39;animation&#39;</span><span class="p">,</span> <span class="s1">&#39;cineform&#39;</span><span class="p">,</span> <span class="s1">&#39;dnxhd&#39;</span><span class="p">))</span>
    <span class="n">check_instance</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_mov</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> path&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">accepted_types</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,))</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">convert_to_mov</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> quality&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">quality</span><span class="p">)</span>
    <span class="n">datetime_</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_mov</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;mov_</span><span class="si">{</span><span class="n">datetime_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="n">find_files_of_filetypes_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="n">Options</span><span class="o">.</span><span class="n">ALL_VIDEO_FORMAT_OPTIONS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;mov_</span><span class="si">{</span><span class="n">datetime_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Paths is not a valid file or directory path.&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_mov</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_paths</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Converting video </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1"> to MOV (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s1">)...&#39;</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">out_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">.mov&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">codec</span> <span class="o">==</span> <span class="s1">&#39;prores&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -c:v prores_ks -profile:v 1 &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">codec</span> <span class="o">==</span> <span class="s1">&#39;dnxhd&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -c:v dnxhd -profile:v dnxhr_mq &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">codec</span> <span class="o">==</span> <span class="s2">&quot;cineform&quot;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -c:v cfhd -compression_level 5 -q:v 3 &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> -c:v qtrle &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> video(s) converted to MOV and saved in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> directory.&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">convert_to_mov</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">)</span></div>

<span class="c1">#convert_to_mov(path=&#39;/Users/simon/Desktop/video_test/Screen Recording 2024-05-06 at 5.34.34 PM_converted.mp4&#39;, codec=&#39;cineform&#39;)</span>

<div class="viewcode-block" id="superimpose_video_progressbar"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.superimpose_video_progressbar">[docs]</a><span class="k">def</span> <span class="nf">superimpose_video_progressbar</span><span class="p">(</span><span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                                  <span class="n">bar_height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                                  <span class="n">color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>
                                  <span class="n">position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
                                  <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Overlay a progress bar on a directory of videos or a single video.</span>

<span class="sd">    .. video:: _static/img/overlay_video_progressbar.webm</span>
<span class="sd">       :width: 700</span>
<span class="sd">       :loop:</span>

<span class="sd">    :param Union[str, os.PathLike] video_path: Directory containing video files or a single video file</span>
<span class="sd">    :param Optional[int] bar_height: The height of the progressbar in percent of the video height.</span>
<span class="sd">    :param Optional[str] color: The color of the progress bar. See simba.utils.lookups.get_color_dict keys for accepted names.</span>
<span class="sd">    :param Optional[str] position: The position of the progressbar. Options: &#39;top&#39;, &#39;bottom&#39;.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_dir: If not None, then saves the videos in the passed directory. Else, in the same directry with the ``_progress_bar`` suffix.</span>
<span class="sd">    :param Optional[bool] gpu: If True, uses GPU codecs with potentially faster runtimes. Default: False.</span>

<span class="sd">    :return: None.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; superimpose_video_progressbar(video_path=&#39;/home/plateabiosciences/Downloads/031723/3A_Mouse_5-choice_MouseTouchBasic_s9_a6.mp4&#39;, gpu=False)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None).&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">superimpose_video_progressbar</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isalnum</span><span class="p">,</span> <span class="n">color</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">video_path</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_path</span> <span class="o">=</span> <span class="n">find_all_videos_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">video_path</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">video_path</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid file path or directory path.&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">superimpose_video_progressbar</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_dir</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">video_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
        <span class="n">video_length</span> <span class="o">=</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;video_length_s&#39;</span><span class="p">]</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">],</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>
        <span class="n">bar_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">height</span> <span class="o">*</span> <span class="p">(</span><span class="n">bar_height</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Inserting progress bar on video </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">_progress_bar</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">superimpose_video_progressbar</span><span class="si">}</span><span class="s1"> height&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">bar_height</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="s1">&#39;bottom&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;color=c=</span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s1">:s=</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s1">x</span><span class="si">{</span><span class="n">bar_height</span><span class="si">}</span><span class="s1">[bar];[0][bar]overlay=-w+(w/</span><span class="si">{</span><span class="n">video_length</span><span class="si">}</span><span class="s1">)*t:H-h:shortest=1&quot; -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;color=c=</span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s1">:s=</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s1">x</span><span class="si">{</span><span class="n">bar_height</span><span class="si">}</span><span class="s1">[bar];[0][bar]overlay=-w+(w/</span><span class="si">{</span><span class="n">video_length</span><span class="si">}</span><span class="s1">)*t:H-h:shortest=1&quot; -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;color=c=</span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s1">:s=</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s1">x</span><span class="si">{</span><span class="n">bar_height</span><span class="si">}</span><span class="s1">[bar];[0][bar]overlay=-w+(w/</span><span class="si">{</span><span class="n">video_length</span><span class="si">}</span><span class="s1">)*t:</span><span class="si">{</span><span class="n">bar_height</span><span class="si">}</span><span class="s1">-h:shortest=1&quot; -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;color=c=</span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s1">:s=</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s1">x</span><span class="si">{</span><span class="n">bar_height</span><span class="si">}</span><span class="s1">[bar];[0][bar]overlay=-w+(w/</span><span class="si">{</span><span class="n">video_length</span><span class="si">}</span><span class="s1">)*t:</span><span class="si">{</span><span class="n">bar_height</span><span class="si">}</span><span class="s1">-h:shortest=1&quot; -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> video(s) saved with progressbar in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> directory.&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">superimpose_video_progressbar</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">)</span></div>



<div class="viewcode-block" id="crossfade_two_videos"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.crossfade_two_videos">[docs]</a><span class="k">def</span> <span class="nf">crossfade_two_videos</span><span class="p">(</span><span class="n">video_path_1</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                         <span class="n">video_path_2</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                         <span class="n">crossfade_duration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                         <span class="n">crossfade_method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fade&#39;</span><span class="p">,</span>
                         <span class="n">crossfade_offset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                         <span class="n">quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
                         <span class="n">out_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;mp4&#39;</span><span class="p">,</span> <span class="s1">&#39;avi&#39;</span><span class="p">,</span> <span class="s1">&#39;webm&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;mp4&#39;</span><span class="p">,</span>
                         <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cross-fade two videos.</span>

<span class="sd">    .. video:: _static/img/crossfade_two_videos.webm</span>
<span class="sd">       :loop:</span>

<span class="sd">    .. note::</span>
<span class="sd">       See ``simba.utils.lookups.get_ffmpeg_crossfade_methods`` for named crossfade methods.</span>
<span class="sd">       See `https://trac.ffmpeg.org/wiki/Xfade &lt;https://trac.ffmpeg.org/wiki/Xfade&gt;`__. for visualizations of named crossfade methods,</span>

<span class="sd">    :param Union[str, os.PathLike] video_path_1: Path to the first video on disk.</span>
<span class="sd">    :param Union[str, os.PathLike] video_path_2: Path to the second video on disk.</span>
<span class="sd">    :param Optional[int] crossfade_duration: The duration of the crossfade.</span>
<span class="sd">    :param Optional[str] crossfade_method: The crossfade method. For accepted methods, see ``simba.utils.lookups.get_ffmpeg_crossfade_methods``.</span>
<span class="sd">    :param Optional[int] crossfade_offset: The time in seconds into the first video before the crossfade duration begins.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_path: The location where to save the crossfaded video. If None, then saves the video in the same directory as ``video_path_1`` with ``_crossfade`` suffix.</span>
<span class="sd">    :param Optional[bool] gpu: If True, uses GPU codecs with potentially faster runtimes. Default: False.</span>
<span class="sd">    :return: None.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; crossfade_two_videos(video_path_1=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/reptile/1.mp4&#39;, video_path_2=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/reptile/1.mp4&#39;, crossfade_duration=5, crossfade_method=&#39;zoomin&#39;, save_path=&#39;/Users/simon/Desktop/cross_test.mp4&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None).&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">superimpose_video_progressbar</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">video_1_meta</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path_1</span><span class="p">)</span>
    <span class="n">video_2_meta</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path_2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">video_1_meta</span><span class="p">[</span><span class="s1">&#39;resolution_str&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">video_1_meta</span><span class="p">[</span><span class="s1">&#39;resolution_str&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Video 1 and Video 2 needs to be the same resolution, got </span><span class="si">{</span><span class="n">video_2_meta</span><span class="p">[</span><span class="s2">&quot;resolution_str&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">video_1_meta</span><span class="p">[</span><span class="s2">&quot;resolution_str&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">crossfade_two_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">crossfade_offset_methods</span> <span class="o">=</span> <span class="n">get_ffmpeg_crossfade_methods</span><span class="p">()</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">crossfade_method</span><span class="si">}</span><span class="s1"> crossfade_method&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">crossfade_method</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">crossfade_offset_methods</span><span class="p">)</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">crossfade_method</span><span class="si">}</span><span class="s1"> out_format&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">out_format</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mp4&#39;</span><span class="p">,</span> <span class="s1">&#39;avi&#39;</span><span class="p">,</span> <span class="s1">&#39;webm&#39;</span><span class="p">])</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">crossfade_two_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> crossfade_duration&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">crossfade_duration</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="n">video_2_meta</span><span class="p">[</span><span class="s1">&#39;video_length_s&#39;</span><span class="p">])</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">crossfade_two_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> crossfade_offset&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">crossfade_offset</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="n">video_1_meta</span><span class="p">[</span><span class="s1">&#39;video_length_s&#39;</span><span class="p">])</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">crossfade_two_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> quality&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">quality</span><span class="p">)</span>
    <span class="n">crf_lk</span> <span class="o">=</span> <span class="n">percent_to_crf_lookup</span><span class="p">()</span>
    <span class="n">crf</span> <span class="o">=</span> <span class="n">crf_lk</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">quality</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="p">[</span><span class="n">video_path_1</span><span class="p">,</span> <span class="n">video_path_2</span><span class="p">]:</span>
        <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;video_length_s&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">crossfade_duration</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FrameRangeError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Video </span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;video_name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> is shorter </span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;video_length_s&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> than the crossfade duration </span><span class="si">{</span><span class="n">crossfade_duration</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">crossfade_two_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;video_length_s&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">crossfade_offset</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FrameRangeError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Video </span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;video_name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> is shorter </span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;video_length_s&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> than the crossfade offset </span><span class="si">{</span><span class="n">crossfade_offset</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">crossfade_two_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">dir_1</span><span class="p">,</span> <span class="n">video_name_1</span><span class="p">,</span> <span class="n">ext_1</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">video_path_1</span><span class="p">)</span>
    <span class="n">dir_2</span><span class="p">,</span> <span class="n">video_name_2</span><span class="p">,</span> <span class="n">ext_2</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">video_path_2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">save_path</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name_1</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">video_name_2</span><span class="si">}</span><span class="s1">_crossfade.</span><span class="si">{</span><span class="n">out_format</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path_1</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">video_path_2</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;xfade=transition=</span><span class="si">{</span><span class="n">crossfade_method</span><span class="si">}</span><span class="s1">:offset=</span><span class="si">{</span><span class="n">crossfade_offset</span><span class="si">}</span><span class="s1">:duration=</span><span class="si">{</span><span class="n">crossfade_duration</span><span class="si">}</span><span class="s1">&quot; -crf </span><span class="si">{</span><span class="n">crf</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path_1</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">video_path_2</span><span class="si">}</span><span class="s1">&quot; -hwaccel auto -filter_complex &quot;xfade=transition=</span><span class="si">{</span><span class="n">crossfade_method</span><span class="si">}</span><span class="s1">:offset=</span><span class="si">{</span><span class="n">crossfade_offset</span><span class="si">}</span><span class="s1">:duration=</span><span class="si">{</span><span class="n">crossfade_duration</span><span class="si">}</span><span class="s1">&quot; -c:v h264_nvenc &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Cross-faded video saved at </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>

<div class="viewcode-block" id="watermark_video"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.watermark_video">[docs]</a><span class="k">def</span> <span class="nf">watermark_video</span><span class="p">(</span><span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                    <span class="n">watermark_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                    <span class="n">position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;top_left&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_right&#39;</span><span class="p">,</span> <span class="s1">&#39;top_right&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_left&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;top_left&#39;</span><span class="p">,</span>
                    <span class="n">opacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                    <span class="n">scale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
                    <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Watermark a video file or a directory of video files with specified watermark size, opacity, and location.</span>

<span class="sd">    .. video:: _static/img/watermark_video.webm</span>
<span class="sd">       :width: 900</span>
<span class="sd">       :loop:</span>

<span class="sd">    :param Union[str, os.PathLike] video_path: The path to the video file or path to directory with video files.</span>
<span class="sd">    :param Union[str, os.PathLike] watermark_path: The path to the watermark .png file.</span>
<span class="sd">    :param Optional[str] position: The position of the watermark. Options: &#39;top_left&#39;, &#39;bottom_right&#39;, &#39;top_right&#39;, &#39;bottom_left&#39;, &#39;center&#39;</span>
<span class="sd">    :param Optional[float] opacity: The opacity of the watermark as a value between 0-1.0. 1.0 meaning the same as input image. Default: 0.5.</span>
<span class="sd">    :param Optional[float] scale: The scale of the watermark as a ratio os the image size. Default: 0.05.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_dir: The location where to save the watermarked video. If None, then saves the video in the same directory as the first video.</span>
<span class="sd">    :param Optional[bool] gpu: If True, uses GPU codecs with potentially faster runtimes. Default: False.</span>

<span class="sd">    :return: None</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; watermark_video(video_path=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/multi_animal_dlc_two_c57/project_folder/videos/watermark/Together_1_powerpointready.mp4&#39;, watermark_path=&#39;/Users/simon/Desktop/splash.png&#39;, position=&#39;top_left&#39;, opacity=1.0, scale=0.2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None).&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">watermark_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">POSITIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;top_left&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_right&#39;</span><span class="p">,</span> <span class="s1">&#39;top_right&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_left&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">]</span>
    <span class="n">check_float</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">watermark_video</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> opacity&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">check_float</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">watermark_video</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> scale&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">0.999</span><span class="p">)</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">watermark_video</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> position&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">POSITIONS</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">watermark_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">video_path</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">find_all_videos_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">video_path</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1"> is not a valid file path or a valid directory path&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">watermark_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">video_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">video_ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Watermarking </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1"> (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s1">)...&#39;</span><span class="p">)</span>
        <span class="n">out_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">_watermarked</span><span class="si">{</span><span class="n">video_ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">watermark_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[wm];[0:v][wm]overlay=0:0&quot; &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">watermark_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[wm];[0:v][wm]overlay=0:0&quot; -c:a copy -c:v h264_nvenc &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">watermark_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[wm];[0:v][wm]overlay=W-w:H-h&quot; &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">watermark_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[wm];[0:v][wm]overlay=W-w:H-h&quot; -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">watermark_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[wm];[0:v][wm]overlay=W-w-0:0&quot; &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">watermark_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[wm];[0:v][wm]overlay=W-w-0:0&quot; -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">watermark_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[wm];[0:v][wm]overlay=0:H-h-0&quot; &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">watermark_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[wm];[0:v][wm]overlay=0:H-h-0&quot; -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">watermark_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[wm];[0:v][wm]overlay=(W-w)/2:(H-h)/2&quot; &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">watermark_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[wm];[0:v][wm]overlay=(W-w)/2:(H-h)/2&quot; -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s1"> watermarked video(s) saved in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>

<div class="viewcode-block" id="superimpose_overlay_video"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.superimpose_overlay_video">[docs]</a><span class="k">def</span> <span class="nf">superimpose_overlay_video</span><span class="p">(</span><span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                              <span class="n">overlay_video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                              <span class="n">position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;top_left&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_right&#39;</span><span class="p">,</span> <span class="s1">&#39;top_right&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_left&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;top_left&#39;</span><span class="p">,</span>
                              <span class="n">opacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                              <span class="n">scale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
                              <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                              <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inset a video overlay on a second video with specified size, opacity, and location.</span>

<span class="sd">    .. video:: _static/img/inset_overlay_video.webm</span>
<span class="sd">       :width: 700</span>
<span class="sd">       :loop:</span>

<span class="sd">    :param Union[str, os.PathLike] video_path: The path to the video file.</span>
<span class="sd">    :param Union[str, os.PathLike] overlay_video_path: The path to video to be inserted into the ``video_path`` video.</span>
<span class="sd">    :param Optional[str] position: The position of the inset overlay video. Options: &#39;top_left&#39;, &#39;bottom_right&#39;, &#39;top_right&#39;, &#39;bottom_left&#39;, &#39;center&#39;</span>
<span class="sd">    :param Optional[float] opacity: The opacity of the inset overlay video as a value between 0-1.0. 1.0 meaning the same as input image. Default: 0.5.</span>
<span class="sd">    :param Optional[float] scale: The scale of the inset overlay video as a ratio os the image size. Default: 0.05.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_dir: The location where to save the output video. If None, then saves the video in the same directory as the first video.</span>
<span class="sd">    :param Optional[bool] gpu: If True, uses GPU codecs with potentially faster runtimes. Default: False.</span>

<span class="sd">    :return: None</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; superimpose_overlay_video(video_path=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/multi_animal_dlc_two_c57/project_folder/videos/watermark/Together_1_powerpointready.mp4&#39;, overlay_video_path=&#39;/Users/simon/Desktop/splash.png&#39;, position=&#39;top_left&#39;, opacity=1.0, scale=0.2)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None).&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">superimpose_overlay_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">POSITIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;top_left&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_right&#39;</span><span class="p">,</span> <span class="s1">&#39;top_right&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_left&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">]</span>
    <span class="n">check_float</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">superimpose_overlay_video</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> opacity&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">check_float</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">superimpose_overlay_video</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> scale&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">0.999</span><span class="p">)</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">superimpose_overlay_video</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> position&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">POSITIONS</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">overlay_video_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">video_path</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">find_all_videos_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">video_path</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1"> is not a valid file path or a valid directory path&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">superimpose_overlay_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">video_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">video_ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Inserting overlay onto </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1"> (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s1">)...&#39;</span><span class="p">)</span>
        <span class="n">out_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">_inset_overlay</span><span class="si">{</span><span class="n">video_ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">overlay_video_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[inset];[0:v][inset]overlay=0:0&quot; &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">overlay_video_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[inset];[0:v][inset]overlay=0:0&quot; -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">overlay_video_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[inset];[0:v][inset]overlay=W-w:H-h&quot; &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">overlay_video_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[inset];[0:v][inset]overlay=W-w:H-h&quot; -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">overlay_video_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[inset];[0:v][inset]overlay=W-w:0&quot; &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">overlay_video_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[inset];[0:v][inset]overlay=W-w:0&quot; -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">overlay_video_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[inset];[0:v][inset]overlay=0:H-h&quot; &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">overlay_video_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[inset];[0:v][inset]overlay=0:H-h&quot; -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">overlay_video_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[inset];[0:v][inset]overlay=(W-w)/2:(H-h)/2&quot; &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -i &quot;</span><span class="si">{</span><span class="n">overlay_video_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[1:v]scale=iw*</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">:-1,format=rgba,colorchannelmixer=aa=</span><span class="si">{</span><span class="n">opacity</span><span class="si">}</span><span class="s1">[inset];[0:v][inset]overlay=(W-w)/2:(H-h)/2&quot; -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s1"> overlay video(s) saved in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>

<div class="viewcode-block" id="roi_blurbox"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.roi_blurbox">[docs]</a><span class="k">def</span> <span class="nf">roi_blurbox</span><span class="p">(</span><span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                <span class="n">blur_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">,</span>
                <span class="n">invert</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Blurs either the selected or unselected portion of a user-specified region-of-interest according to the passed blur level.</span>
<span class="sd">    Higher blur levels produces more opaque regions.</span>

<span class="sd">    .. video:: _static/img/roi_blurbox.webm</span>
<span class="sd">       :loop:</span>

<span class="sd">    :param Union[str, os.PathLike] video_path: The path to the video on disk</span>
<span class="sd">    :param Optional[float] blur_level: The level of the blur as a ratio 0-1.0.</span>
<span class="sd">    :param Optional[bool] invert: If True, blurs the unselected region. If False, blurs the selected region.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_path: The location where to save the blurred video. If None, then saves the blurred video in the same directory as the input video with the ``_blurred`` suffix.</span>
<span class="sd">    :return: None</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; roi_blurbox(video_path=&#39;/Users/simon/Downloads/1_LH_clipped_downsampled.mp4&#39;, blur_level=0.2, invert=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_float</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">roi_blurbox</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> blur_level&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">blur_level</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="nb">dir</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">save_path</span><span class="p">),</span> <span class="n">source</span><span class="o">=</span><span class="n">roi_blurbox</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">_blurred</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">roi_selector</span> <span class="o">=</span> <span class="n">ROISelector</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">roi_selector</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">roi_selector</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">roi_selector</span><span class="o">.</span><span class="n">height</span>
    <span class="n">top_left_x</span><span class="p">,</span> <span class="n">top_left_y</span> <span class="o">=</span> <span class="n">roi_selector</span><span class="o">.</span><span class="n">top_left</span>
    <span class="n">max_blur_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">blur_level</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_blur_value</span> <span class="o">*</span> <span class="n">blur_level</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">invert</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[0:v]crop=</span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">h</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">top_left_x</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">top_left_y</span><span class="si">}</span><span class="s1">,boxblur=</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">blur_level</span><span class="p">)</span><span class="si">}</span><span class="s1">:10[fg]; [0:v][fg]overlay=</span><span class="si">{</span><span class="n">top_left_x</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">top_left_y</span><span class="si">}</span><span class="s1">[v]&quot; -map &quot;[v]&quot; &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -filter_complex &quot;[0:v]boxblur=</span><span class="si">{</span><span class="n">blur_level</span><span class="si">}</span><span class="s1">[bg];[0:v]crop=</span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">h</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">top_left_x</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">top_left_y</span><span class="si">}</span><span class="s1">[fg];[bg][fg]overlay=</span><span class="si">{</span><span class="n">top_left_x</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">top_left_y</span><span class="si">}</span><span class="s1">&quot; -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Blurred </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1"> video saved in </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>


<div class="viewcode-block" id="superimpose_elapsed_time"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.superimpose_elapsed_time">[docs]</a><span class="k">def</span> <span class="nf">superimpose_elapsed_time</span><span class="p">(</span><span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                             <span class="n">font</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Arial&#39;</span><span class="p">,</span>
                             <span class="n">font_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
                             <span class="n">font_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span>
                             <span class="n">font_border_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                             <span class="n">time_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;MM:SS&#39;</span><span class="p">,</span> <span class="s1">&#39;HH:MM:SS&#39;</span><span class="p">,</span> <span class="s1">&#39;SS.MMMMMM&#39;</span><span class="p">,</span> <span class="s1">&#39;HH:MM:SS.MMMM&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;HH:MM:SS.MMMM&#39;</span><span class="p">,</span>
                             <span class="n">font_border_width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                             <span class="n">position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;top_left&#39;</span><span class="p">,</span> <span class="s1">&#39;top_right&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_left&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_right&#39;</span><span class="p">,</span> <span class="s1">&#39;top_middle&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_middle&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;top_left&#39;</span><span class="p">,</span>
                             <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Superimposes elapsed time on the given video file(s) and saves the modified video(s).</span>

<span class="sd">    .. video:: _static/img/superimpose_elapsed_time.webm</span>
<span class="sd">       :width: 900</span>
<span class="sd">       :loop:</span>

<span class="sd">    :param Union[str, os.PathLike] video_path: Path to the input video file or directory containing video files.</span>
<span class="sd">    :param Optional[int] font_size: Font size for the elapsed time text. Default 30.</span>
<span class="sd">    :param Optional[str] font_color:  Font color for the elapsed time text. Default white</span>
<span class="sd">    :param Optional[str] font_border_color: Font border color for the elapsed time text. Default black.</span>
<span class="sd">    :param Optional[int] font_border_width: Font border width for the elapsed time text in pixels. Default 2.</span>
<span class="sd">    :param Optional[Literal[&#39;top_left&#39;, &#39;top_right&#39;, &#39;bottom_left&#39;, &#39;bottom_right&#39;, &#39;middle_top&#39;, &#39;middle_bottom&#39;]] position: Position where the elapsed time text will be superimposed. Default ``top_left``.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_dir: Directory where the modified video(s) will be saved. If not provided, the directory of the input video(s) will be used.</span>
<span class="sd">    :param Optional[bool] gpu: If True, uses GPU codecs with potentially faster runtimes. Default: False.</span>

<span class="sd">    :return: None</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; superimpose_elapsed_time(video_path=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/mouse_open_field/project_folder/videos/test_4/1.mp4&#39;, position=&#39;middle_top&#39;, font_color=&#39;black&#39;, font_border_color=&#39;pink&#39;, font_border_width=5, font_size=30)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None).&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">superimpose_overlay_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">POSITIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;top_left&#39;</span><span class="p">,</span> <span class="s1">&#39;top_right&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_left&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_right&#39;</span><span class="p">,</span> <span class="s1">&#39;top_middle&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_middle&#39;</span><span class="p">]</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">superimpose_elapsed_time</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> position&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">POSITIONS</span><span class="p">)</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">superimpose_elapsed_time</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> time_format&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">time_format</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;MM:SS&#39;</span><span class="p">,</span> <span class="s1">&#39;HH:MM:SS&#39;</span><span class="p">,</span> <span class="s1">&#39;SS.MMMMMM&#39;</span><span class="p">,</span> <span class="s1">&#39;HH:MM:SS.MMMM&#39;</span><span class="p">])</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">superimpose_elapsed_time</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> font_size&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">font_size</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">superimpose_elapsed_time</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> font_border_width&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">font_border_width</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">font_color</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isalnum</span><span class="p">,</span> <span class="n">font_color</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">font_border_color</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isalnum</span><span class="p">,</span> <span class="n">font_border_color</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">font_dict</span> <span class="o">=</span> <span class="n">get_fonts</span><span class="p">()</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">font_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">font_path</span> <span class="o">=</span> <span class="n">font_dict</span><span class="p">[</span><span class="n">font</span><span class="p">]</span>
    <span class="n">time_format_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;MM:SS&#39;</span><span class="p">:</span> <span class="s1">&#39;%{pts</span><span class="se">\\</span><span class="s1">:mks}&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;HH:MM:SS&#39;</span><span class="p">:</span> <span class="s1">&#39;%{pts</span><span class="se">\\</span><span class="s1">:hms}&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;SS.MMMMMM&#39;</span><span class="p">:</span> <span class="s1">&#39;%</span><span class="si">{pts}</span><span class="s1">&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;HH:MM:SS.MMMM&#39;</span><span class="p">:</span> <span class="s1">&#39;%{pts</span><span class="se">\\</span><span class="s1">:hms}.%{eif</span><span class="se">\\</span><span class="s1">:mod(n</span><span class="se">\\</span><span class="s1">,1000)</span><span class="se">\\</span><span class="s1">:d</span><span class="se">\\</span><span class="s1">:4}&#39;</span><span class="p">}</span>
    <span class="n">position_map</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;top_left&#39;</span><span class="p">:</span> <span class="s1">&#39;x=5:y=5&#39;</span><span class="p">,</span> <span class="s1">&#39;top_right&#39;</span><span class="p">:</span> <span class="s1">&#39;x=(w-tw-5):y=5&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_left&#39;</span><span class="p">:</span> <span class="s1">&#39;x=5:y=(h-th-5)&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_right&#39;</span><span class="p">:</span> <span class="s1">&#39;x=(w-tw-5):y=(h-th-5)&#39;</span><span class="p">,</span> <span class="s1">&#39;top_middle&#39;</span><span class="p">:</span> <span class="s1">&#39;x=(w-tw)/2:y=10&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_middle&#39;</span><span class="p">:</span> <span class="s1">&#39;x=(w-tw)/2:y=(h-th-10)&#39;</span><span class="p">}</span>
    <span class="n">time_text</span> <span class="o">=</span> <span class="n">time_format_map</span><span class="p">[</span><span class="n">time_format</span><span class="p">]</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">position_map</span><span class="p">[</span><span class="n">position</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">video_path</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">find_all_videos_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">video_path</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1"> is not a valid file path or a valid directory path&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">superimpose_elapsed_time</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">video_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Superimposing time </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1"> (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s1">)...&#39;</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">_time_superimposed</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=&quot;</span><span class="si">{</span><span class="n">time_text</span><span class="si">}</span><span class="s1">&quot;:</span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1">:fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=&quot;</span><span class="si">{</span><span class="n">time_text</span><span class="si">}</span><span class="s1">&quot;:</span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1">:fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Super-imposed time on </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s1"> video(s), saved in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>

<div class="viewcode-block" id="reverse_videos"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.reverse_videos">[docs]</a><span class="k">def</span> <span class="nf">reverse_videos</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                   <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">codec</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;libx265&#39;</span><span class="p">,</span> <span class="s1">&#39;libx264&#39;</span><span class="p">,</span> <span class="s1">&#39;vp9&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;libx265&#39;</span><span class="p">,</span>
                   <span class="n">quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
                   <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reverses one or more video files located at the specified path and saves the reversed videos in the specified</span>
<span class="sd">    directory.</span>

<span class="sd">    .. video:: _static/img/reverse_videos.webm</span>
<span class="sd">       :width: 800</span>
<span class="sd">       :loop:</span>

<span class="sd">    :param Union[str, os.PathLike] path: Path to the video file or directory containing video files to be reversed.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_dir: Directory to save the reversed videos. If not provided, reversed videos will be saved in a subdirectory named &#39;reversed_&lt;timestamp&gt;&#39; in the same directory as the input file(s).</span>
<span class="sd">    :param Optional[int] quality: Output video quality expressed as a percentage. Default is 60. Values range from 1 (low quality, high compression) to 100 (high quality, low compression).</span>
<span class="sd">    :param Optional[bool] gpu: If True, uses GPU codecs with potentially faster runtimes. Default: False.</span>
<span class="sd">    :return: None</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; reverse_videos(path=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/open_field_below/project_folder/videos/reverse/TheVideoName_video_name_2_frame_no.mp4&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None).&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">superimpose_overlay_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_instance</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">reverse_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> path&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">accepted_types</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,))</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">reverse_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> quality&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">quality</span><span class="p">)</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;codec&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">codec</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;libx265&#39;</span><span class="p">,</span> <span class="s1">&#39;libx264&#39;</span><span class="p">,</span> <span class="s1">&#39;vp9&#39;</span><span class="p">))</span>
    <span class="n">datetime_</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
    <span class="n">crf_lk</span> <span class="o">=</span> <span class="n">percent_to_crf_lookup</span><span class="p">()</span>
    <span class="n">crf</span> <span class="o">=</span> <span class="n">crf_lk</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">quality</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">reverse_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;reversed_</span><span class="si">{</span><span class="n">datetime_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="n">find_files_of_filetypes_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="n">Options</span><span class="o">.</span><span class="n">ALL_VIDEO_FORMAT_OPTIONS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;mp4_</span><span class="si">{</span><span class="n">datetime_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Path is not a valid file or directory path.&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">reverse_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_paths</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reversing video </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1"> (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s1">)...&#39;</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">out_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf reverse -af areverse -c:v </span><span class="si">{</span><span class="n">codec</span><span class="si">}</span><span class="s1"> -crf </span><span class="si">{</span><span class="n">crf</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; -vf reverse -af areverse -c:v h264_nvenc -crf </span><span class="si">{</span><span class="n">crf</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> video(s) reversed and saved in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> directory.&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">reverse_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>

<div class="viewcode-block" id="video_to_bw"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.video_to_bw">[docs]</a><span class="k">def</span> <span class="nf">video_to_bw</span><span class="p">(</span><span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                <span class="n">threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert video to black and white using passed threshold.</span>

<span class="sd">    .. video:: _static/img/video_to_bw.webm</span>
<span class="sd">       :width: 800</span>
<span class="sd">       :autoplay:</span>
<span class="sd">       :loop:</span>

<span class="sd">    :param Union[str, os.PathLike] video_path: Path to the video</span>
<span class="sd">    :param Optional[float] threshold: Value between 0 and 1. Lower values gives more white and vice versa.</span>
<span class="sd">    :param Optional[bool] gpu: If True, uses GPU codecs with potentially faster runtimes. Default: False.</span>

<span class="sd">    :return: None.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; video_to_bw(video_path=&#39;/Users/simon/Downloads/1_LH_clipped_cropped_eq_20240515135926.mp4&#39;, threshold=0.02)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_float</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_to_bw</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> threshold&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None).&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">superimpose_overlay_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">video_path</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">find_all_videos_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">video_path</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1"> is not a valid file path or a valid directory path&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">video_to_bw</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">video_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="n">threshold</span><span class="p">)</span>
    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Converting video </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1"> to black and white (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s1">)...&#39;</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">_bw</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ffmpeg -i &#39;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s2">&#39; -vf </span><span class="se">\&quot;</span><span class="s2">format=gray,geq=lum_expr=&#39;if(lt(lum(X,Y),</span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">),0,255)&#39;</span><span class="se">\&quot;</span><span class="s2"> -pix_fmt yuv420p &#39;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&#39; -loglevel error -stats -hide_banner -y&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ffmpeg -hwaccel auto -i &#39;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s2">&#39; -vf </span><span class="se">\&quot;</span><span class="s2">format=gray,geq=lum_expr=&#39;if(lt(lum(X,Y),</span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">),0,255)&#39;</span><span class="se">\&quot;</span><span class="s2"> -c:v h264_nvenc &#39;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&#39; -loglevel error -stats -hide_banner -y&quot;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
        <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Video </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1"> converted to black and white.&#39;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>

<span class="c1">#video_to_bw(video_path=&#39;/Users/simon/Desktop/Screen Recording 2024-05-08 at 10.57.59 AM_upsampled_time_superimposed.mov&#39;, threshold=0.5)</span>


<div class="viewcode-block" id="create_average_frm"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.create_average_frm">[docs]</a><span class="k">def</span> <span class="nf">create_average_frm</span><span class="p">(</span><span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                       <span class="n">start_frm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">end_frm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">start_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">end_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an image representing the average frame of a segment in a video or an entire video.</span>

<span class="sd">    .. video:: _static/img/create_average_frm_1.webm</span>
<span class="sd">       :width: 800</span>
<span class="sd">       :autoplay:</span>
<span class="sd">       :loop:</span>

<span class="sd">    .. video:: _static/img/create_average_frm_2.webm</span>
<span class="sd">       :width: 800</span>
<span class="sd">       :autoplay:</span>
<span class="sd">       :loop:</span>

<span class="sd">    .. video:: _static/img/create_average_frm_3.webm</span>
<span class="sd">       :width: 800</span>
<span class="sd">       :autoplay:</span>
<span class="sd">       :loop:</span>

<span class="sd">    .. video:: _static/img/create_average_frm_4.webm</span>
<span class="sd">       :width: 800</span>
<span class="sd">       :autoplay:</span>
<span class="sd">       :loop:</span>

<span class="sd">    .. note::</span>
<span class="sd">       Useful helper for e.g., video background subtraction ``simba.video_processors.video_processing.video_bg_substraction()``</span>
<span class="sd">       Either pass ``start_frm`` and ``end_frm`` OR ``start_time`` and ``end_time`` OR pass all four arguments as None.</span>
<span class="sd">       If all are None, then the entire video will be used to create the average frame.</span>

<span class="sd">    :param Union[str, os.PathLike] video_path: The path to the video to create the average frame from. Default: None.</span>
<span class="sd">    :param Optional[int] start_frm: The first frame in the segment to create the average frame from. Default: None.</span>
<span class="sd">    :param Optional[int] end_frm: The last frame in the segment to create the average frame from. Default: None.</span>
<span class="sd">    :param Optional[str] start_time: The start timestamp in `HH:MM:SS` format in the segment to create the average frame from. Default: None.</span>
<span class="sd">    :param Optional[str] end_time: The end timestamp in `HH:MM:SS` format in the segment to create the average frame from. Default: None.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_path: The path to where to save the average image. If None, then returns the average image in np,ndarray format. Default: None.</span>
<span class="sd">    :return Union[None, np.ndarray]: The average image (if ``save_path`` is not None) or None if  ``save_path`` is passed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">start_frm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">end_frm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">and</span> <span class="p">((</span><span class="n">start_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">end_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Pass start_frm and end_frm OR start_time and end_time&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">create_average_frm</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">start_frm</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">end_frm</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Pass start frame and end frame&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">create_average_frm</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">end_time</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Pass start time and end time&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">create_average_frm</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Getting average frame from </span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">start_frm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">end_frm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;start_frm&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">start_frm</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;frame_count&#39;</span><span class="p">])</span>
        <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;end_frm&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">end_frm</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;frame_count&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">start_frm</span> <span class="o">&gt;</span> <span class="n">end_frm</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Start frame (</span><span class="si">{</span><span class="n">start_frm</span><span class="si">}</span><span class="s1">) has to be before end frame (</span><span class="si">{</span><span class="n">end_frm</span><span class="si">}</span><span class="s1">).&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">create_average_frm</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">frame_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start_frm</span><span class="p">,</span> <span class="n">end_frm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">start_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">end_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">check_if_string_value_is_valid_video_timestamp</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">create_average_frm</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">check_if_string_value_is_valid_video_timestamp</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">create_average_frm</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">check_that_hhmmss_start_is_before_end</span><span class="p">(</span><span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">create_average_frm</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">check_if_hhmmss_timestamp_is_valid_part_of_video</span><span class="p">(</span><span class="n">timestamp</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
        <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">find_frame_numbers_from_time_stamp</span><span class="p">(</span><span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;fps&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">frame_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;frame_count&#39;</span><span class="p">]))</span>
    <span class="n">cap</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">frame_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">bg_sum</span><span class="p">,</span> <span class="n">frm_cnt</span><span class="p">,</span> <span class="n">frm_len</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_ids</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">frm_cnt</span> <span class="o">&lt;</span> <span class="n">frm_len</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reading frame </span><span class="si">{</span><span class="n">frm_cnt</span><span class="si">}</span><span class="s1"> / </span><span class="si">{</span><span class="n">frm_len</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">)...&#39;</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">frm</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bg_sum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">bg_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">frm</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="n">frm</span><span class="p">,</span> <span class="n">bg_sum</span><span class="p">)</span>
            <span class="n">frm_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">convertScaleAbs</span><span class="p">(</span><span class="n">bg_sum</span> <span class="o">/</span> <span class="n">frm_len</span><span class="p">)</span>
    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">save_path</span><span class="p">),</span> <span class="n">source</span><span class="o">=</span><span class="n">create_average_frm</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Saved average frame at </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">create_average_frm</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">img</span></div>


<div class="viewcode-block" id="video_bg_subtraction"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.video_bg_subtraction">[docs]</a><span class="k">def</span> <span class="nf">video_bg_subtraction</span><span class="p">(</span><span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                         <span class="n">bg_video_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">bg_start_frm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">bg_end_frm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">bg_start_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">bg_end_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">bg_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                         <span class="n">fg_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subtract the background from a video.</span>

<span class="sd">    .. video:: _static/img/video_bg_subtraction.webm</span>
<span class="sd">       :width: 800</span>
<span class="sd">       :autoplay:</span>
<span class="sd">       :loop:</span>

<span class="sd">    .. video:: _static/img/bg_remover_example_1.webm</span>
<span class="sd">       :width: 800</span>
<span class="sd">       :autoplay:</span>
<span class="sd">       :loop:</span>

<span class="sd">    .. video:: _static/img/bg_remover_example_2.webm</span>
<span class="sd">       :width: 800</span>
<span class="sd">       :autoplay:</span>
<span class="sd">       :loop:</span>

<span class="sd">    .. note::</span>
<span class="sd">       If  ``bg_video_path`` is passed, that video will be used to parse the background. If None, ``video_path`` will be use dto parse background.</span>
<span class="sd">       Either pass ``start_frm`` and ``end_frm`` OR ``start_time`` and ``end_time`` OR pass all four arguments as None.</span>
<span class="sd">       Those two arguments will be used to slice the background video, and the sliced part is used to parse the background.</span>

<span class="sd">       For example, in the scenario where there is **no** animal in the ``video_path`` video for the first 20s, then the first 20s can be used to parse the background.</span>
<span class="sd">       In this scenario, ``bg_video_path`` can be passed as ``None`` and bg_start_time and bg_end_time can be ``00:00:00`` and ``00:00:20``, repectively.</span>

<span class="sd">       In the scenario where there **is** animal(s) in the entire ``video_path`` video, pass ``bg_video_path`` as a path to a video recording the arena without the animals.</span>

<span class="sd">    :param Union[str, os.PathLike] video_path: The path to the video to remove the background from.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] bg_video_path: Path to the video which contains a segment with the background only. If None, then ``video_path`` will be used.</span>
<span class="sd">    :param Optional[int] bg_start_frm: The first frame in the background video to use when creating a representative background image. Default: None.</span>
<span class="sd">    :param Optional[int] bg_end_frm: The last frame in the background video to use when creating a representative background image. Default: None.</span>
<span class="sd">    :param Optional[str] bg_start_time: The start timestamp in `HH:MM:SS` format in the background video to use to create a representative background image. Default: None.</span>
<span class="sd">    :param Optional[str] bg_end_time: The end timestamp in `HH:MM:SS` format in the background video to use to create a representative background image. Default: None.</span>
<span class="sd">    :param Optional[Tuple[int, int, int]] bg_color: The RGB color of the moving objects in the output video. Defaults to None, which represents the original colors of the moving objects.</span>
<span class="sd">    :param Optional[Tuple[int, int, int]] fg_color: The RGB color of the background output video. Defaults to black (0, 0, 0).</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_path: The patch to where to save the output video where the background is removed. If None, saves the output video in the same directory as the input video with the ``_bg_subtracted`` suffix. Default: None.</span>
<span class="sd">    :return: None.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; video_bg_subtraction(video_path=&#39;/Users/simon/Downloads/1_LH_cropped.mp4&#39;, bg_start_time=&#39;00:00:00&#39;, bg_end_time=&#39;00:00:10&#39;, bg_color=(0, 106, 167), fg_color=(254, 204, 2))</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bg_video_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bg_video_path</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="nb">dir</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">_bg_subtracted</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">save_path</span><span class="p">),</span> <span class="n">source</span><span class="o">=</span><span class="n">video_bg_substraction_mp</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">fourcc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter_fourcc</span><span class="p">(</span><span class="o">*</span><span class="n">Formats</span><span class="o">.</span><span class="n">MP4_CODEC</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">fourcc</span><span class="p">,</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;fps&#39;</span><span class="p">],(</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">],</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]))</span>
    <span class="n">bg_frm</span> <span class="o">=</span> <span class="n">create_average_frm</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">bg_video_path</span><span class="p">,</span> <span class="n">start_frm</span><span class="o">=</span><span class="n">bg_start_frm</span><span class="p">,</span> <span class="n">end_frm</span><span class="o">=</span><span class="n">bg_end_frm</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="n">bg_start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="n">bg_end_time</span><span class="p">)</span>
    <span class="n">bg_frm</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">bg_frm</span><span class="p">,</span> <span class="p">(</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">],</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]))</span>
    <span class="n">bg</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">bg_frm</span><span class="p">,</span> <span class="n">bg_color</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">frm_cnt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">frm</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">absdiff</span><span class="p">(</span><span class="n">frm</span><span class="p">,</span> <span class="n">bg_frm</span><span class="p">)</span>
        <span class="n">gray_diff</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">gray_diff</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fg_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fg</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">frm</span><span class="p">,</span> <span class="n">frm</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">bg</span><span class="p">,</span> <span class="n">fg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask_inv</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_not</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
            <span class="n">fg_clr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">frm</span><span class="p">,</span> <span class="n">fg_color</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
            <span class="n">fg_clr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">fg_clr</span><span class="p">,</span> <span class="n">fg_clr</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">bg</span><span class="p">,</span> <span class="n">bg</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask_inv</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">fg_clr</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="n">frm_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Background subtraction frame </span><span class="si">{</span><span class="n">frm_cnt</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> (Video: </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

    <span class="n">writer</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Background subtracted from </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1"> and saved at </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">_bg_remover_mp</span><span class="p">(</span><span class="n">frm_range</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
                   <span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                   <span class="n">bg_frm</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                   <span class="n">bg_clr</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
                   <span class="n">fg_clr</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
                   <span class="n">video_meta_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
                   <span class="n">temp_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                   <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>

    <span class="n">batch</span><span class="p">,</span> <span class="n">frm_range</span> <span class="o">=</span> <span class="n">frm_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">frm_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">start_frm</span><span class="p">,</span> <span class="n">current_frm</span><span class="p">,</span> <span class="n">end_frm</span> <span class="o">=</span> <span class="n">frm_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">frm_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">frm_range</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">fourcc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter_fourcc</span><span class="p">(</span><span class="o">*</span><span class="n">Formats</span><span class="o">.</span><span class="n">MP4_CODEC</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">batch</span><span class="si">}</span><span class="s2">.mp4&quot;</span><span class="p">)</span>
    <span class="n">cap</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_frm</span><span class="p">)</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">fourcc</span><span class="p">,</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;fps&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">],</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]))</span>
    <span class="n">bg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">bg_frm</span><span class="p">,</span> <span class="n">bg_clr</span><span class="p">)</span>
    <span class="n">bg</span> <span class="o">=</span> <span class="n">bg</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="nb">dir</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">current_frm</span> <span class="o">&lt;=</span> <span class="n">end_frm</span><span class="p">:</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">frm</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">absdiff</span><span class="p">(</span><span class="n">frm</span><span class="p">,</span> <span class="n">bg_frm</span><span class="p">)</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">diff</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">diff</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">diff</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">gray_diff</span> <span class="o">=</span> <span class="mf">0.2989</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="mf">0.5870</span> <span class="o">*</span> <span class="n">g</span> <span class="o">+</span> <span class="mf">0.1140</span> <span class="o">*</span> <span class="n">b</span>
        <span class="n">gray_diff</span> <span class="o">=</span> <span class="n">gray_diff</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>  <span class="c1"># Ensure the type is uint8</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">gray_diff</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fg_clr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fg</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">frm</span><span class="p">,</span> <span class="n">frm</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">bg</span><span class="p">,</span> <span class="n">fg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask_inv</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_not</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
            <span class="n">fg_clr_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">frm</span><span class="p">,</span> <span class="n">fg_clr</span><span class="p">)</span>
            <span class="n">fg_clr_img</span> <span class="o">=</span> <span class="n">fg_clr_img</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">fg_clr_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">fg_clr_img</span><span class="p">,</span> <span class="n">fg_clr_img</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">bg</span><span class="p">,</span> <span class="n">bg</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask_inv</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">fg_clr_img</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="n">current_frm</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Background subtraction frame </span><span class="si">{</span><span class="n">current_frm</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> (Video: </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">batch</span>

<div class="viewcode-block" id="video_bg_substraction_mp"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.video_bg_substraction_mp">[docs]</a><span class="k">def</span> <span class="nf">video_bg_substraction_mp</span><span class="p">(</span><span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                             <span class="n">bg_video_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">bg_start_frm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">bg_end_frm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">bg_start_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">bg_end_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">bg_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                             <span class="n">fg_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">core_cnt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                             <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subtract the background from a video using multiprocessing.</span>

<span class="sd">    .. video:: _static/img/video_bg_substraction_mp.webm</span>
<span class="sd">       :width: 900</span>
<span class="sd">       :autoplay:</span>
<span class="sd">       :loop:</span>

<span class="sd">    .. video:: _static/img/bg_remover_example_3.webm</span>
<span class="sd">       :width: 900</span>
<span class="sd">       :autoplay:</span>
<span class="sd">       :loop:</span>

<span class="sd">    .. video:: _static/img/bg_remover_example_4.webm</span>
<span class="sd">       :width: 900</span>
<span class="sd">       :autoplay:</span>
<span class="sd">       :loop:</span>

<span class="sd">    .. note::</span>
<span class="sd">        For single core alternative, see ``simba.video_processors.video_processing.video_bg_subtraction``</span>

<span class="sd">       If  ``bg_video_path`` is passed, that video will be used to parse the background. If None, ``video_path`` will be use dto parse background.</span>
<span class="sd">       Either pass ``start_frm`` and ``end_frm`` OR ``start_time`` and ``end_time`` OR pass all four arguments as None.</span>
<span class="sd">       Those two arguments will be used to slice the background video, and the sliced part is used to parse the background.</span>

<span class="sd">       For example, in the scenario where there is **no** animal in the ``video_path`` video for the first 20s, then the first 20s can be used to parse the background.</span>
<span class="sd">       In this scenario, ``bg_video_path`` can be passed as ``None`` and bg_start_time and bg_end_time can be ``00:00:00`` and ``00:00:20``, repectively.</span>

<span class="sd">       In the scenario where there **is** animal(s) in the entire ``video_path`` video, pass ``bg_video_path`` as a path to a video recording the arena without the animals.</span>

<span class="sd">    :param Union[str, os.PathLike] video_path: The path to the video to remove the background from.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] bg_video_path: Path to the video which contains a segment with the background only. If None, then ``video_path`` will be used.</span>
<span class="sd">    :param Optional[int] bg_start_frm: The first frame in the background video to use when creating a representative background image. Default: None.</span>
<span class="sd">    :param Optional[int] bg_end_frm: The last frame in the background video to use when creating a representative background image. Default: None.</span>
<span class="sd">    :param Optional[str] bg_start_time: The start timestamp in `HH:MM:SS` format in the background video to use to create a representative background image. Default: None.</span>
<span class="sd">    :param Optional[str] bg_end_time: The end timestamp in `HH:MM:SS` format in the background video to use to create a representative background image. Default: None.</span>
<span class="sd">    :param Optional[Tuple[int, int, int]] bg_color: The RGB color of the moving objects in the output video. Defaults to None, which represents the original colors of the moving objects.</span>
<span class="sd">    :param Optional[Tuple[int, int, int]] fg_color: The RGB color of the background output video. Defaults to black (0, 0, 0).</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_path: The patch to where to save the output video where the background is removed. If None, saves the output video in the same directory as the input video with the ``_bg_subtracted`` suffix. Default: None.</span>
<span class="sd">    :param Optional[int] core_cnt: The number of cores to use. Defaults to -1 representing all available cores.</span>
<span class="sd">    :return: None.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; video_bg_substraction_mp(video_path=&#39;/Users/simon/Downloads/1_LH.mp4&#39;, bg_start_time=&#39;00:00:00&#39;, bg_end_time=&#39;00:00:10&#39;, bg_color=(0, 0, 0), fg_color=(255, 255, 255))</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bg_video_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bg_video_path</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="nb">dir</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">_bg_subtracted</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">save_path</span><span class="p">),</span> <span class="n">source</span><span class="o">=</span><span class="n">video_bg_substraction_mp</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
    <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;temp_</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">dt</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_bg_substraction_mp</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> core_cnt&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">core_cnt</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="n">find_core_cnt</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">core_cnt</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">core_cnt</span> <span class="o">=</span> <span class="n">find_core_cnt</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">bg_frm</span> <span class="o">=</span> <span class="n">create_average_frm</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">bg_video_path</span><span class="p">,</span> <span class="n">start_frm</span><span class="o">=</span><span class="n">bg_start_frm</span><span class="p">,</span> <span class="n">end_frm</span><span class="o">=</span><span class="n">bg_end_frm</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="n">bg_start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="n">bg_end_time</span><span class="p">)</span>
    <span class="n">bg_frm</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">bg_frm</span><span class="p">,</span> <span class="p">(</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">],</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]))</span>
    <span class="n">bg_frm</span> <span class="o">=</span> <span class="n">bg_frm</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">frm_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;frame_count&#39;</span><span class="p">])),</span> <span class="n">core_cnt</span><span class="p">)</span>
    <span class="n">frm_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frm_list</span><span class="p">):</span>
        <span class="n">frm_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
    <span class="k">with</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">core_cnt</span><span class="p">,</span> <span class="n">maxtasksperchild</span><span class="o">=</span><span class="mi">9000</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">constants</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">_bg_remover_mp</span><span class="p">,</span>
                                      <span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">,</span>
                                      <span class="n">bg_frm</span><span class="o">=</span><span class="n">bg_frm</span><span class="p">,</span>
                                      <span class="n">bg_clr</span><span class="o">=</span><span class="n">bg_color</span><span class="p">,</span>
                                      <span class="n">fg_clr</span><span class="o">=</span><span class="n">fg_color</span><span class="p">,</span>
                                      <span class="n">video_meta_data</span><span class="o">=</span><span class="n">video_meta_data</span><span class="p">,</span>
                                      <span class="n">temp_dir</span><span class="o">=</span><span class="n">temp_dir</span><span class="p">,</span>
                                      <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">constants</span><span class="p">,</span> <span class="n">frm_data</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Frame batch </span><span class="si">{</span><span class="n">result</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> completed...&#39;</span><span class="p">)</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Joining </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2"> multiprocessed video...&quot;</span><span class="p">)</span>
    <span class="n">concatenate_videos_in_folder</span><span class="p">(</span><span class="n">in_folder</span><span class="o">=</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span> <span class="n">video_format</span><span class="o">=</span><span class="n">ext</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">remove_splits</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gpu</span><span class="o">=</span><span class="n">gpu</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Video saved at </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>


<span class="c1">#video_bg_subtraction(video_path=r&quot;C:\troubleshooting\open_field_below\project_folder\videos\TheVideoName_text_superimposed_0.mp4&quot;, bg_color=(0, 0, 0), fg_color=(255, 255, 255))</span>

<div class="viewcode-block" id="superimpose_video_names"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.superimpose_video_names">[docs]</a><span class="k">def</span> <span class="nf">superimpose_video_names</span><span class="p">(</span><span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                            <span class="n">font</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Arial&#39;</span><span class="p">,</span>
                            <span class="n">font_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
                            <span class="n">font_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span>
                            <span class="n">font_border_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                            <span class="n">font_border_width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="n">position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;top_left&#39;</span><span class="p">,</span> <span class="s1">&#39;top_right&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_left&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_right&#39;</span><span class="p">,</span> <span class="s1">&#39;middle_top&#39;</span><span class="p">,</span> <span class="s1">&#39;middle_bottom&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;top_left&#39;</span><span class="p">,</span>
                            <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Superimposes the video name on the given video file(s) and saves the modified video(s).</span>

<span class="sd">    .. video:: _static/img/superimpose_video_names.webm</span>
<span class="sd">       :width: 900</span>
<span class="sd">       :loop:</span>

<span class="sd">    :param Union[str, os.PathLike] video_path: Path to the input video file or directory containing video files.</span>
<span class="sd">    :param Optional[int] font_size: Font size for the video name text. Default 30.</span>
<span class="sd">    :param Optional[str] font_color:  Font color for the video name text. Default white</span>
<span class="sd">    :param Optional[str] font_border_color: Font border color for the video name text. Default black.</span>
<span class="sd">    :param Optional[int] font_border_width: Font border width for the video name text in pixels. Default 2.</span>
<span class="sd">    :param Optional[Literal[&#39;top_left&#39;, &#39;top_right&#39;, &#39;bottom_left&#39;, &#39;bottom_right&#39;, &#39;top_middle&#39;, &#39;bottom_middle&#39;]] position: Position where the video name will be superimposed. Default ``top_left``.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_dir: Directory where the modified video(s) will be saved. If not provided, the directory of the input video(s) will be used.</span>
<span class="sd">    :param Optional[bool] gpu: If True, uses GPU codecs with potentially faster runtimes. Default: False.</span>

<span class="sd">    :return: None</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; superimpose_video_names(video_path=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/mouse_open_field/project_folder/videos/test_4/1.mp4&#39;, position=&#39;middle_top&#39;, font_color=&#39;black&#39;, font_border_color=&#39;pink&#39;, font_border_width=5, font_size=30)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None).&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">superimpose_overlay_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">POSITIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;top_left&#39;</span><span class="p">,</span> <span class="s1">&#39;top_right&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_left&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_right&#39;</span><span class="p">,</span> <span class="s1">&#39;top_middle&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_middle&#39;</span><span class="p">]</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">superimpose_video_names</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> position&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">POSITIONS</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">superimpose_video_names</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> font_size&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">font_size</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">superimpose_video_names</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> font_border_width&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">font_border_width</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">font_dict</span> <span class="o">=</span> <span class="n">get_fonts</span><span class="p">()</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">font_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">font_path</span> <span class="o">=</span> <span class="n">font_dict</span><span class="p">[</span><span class="n">font</span><span class="p">]</span>
    <span class="n">font_color</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isalnum</span><span class="p">,</span> <span class="n">font_color</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">font_border_color</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isalnum</span><span class="p">,</span> <span class="n">font_border_color</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">video_path</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">find_all_videos_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">video_path</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1"> is not a valid file path or a valid directory path&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">superimpose_video_names</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">video_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Superimposing video name on </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1"> (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s1">)...&#39;</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">_video_name_superimposed</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">:x=5:y=5:fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">:x=5:y=5:fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">:x=(w-tw-5):y=5:fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">:x=(w-tw-5):y=5:fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:v h264_nvenc -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">:x=5:y=(h-th-5):fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">:x=5:y=(h-th-5):fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">:x=(w-tw-5):y=(h-th-5):fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">:x=(w-tw-5):y=(h-th-5):fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>

        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">:x=(w-tw)/2:y=10:fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">:x=(w-tw)/2:y=10:fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">:x=(w-tw)/2:y=(h-th-10):fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">:x=(w-tw)/2:y=(h-th-10):fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Super-imposed video name on </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s1"> video(s), saved in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>

<div class="viewcode-block" id="superimpose_freetext"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.superimpose_freetext">[docs]</a><span class="k">def</span> <span class="nf">superimpose_freetext</span><span class="p">(</span><span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                         <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                         <span class="n">font</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Arial&#39;</span><span class="p">,</span>
                         <span class="n">font_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
                         <span class="n">font_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span>
                         <span class="n">font_border_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                         <span class="n">font_border_width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                         <span class="n">position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;top_left&#39;</span><span class="p">,</span> <span class="s1">&#39;top_right&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_left&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_right&#39;</span><span class="p">,</span> <span class="s1">&#39;middle_top&#39;</span><span class="p">,</span> <span class="s1">&#39;middle_bottom&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;top_left&#39;</span><span class="p">,</span>
                         <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Superimposes passed text on the given video file(s) and saves the modified video(s).</span>

<span class="sd">    .. video:: _static/img/superimpose_freetext.webm</span>
<span class="sd">       :width: 900</span>
<span class="sd">       :loop:</span>

<span class="sd">    :param Union[str, os.PathLike] video_path: Path to the input video file or directory containing video files.</span>
<span class="sd">    :param str text: The text to overlay on the video</span>
<span class="sd">    :param Optional[int] font_size: Font size for the text. Default 30.</span>
<span class="sd">    :param Optional[str] font_color:  Font color for text. Default white</span>
<span class="sd">    :param Optional[str] font_border_color: Font border color for the text. Default black.</span>
<span class="sd">    :param Optional[int] font_border_width: Font border width for the text in pixels. Default 2.</span>
<span class="sd">    :param Optional[Literal[&#39;top_left&#39;, &#39;top_right&#39;, &#39;bottom_left&#39;, &#39;bottom_right&#39;, &#39;top_middle&#39;, &#39;bottom_middle&#39;]] position: Position where the text will be superimposed. Default ``top_left``.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_dir: Directory where the modified video(s) will be saved. If not provided, the directory of the input video(s) will be used.</span>
<span class="sd">    :param Optional[bool] gpu: If True, uses GPU codecs with potentially faster runtimes. Default: False.</span>

<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None).&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">superimpose_overlay_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">POSITIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;top_left&#39;</span><span class="p">,</span> <span class="s1">&#39;top_right&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_left&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_right&#39;</span><span class="p">,</span> <span class="s1">&#39;top_middle&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_middle&#39;</span><span class="p">]</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">superimpose_freetext</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> position&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">POSITIONS</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">superimpose_freetext</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> font_size&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">font_size</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">superimpose_freetext</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> font_border_width&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">font_border_width</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">superimpose_freetext</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> text&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>
    <span class="n">font_dict</span> <span class="o">=</span> <span class="n">get_fonts</span><span class="p">()</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">font_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">font_path</span> <span class="o">=</span> <span class="n">font_dict</span><span class="p">[</span><span class="n">font</span><span class="p">]</span>
    <span class="n">font_color</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isalnum</span><span class="p">,</span> <span class="n">font_color</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">font_border_color</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isalnum</span><span class="p">,</span> <span class="n">font_border_color</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">video_path</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">find_all_videos_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">video_path</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1"> is not a valid file path or a valid directory path&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">superimpose_video_names</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">video_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Superimposing video name on </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1"> (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s1">)...&#39;</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">_text_superimposed</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s1">:x=5:y=5:fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s1">:x=(w-tw-5):y=5:fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s1">:x=5:y=(h-th-5):fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s1">:x=(w-tw-5):y=(h-th-5):fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">POSITIONS</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s1">:x=(w-tw)/2:y=10:fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf </span><span class="se">\&quot;</span><span class="s1">drawtext=fontfile=</span><span class="si">{</span><span class="n">font_path</span><span class="si">}</span><span class="s1">:text=</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s1">:x=(w-tw)/2:y=(h-th-10):fontsize=</span><span class="si">{</span><span class="n">font_size</span><span class="si">}</span><span class="s1">:fontcolor=</span><span class="si">{</span><span class="n">font_color</span><span class="si">}</span><span class="s1">:borderw=</span><span class="si">{</span><span class="n">font_border_width</span><span class="si">}</span><span class="s1">:bordercolor=</span><span class="si">{</span><span class="n">font_border_color</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1"> -c:a copy &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -hide_banner -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Super-imposed free-text on </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s1"> video(s), saved in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>


<div class="viewcode-block" id="rotate_video"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.rotate_video">[docs]</a><span class="k">def</span> <span class="nf">rotate_video</span><span class="p">(</span><span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                 <span class="n">degrees</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
                 <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rotate a video or a directory of videos by a specified number of degrees.</span>

<span class="sd">    :param Union[str, os.PathLike] video_path: Path to the input video file or directory containing video files.</span>
<span class="sd">    :param int degrees: Number of degrees (between 1 and 359, inclusive) to rotate the video clockwise.</span>
<span class="sd">    :param Optional[bool] gpu: If True, attempt to use GPU acceleration for rotation (default is False).</span>
<span class="sd">    :param Optional[int] quality: Quality of the output video, an integer between 1 and 100 (default is 60).</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_dir: Directory to save the rotated video(s). If None, the directory of the input video(s) will be used.</span>
<span class="sd">    :return: None.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; rotate_video(video_path=&#39;/Users/simon/Desktop/envs/simba/troubleshooting/reptile/rot_test.mp4&#39;, degrees=180)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rotate_video</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> font_size&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">degrees</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">359</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rotate_video</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> quality&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">quality</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None)&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">rotate_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">crf_lk</span> <span class="o">=</span> <span class="n">percent_to_crf_lookup</span><span class="p">()</span>
    <span class="n">crf</span> <span class="o">=</span> <span class="n">crf_lk</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">quality</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">video_path</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">find_all_videos_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">video_path</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1"> is not a valid file path or a valid directory path&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">rotate_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">video_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rotating video </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">degrees</span><span class="si">}</span><span class="s1"> degrees (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s1">)...&#39;</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">_rotated</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;hwupload_cuda,rotate=</span><span class="si">{</span><span class="n">degrees</span><span class="si">}</span><span class="s1">*(PI/180),format=nv12|cuda&quot; -c:v h264_nvenc &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;rotate=</span><span class="si">{</span><span class="n">degrees</span><span class="si">}</span><span class="s1">*(PI/180)&quot; -c:v libx264 -crf </span><span class="si">{</span><span class="n">crf</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> video(s) ratated </span><span class="si">{</span><span class="n">degrees</span><span class="si">}</span><span class="s2"> and saved in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> directory.&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">rotate_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,)</span></div>


<div class="viewcode-block" id="flip_videos"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.flip_videos">[docs]</a><span class="k">def</span> <span class="nf">flip_videos</span><span class="p">(</span><span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                <span class="n">horizontal_flip</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">vertical_flip</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
                <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flip a video or directory of videos horizontally, vertically, or both, and save them to the specified directory.</span>

<span class="sd">    .. video:: _static/img/flip_videos.webm</span>
<span class="sd">       :width: 900</span>
<span class="sd">       :loop:</span>
<span class="sd">       :autoplay:</span>

<span class="sd">    :param Union[str, os.PathLike] video_path: Path to the input video file or directory containing video files.</span>
<span class="sd">    :param Optional[bool] horizontal_flip: If True, flip the video(s) horizontally (default is False).</span>
<span class="sd">    :param Optional[bool] vertical_flip: If True, flip the video(s) vertically (default is False).</span>
<span class="sd">    :param Optional[int] quality: Quality of the output video, an integer between 1 and 100 (default is 60).</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_dir: Directory to save the flipped video(s). If None, the directory of the input video(s) will be used.</span>
<span class="sd">    :param Optional[bool] gpu: If True, attempt to use GPU acceleration for rotation (default is False).</span>
<span class="sd">    :return: None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None)&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">rotate_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rotate_video</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> quality&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">quality</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">horizontal_flip</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">vertical_flip</span><span class="p">:</span> <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Flip videos vertically and/or horizontally. Got both as False&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">flip_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">crf_lk</span> <span class="o">=</span> <span class="n">percent_to_crf_lookup</span><span class="p">()</span>
    <span class="n">crf</span> <span class="o">=</span> <span class="n">crf_lk</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">quality</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">video_path</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">find_all_videos_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">video_path</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1"> is not a valid file path or a valid directory path&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">flip_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">video_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Flipping video </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1"> (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s1">)...&#39;</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">_flipped</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vertical_flip</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">horizontal_flip</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;vflip&quot; -c:v libx264 -crf </span><span class="si">{</span><span class="n">crf</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;vflip&quot; -c:v h264_nvenc -preset medium &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -y&#39;</span>
        <span class="k">elif</span> <span class="n">horizontal_flip</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">vertical_flip</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;hflip&quot; -c:v libx264 -crf </span><span class="si">{</span><span class="n">crf</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;hflip&quot; -c:v h264_nvenc -crf medium &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;hflip,vflip&quot; -c:v libx264 -crf </span><span class="si">{</span><span class="n">crf</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">&quot; -vf &quot;hflip,vflip&quot; -c:v h264_nvenc -crf medium &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -loglevel error -stats -y&#39;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> video(s) flipped and saved in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> directory.&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">flip_videos</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>


<div class="viewcode-block" id="upsample_fps"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.upsample_fps">[docs]</a><span class="k">def</span> <span class="nf">upsample_fps</span><span class="p">(</span><span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                 <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
                 <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Upsample the frame rate of a video or all videos in a directory to a specified fps with a given quality.</span>

<span class="sd">    .. note::</span>
<span class="sd">       Uses ``ffmpeg minterpolate``</span>

<span class="sd">    .. warning::</span>
<span class="sd">       Long run-times for higher resolution videos.</span>

<span class="sd">    :param Union[str, os.PathLike] video_path: The path to the input video file or directory containing video files.</span>
<span class="sd">    :param int fps: The target frame rate to upsample the video(s) to.</span>
<span class="sd">    :param Optional[int] quality: The quality level of the output video(s), represented as a percentage (1-100). Lower values indicate higher quality. Default is 60.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_dir: The directory to save the upsampled video(s). If None, the videos will be saved in the same directory as the input video(s).</span>
<span class="sd">    :return: None. The function saves the upsampled video(s) to the specified directory.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; upsample_fps(video_path=&#39;/Users/simon/Desktop/Box2_IF19_7_20211109T173625_4_851_873_1_cropped.mp4&#39;, fps=100, quality=100)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_ffmpeg_available</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">upsample_fps</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> quality&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">quality</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">check_float</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">upsample_fps</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> fps&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">quality</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mf">10e-16</span><span class="p">)</span>
    <span class="n">crf_lk</span> <span class="o">=</span> <span class="n">percent_to_crf_lookup</span><span class="p">()</span>
    <span class="n">crf</span> <span class="o">=</span> <span class="n">crf_lk</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">quality</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">video_path</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">video_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">find_all_videos_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">video_path</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1"> is not a valid file path or a valid directory path&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">rotate_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">video_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">video_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
        <span class="n">input_video_meta</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">input_video_meta</span><span class="p">[</span><span class="s1">&#39;fps&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">fps</span><span class="p">:</span>
            <span class="n">FrameRangeWarning</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;The FPS of the input video named </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">input_video_meta</span><span class="p">[</span><span class="s1">&#39;fps&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">) is the same or larger than the upscaled target FPS (</span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">upsample_fps</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Up-sampling video </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s1"> FPS (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s1">)...&#39;</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">_upsampled</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;ffmpeg -i &quot;</span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s2">&quot; -filter:v &quot;minterpolate=&#39;fps=</span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s2">:scd=none:mi_mode=mci:mc_mode=aobmc:me_mode=bidir:me=epzs:search_param=16:vsbmc=1&#39;&quot; -c:v libx264 -crf </span><span class="si">{</span><span class="n">crf</span><span class="si">}</span><span class="s2"> &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot; -loglevel error -stats -y&quot;&quot;&quot;</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> video(s) upsampled to </span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s2"> and saved in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> directory.&quot;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">upsample_fps</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">)</span></div>

<div class="viewcode-block" id="temporal_concatenation"><a class="viewcode-back" href="../../../simba.video_processors.html#simba.video_processors.video_processing.temporal_concatenation">[docs]</a><span class="k">def</span> <span class="nf">temporal_concatenation</span><span class="p">(</span><span class="n">video_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]],</span>
                           <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="n">save_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;mp4&#39;</span><span class="p">,</span> <span class="s1">&#39;mov&#39;</span><span class="p">,</span> <span class="s1">&#39;avi&#39;</span><span class="p">,</span> <span class="s1">&#39;webm&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;mp4&#39;</span><span class="p">,</span>
                           <span class="n">quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
                           <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Concatenates multiple video files temporally into a single video.</span>

<span class="sd">    :param List[Union[str, os.PathLike]] video_paths: List of paths to video files to be temporally joined. The videos will be joined in the order appearance in the list.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_path: The location where to save the temporally concatenated videos. If None, then the video is saved in the same directory as the first video in ``video_paths`` with the name ``temporal_concat_video``.</span>
<span class="sd">    :param Optional[Literal[&#39;mp4&#39;, &#39;mov&#39;, &#39;avi&#39;, &#39;webm&#39;]] save_format: The video format of the concatenated video. Default: ``mp4``.</span>
<span class="sd">    :param Optional[int] quality: Integer representing the quality: 10, 20, 30.. 100.</span>
<span class="sd">    :param Optional[bool] gpu: If True, attempt to use GPU acceleration for rotation (default is False).</span>
<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No GPU found (as evaluated by nvidea-smi returning None)&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">rotate_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">check_valid_lst</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">video_paths</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">temporal_concatenation</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">valid_dtypes</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,),</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;save_format&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">save_format</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;mp4&#39;</span><span class="p">,</span> <span class="s1">&#39;mov&#39;</span><span class="p">,</span> <span class="s1">&#39;avi&#39;</span><span class="p">,</span> <span class="s1">&#39;webm&#39;</span><span class="p">))</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;quality&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">quality</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">crf_lk</span> <span class="o">=</span> <span class="n">percent_to_crf_lookup</span><span class="p">()</span>
    <span class="n">crf</span> <span class="o">=</span> <span class="n">crf_lk</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">quality</span><span class="p">)]</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">video_paths</span><span class="p">:</span>
        <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">i</span><span class="p">);</span> <span class="n">video_meta</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">video_meta</span><span class="p">)</span>
    <span class="n">fps</span><span class="p">,</span> <span class="n">resolutions</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;fps&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;resolution_str&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">]</span>
    <span class="n">unique_fps</span><span class="p">,</span> <span class="n">unique_res</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fps</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">resolutions</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_fps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ResolutionError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The selected videos contain more than one unique FPS: </span><span class="si">{</span><span class="n">unique_fps</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">temporal_concatenation</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_res</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ResolutionError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The selected videos contain more than one unique resolutions: </span><span class="si">{</span><span class="n">unique_res</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">temporal_concatenation</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">video_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="sa">f</span><span class="s1">&#39;temporal_concat_video.</span><span class="si">{</span><span class="n">save_format</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">save_path</span><span class="p">))</span>
    <span class="n">filter_complex</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">):</span>
        <span class="n">filter_complex</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">:v]&quot;</span>
    <span class="n">filter_complex</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;concat=n=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s2">:v=1[v]&quot;</span>
    <span class="n">input_options</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;-i </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">video_paths</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg </span><span class="si">{</span><span class="n">input_options</span><span class="si">}</span><span class="s1"> -filter_complex &quot;</span><span class="si">{</span><span class="n">filter_complex</span><span class="si">}</span><span class="s1">&quot; -crf </span><span class="si">{</span><span class="n">crf</span><span class="si">}</span><span class="s1"> -map &quot;[v]&quot; &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -hide_banner -loglevel error -stats -y&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto </span><span class="si">{</span><span class="n">input_options</span><span class="si">}</span><span class="s1"> -filter_complex &quot;</span><span class="si">{</span><span class="n">filter_complex</span><span class="si">}</span><span class="s1">&quot; -c:v h264_nvenc -crf medium -map &quot;[v]&quot; &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -hide_banner -loglevel error -stats -y&#39;</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span><span class="si">}</span><span class="s1"> videos temporally concatenated and saved at </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">)</span></div>



<span class="c1"># video_paths = [&#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/merge/Trial    10_clipped_gantt.mp4&#39;,</span>
<span class="c1">#                &#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/merge/Trial    10_clipped.mp4&#39;,</span>
<span class="c1">#                &#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/merge/Trial    10_clipped_line.mp4&#39;,</span>
<span class="c1">#                &#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/merge/Trial     3_clipped.mp4&#39;]</span>
<span class="c1">#</span>
<span class="c1"># video_paths = [&#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/videos/Trial    10.mp4&#39;,</span>
<span class="c1">#                &#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/merge/Trial    10_clipped_gantt.mp4&#39;,</span>
<span class="c1">#                &#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/merge/Trial    10_clipped_line.mp4&#39;,</span>
<span class="c1">#                &#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/merge/Trial     3_clipped.mp4&#39;]</span>
<span class="c1">#</span>
<span class="c1"># save_path = &#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/merge/out.mp4&#39;</span>

<span class="c1">#</span>
<span class="c1"># video_paths = [&#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/frames/output/gantt_plots/Trial    10.mp4&#39;,</span>
<span class="c1">#                &#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/videos/Trial    10.mp4&#39;,</span>
<span class="c1">#                &#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/frames/output/line_plot/Trial    10.mp4&#39;,</span>
<span class="c1">#                &#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/frames/output/line_plot/Trial     3.mp4&#39;]</span>
<span class="c1"># save_path = &#39;/Users/simon/Desktop/envs/simba/troubleshooting/RAT_NOR/project_folder/videos/test/new/blank_test.mp4&#39;</span>

<span class="c1"># video_paths = [&#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/videos/Trial    10.mp4&#39;,</span>
<span class="c1">#                &#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/frames/output/line_plot/Trial    10.mp4&#39;,</span>
<span class="c1">#                &#39;/Users/simon/Desktop/envs/simba/troubleshooting/beepboop174/project_folder/frames/output/line_plot/Trial     3.mp4&#39;]</span>

<span class="c1"># mixed_mosaic_concatenator(video_paths=video_paths, save_path=save_path, gpu=False, verbose=True)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, sronilsson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
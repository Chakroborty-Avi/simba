<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>simba.mixins.circular_statistics &mdash; SimBA 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/simba_theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />

  
    <link rel="shortcut icon" href="../../../_static/readthedocs_logo.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            SimBA
              <img src="../../../_static/readthedocs_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">API REFERENCE:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">NOTEBOOKS:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks.html">Notebooks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">USER GUIDE / TUTORIALS:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">WALKTHROUGHS:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../walkthroughs.html">Walkthroughs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">LABELLING TUTORIALS:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../labelling.html">Labelling</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials_rst/FAQ.html">Friendly Asked Questions (FAQ)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DOCS:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/workflow.html">SimBA basic workflow</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ABOUT:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../credits.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../credits.html#who-writes-this-stuff">Who writes this stuff??</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../links.html">Links</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">SimBA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">simba.mixins.circular_statistics</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for simba.mixins.circular_statistics</h1><div class="highlight"><pre>
<span></span><span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Simon Nilsson&quot;</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">float32</span><span class="p">,</span> <span class="n">float64</span><span class="p">,</span> <span class="n">int64</span><span class="p">,</span> <span class="n">jit</span><span class="p">,</span> <span class="n">njit</span><span class="p">,</span> <span class="n">prange</span><span class="p">,</span> <span class="n">typed</span><span class="p">,</span> <span class="n">types</span>


<div class="viewcode-block" id="CircularStatisticsMixin"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin">[docs]</a><span class="k">class</span> <span class="nc">CircularStatisticsMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mixin for circular statistics. Unlike linear data, circular data wrap around in a circular or periodic</span>
<span class="sd">    manner such as two measurements of e.g., 360 vs. 1 are more similar than two measurements of 1 vs. 3. Thus, the</span>
<span class="sd">    minimum and maximum values are connected, forming a closed loop, and we therefore need specialized</span>
<span class="sd">    statistical methods.</span>

<span class="sd">    These methods have support for multiple animals and base radial directions derived from two or three body-parts.</span>

<span class="sd">    Methods are adopted from the referenced packages below which are **far** more reliable. However,</span>
<span class="sd">    runtime on standard hardware (multicore CPU) is prioritized and typically orders of magnitude faster than referenced libraries.</span>

<span class="sd">    See image below for example of expected run-times for a small set of method examples included in this class.</span>

<span class="sd">    .. note::</span>
<span class="sd">        Many method has numba typed `signatures &lt;https://numba.pydata.org/numba-doc/latest/reference/types.html&gt;`_ to decrease</span>
<span class="sd">        compilation time through reduced type inference. Make sure to pass the correct dtypes as indicated by signature decorators.</span>

<span class="sd">    .. important::</span>
<span class="sd">        See references below for mature packages computing more extensive circular measurements.</span>

<span class="sd">    .. image:: _static/img/circular_statistics.png</span>
<span class="sd">       :width: 800</span>
<span class="sd">       :align: center</span>

<span class="sd">    .. image:: _static/img/circular_stats_runtimes.png</span>
<span class="sd">       :width: 1200</span>
<span class="sd">       :align: center</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] `pycircstat &lt;https://github.com/circstat/pycircstat&gt;`_.</span>
<span class="sd">    .. [2] `circstat &lt;https://www.mathworks.com/matlabcentral/fileexchange/10676-circular-statistics-toolbox-directional-statistics&gt;`_.</span>
<span class="sd">    .. [3] `pingouin.circular &lt;https://github.com/raphaelvallat/pingouin/blob/master/pingouin/circular.py&gt;`_.</span>
<span class="sd">    .. [4] `pycircular &lt;https://github.com/albahnsen/pycircular&gt;`_.</span>
<span class="sd">    .. [5] `scipy.stats.directional_stats &lt;https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.directional_stats.html&gt;`_.</span>
<span class="sd">    .. [6] `astropy.stats.circstats &lt;https://docs.astropy.org/en/stable/_modules/astropy/stats/circstats.html&gt;`_.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="CircularStatisticsMixin.mean_resultant_vector_length"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.mean_resultant_vector_length">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:],)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">mean_resultant_vector_length</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted compute of the mean resultant vector length of a single sample. Captures the overall &quot;pull&quot; or &quot;tendency&quot; of the</span>
<span class="sd">        data points towards a central direction on the circle with a range between 0 and 1.</span>

<span class="sd">        .. image:: _static/img/mean_resultant_vector.png</span>
<span class="sd">           :width: 600</span>
<span class="sd">           :align: center</span>

<span class="sd">        .. math::</span>

<span class="sd">            R = \\frac{{\\sqrt{{\\sum_{{i=1}}^N \\cos(\\theta_i - \\bar{\theta})^2 + \\sum_{{i=1}}^N \\sin(\theta_i - \\bar{\\theta})^2}}}}{{N}}</span>

<span class="sd">        where \(N\) is the number of data points, \(\theta_i\) is the angle of the ith data point, and \(\bar{\theta}\) is the mean angle.</span>

<span class="sd">        :parameter np.ndarray data: 1D array of size len(frames) representing angles in degrees.</span>
<span class="sd">        :returns float: The mean resultant vector of the angles. 1 represents tendency towards a single point. 0 represents no central point.</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([50, 90, 70, 60, 20, 90]).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().mean_resultant_vector_length(data=data)</span>
<span class="sd">        &gt;&gt;&gt; 0.9132277170817057</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">mean_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">data</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">mean_angles</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">mean_angles</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.sliding_mean_resultant_vector_length"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.sliding_mean_resultant_vector_length">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:], float64, float64[:])&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">sliding_mean_resultant_vector_length</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">time_windows</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted compute of the mean resultant vector within sliding time window. Captures the overall &quot;pull&quot; or &quot;tendency&quot; of the</span>
<span class="sd">        data points towards a central direction on the circle with a range between 0 and 1.</span>

<span class="sd">        .. attention::</span>
<span class="sd">           The returned values represents resultant vector length in the time-window ``[(current_frame-time_window)-&gt;current_frame]``.</span>
<span class="sd">           `-1` is returned where ``current_frame-time_window`` is less than 0.</span>

<span class="sd">        .. image:: _static/img/sliding_mean_resultant_length.png</span>
<span class="sd">           :width: 600</span>
<span class="sd">           :align: center</span>

<span class="sd">        :parameter np.ndarray data: 1D array of size len(data) representing degrees.</span>
<span class="sd">        :parameter np.ndarray time_window: Rolling time-window as float in seconds.</span>
<span class="sd">        :parameter int fps: fps of the recorded video</span>
<span class="sd">        :returns np.ndarray: Size len(data) x len(time_windows) representing resultant vector length in the prior ``time_window``.</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; data_1, data_2 = np.random.normal(loc=45, scale=1, size=100), np.random.normal(loc=90, scale=45, size=100)</span>
<span class="sd">        &gt;&gt;&gt; data = np.hstack([data_1, data_2])</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().sliding_mean_resultant_vector_length(data=data.astype(np.float32),time_windows=np.array([1.0]), fps=10)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">time_window_cnt</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">window_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_windows</span><span class="p">[</span><span class="n">time_window_cnt</span><span class="p">]</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">window_end</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">window_size</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">window_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">window_end</span> <span class="o">-</span> <span class="n">window_size</span><span class="p">:</span> <span class="n">window_end</span><span class="p">]</span>
                <span class="n">cos_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">window_data</span><span class="p">))</span>
                <span class="n">sin_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">window_data</span><span class="p">))</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cos_sum</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">sin_sum</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">window_data</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="n">window_end</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">time_window_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.circular_mean"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.circular_mean">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:],)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">circular_mean</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted compute of the circular mean of single sample.</span>

<span class="sd">        :parameter np.ndarray data: 1D array of size len(frames) representing angles in degrees.</span>
<span class="sd">        :returns float: The circular mean of the angles in degrees.</span>

<span class="sd">        .. image:: _static/img/mean_angle.png</span>
<span class="sd">           :width: 400</span>
<span class="sd">           :align: center</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([50, 90, 70, 60, 20, 90]).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().circular_mean(data=data)</span>
<span class="sd">        &gt;&gt;&gt; 63.737892150878906</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">))),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.sliding_circular_mean"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.sliding_circular_mean">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:], float64[:], float64)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">sliding_circular_mean</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">time_windows</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the circular mean in degrees within sliding temporal windows.</span>

<span class="sd">        :parameter np.ndarray data: 1d array with feature values in degrees.</span>
<span class="sd">        :parameter np.ndarray time_windows: Rolling time-windows as floats in seconds. E.g., [0.2, 0.4, 0.6]</span>
<span class="sd">        :parameter int fps: fps of the recorded video</span>
<span class="sd">        :returns np.ndarray: Size data.shape[0] x time_windows.shape[0] array</span>

<span class="sd">        .. image:: _static/img/mean_rolling_timeseries_angle.png</span>
<span class="sd">           :width: 600</span>
<span class="sd">           :align: center</span>

<span class="sd">        .. attention::</span>
<span class="sd">           The returned values represents the angular mean dispersion in the time-window ``[current_frame-time_window-&gt;current_frame]``.</span>
<span class="sd">           `-1` is returned when ``current_frame-time_window`` is less than 0.</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.random.normal(loc=45, scale=1, size=20).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().sliding_circular_mean(data=data,time_windows=np.array([0.5, 1.0]), fps=10)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">time_window</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">window_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_windows</span><span class="p">[</span><span class="n">time_window</span><span class="p">]</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">current_frm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">data_window</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">current_frm</span> <span class="o">-</span> <span class="n">window_size</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">current_frm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">data_window</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">data_window</span><span class="p">))))</span>
                <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span>
                <span class="n">results</span><span class="p">[</span><span class="n">current_frm</span><span class="p">,</span> <span class="n">time_window</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.circular_std"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.circular_std">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:],)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">circular_std</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted compute of the circular standard deviation from a single distribution of angles in degrees.</span>

<span class="sd">        :parameter ndarray data: 1D array of size len(frames) with angles in degrees</span>
<span class="sd">        :returns float: The standard deviation of the data sample in degrees</span>

<span class="sd">        .. image:: _static/img/circular_std.png</span>
<span class="sd">           :width: 600</span>
<span class="sd">           :align: center</span>

<span class="sd">        .. math::</span>

<span class="sd">           \\sigma_{\\text{circular}} = \\text{rad2deg}\\left(\\sqrt{-2 \\cdot \\log\\left(|\text{mean}(\\exp(j \\cdot \\theta))|\\right)}\\right)</span>

<span class="sd">        where \\(\\theta\\) represents the angles in radians</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([180, 221, 32, 42, 212, 101, 139, 41, 69, 171, 149, 200]).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().circular_std(data=data)</span>
<span class="sd">        &gt;&gt;&gt; 75.03725024504664</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">data</span><span class="p">))))))</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.sliding_circular_std"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.sliding_circular_std">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:], int64, float64[:])&quot;</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">sliding_circular_std</span><span class="p">(</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">time_windows</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute standard deviation of angular data in sliding time windows.</span>

<span class="sd">        .. image:: _static/img/angle_stdev.png</span>
<span class="sd">           :width: 600</span>
<span class="sd">           :align: center</span>

<span class="sd">        :parameter ndarray data: 1D array of size len(frames) representing degrees.</span>
<span class="sd">        :parameter np.ndarray time_window: Sliding time-window as float in seconds.</span>
<span class="sd">        :parameter int fps: fps of the recorded video</span>
<span class="sd">        :returns np.ndarray: Size data.shape[0] x time_windows.shape[0] with angular standard deviations in rolling time windows in degrees.</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([180, 221, 32, 42, 212, 101, 139, 41, 69, 171, 149, 200]).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().sliding_circular_std(data=data.astype(np.float32), time_windows=np.array([0.5]), fps=10)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">time_window_cnt</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">window_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_windows</span><span class="p">[</span><span class="n">time_window_cnt</span><span class="p">]</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">window_end</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">window_size</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">window_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">window_end</span> <span class="o">-</span> <span class="n">window_size</span> <span class="p">:</span> <span class="n">window_end</span><span class="p">]</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">window_data</span><span class="p">))))))</span>
                <span class="n">results</span><span class="p">[</span><span class="n">window_end</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">time_window_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">results</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.instantaneous_angular_velocity"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.instantaneous_angular_velocity">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:], int64)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">instantaneous_angular_velocity</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted compute of absolute angular change in the smallest possible time bin.</span>

<span class="sd">        .. note::</span>
<span class="sd">            If the smallest possible frame-to-frame time-bin in Video 1 is 33ms (recorded at 30fps), and the</span>
<span class="sd">            smallest possible frame-to-frame time-bin in Video 2 is 66ms (recorded at 15fps), we correct for</span>
<span class="sd">            this across recordings using the ``bin_size`` argument. E.g., when passing angular data from Video 1</span>
<span class="sd">            we pass bin_size as ``2``, and when passing angular data for Video 2 we set bin_size to ``1`` to</span>
<span class="sd">            allow comparisons of instantaneous angular velocity between Video 1 and Video 2.</span>

<span class="sd">            When current frame minus bin_size results in a negative index, -1 is returned.</span>

<span class="sd">        .. image:: _static/img/instantaneous_angular_velocity.png</span>
<span class="sd">           :width: 600</span>
<span class="sd">           :align: center</span>

<span class="sd">        :parameter ndarray data: 1D array of size len(frames) representing degrees.</span>
<span class="sd">        :parameter int bin_size: The number of frames prior to compare the current angular velocity against.</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([350, 360, 365, 360]).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().instantaneous_angular_velocity(data=data, bin_size=1.0)</span>
<span class="sd">        &gt;&gt;&gt; [-1., 10.00002532, 4.999999, 4.999999]</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().instantaneous_angular_velocity(data=data, bin_size=2)</span>
<span class="sd">        &gt;&gt;&gt; [-1., -1., 15.00002432, 0.]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">left_idx</span><span class="p">,</span> <span class="n">right_idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bin_size</span>
        <span class="k">for</span> <span class="n">end_idx</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">right_idx</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">left_idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">end_idx</span><span class="p">]))</span>
            <span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="n">end_idx</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
            <span class="n">left_idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.degrees_to_cardinal"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.degrees_to_cardinal">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:],)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">degrees_to_cardinal</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert degree angles to cardinal direction bucket e.g., 0 -&gt; &quot;N&quot;, 180 -&gt; &quot;S&quot;</span>

<span class="sd">        .. note::</span>
<span class="sd">           To convert cardinal literals to integers, map using ``simba.utils.enums.lookups.cardinality_to_integer_lookup``.</span>
<span class="sd">           To convert integers to cardinal literals, map using ``simba.utils.enums.lookups.integer_to_cardinality_lookup``.</span>

<span class="sd">        .. image:: _static/img/degrees_to_cardinal.png</span>
<span class="sd">           :width: 600</span>
<span class="sd">           :align: center</span>

<span class="sd">        :parameter np.ndarray degree_angles: 1d array of degrees. Note: return by ``self.head_direction``.</span>
<span class="sd">        :return List[str]: List of strings representing frame-wise cardinality.</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array(list(range(0, 405, 45))).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().degrees_to_cardinal(degree_angles=data)</span>
<span class="sd">        &gt;&gt;&gt; [&#39;N&#39;, &#39;NE&#39;, &#39;E&#39;, &#39;SE&#39;, &#39;S&#39;, &#39;SW&#39;, &#39;W&#39;, &#39;NW&#39;, &#39;N&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">DIRECTIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;NE&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;SE&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;SW&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;NW&quot;</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">typed</span><span class="o">.</span><span class="n">List</span><span class="p">([</span><span class="s2">&quot;str&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">ix</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">360.0</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">DIRECTIONS</span><span class="p">)))</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="n">DIRECTIONS</span><span class="p">[</span><span class="n">ix</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">DIRECTIONS</span><span class="p">)]</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.sliding_bearing"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.sliding_bearing">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(int32[:,:], float64, float64)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">sliding_bearing</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">lag</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the sliding bearing (direction) of movement in degrees for a sequence of 2D points representing a single body-part.</span>

<span class="sd">        .. note::</span>
<span class="sd">           To calculate frame-by-frame bearing, pass fps == 1 and lag == 1.</span>

<span class="sd">        .. image:: _static/img/sliding_bearing.png</span>
<span class="sd">           :width: 600</span>
<span class="sd">           :align: center</span>

<span class="sd">        :param np.ndarray x: An array of shape (n, 2) representing the time-series sequence of 2D points.</span>
<span class="sd">        :param float lag: The lag time (in seconds) used for calculating the sliding bearing. E.g., if 1, then bearing will be calculated using coordinates in the current frame vs the frame 1s previously.</span>
<span class="sd">        :param float fps: The sample rate (frames per second) of the sequence.</span>
<span class="sd">        :return np.ndarray: An array containing the sliding bearings (in degrees) for each point in the sequence.</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; x = np.array([[10, 10], [20, 10]])</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin.sliding_bearing(x=x, lag=1, fps=1)</span>
<span class="sd">        &gt;&gt;&gt; [-1. 90.]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">lag</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lag</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lag</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">lag</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">lag</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">))</span>
            <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">degree</span> <span class="o">+</span> <span class="mi">360</span> <span class="k">if</span> <span class="n">degree</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">degree</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.direction_three_bps"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.direction_three_bps">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:,:], float32[:, :], float32[:, :])&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">direction_three_bps</span><span class="p">(</span><span class="n">nose_loc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">left_ear_loc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">right_ear_loc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted helper to compute the degree angle from three body-parts. Computes the angle in degrees left_ear &lt;-&gt; nose</span>
<span class="sd">        and right_ear_nose and returns the midpoint.</span>

<span class="sd">        .. image:: _static/img/angle_from_3_bps.png</span>
<span class="sd">          :width: 600</span>
<span class="sd">          :align: center</span>

<span class="sd">        :parameter ndarray nose_loc: 2D array of size len(frames)x2 representing nose coordinates</span>
<span class="sd">        :parameter ndarray left_ear_loc: 2D array of size len(frames)x2 representing left ear coordinates</span>
<span class="sd">        :parameter ndarray right_ear_loc: 2D array of size len(frames)x2 representing right ear coordinates</span>
<span class="sd">        :return np.ndarray: Array of size nose_loc.shape[0] with direction in degrees.</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; nose_loc = np.random.randint(low=0, high=500, size=(50, 2)).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; left_ear_loc = np.random.randint(low=0, high=500, size=(50, 2)).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; right_ear_loc = np.random.randint(low=0, high=500, size=(50, 2)).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; results = CircularStatisticsMixin().direction_three_bps(nose_loc=nose_loc, left_ear_loc=left_ear_loc, right_ear_loc=right_ear_loc)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">nose_loc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">nose_loc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">left_ear_to_nose</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
                <span class="n">nose_loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">left_ear_loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">left_ear_loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">nose_loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">right_ear_nose</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
                <span class="n">nose_loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">right_ear_loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">right_ear_loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">nose_loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">mean_angle_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">left_ear_to_nose</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">right_ear_nose</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">left_ear_to_nose</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">right_ear_nose</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">mean_angle_rad</span><span class="p">)</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.direction_two_bps"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.direction_two_bps">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:, :], float32[:, :])&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">direction_two_bps</span><span class="p">(</span>
        <span class="n">anterior_loc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">posterior_loc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted method computing degree directionality from two body-parts. E.g., ``nape`` and ``nose``,</span>
<span class="sd">        or ``swim_bladder`` and ``tail``.</span>

<span class="sd">        .. image:: _static/img/angle_from_2_bps.png</span>
<span class="sd">           :width: 1200</span>
<span class="sd">           :align: center</span>

<span class="sd">        :parameter np.ndarray anterior_loc: Size len(frames) x 2 representing x and y coordinates for first body-part.</span>
<span class="sd">        :parameter np.ndarray posterior_loc: Size len(frames) x 2 representing x and y coordinates for second body-part.</span>
<span class="sd">        :return np.ndarray: Frame-wise directionality in degrees.</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; swim_bladder_loc = np.random.randint(low=0, high=500, size=(50, 2)).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; tail_loc = np.random.randint(low=0, high=500, size=(50, 2)).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().direction_two_bps(anterior_loc=swim_bladder_loc, posterior_loc=tail_loc)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">anterior_loc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">anterior_loc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">angle_degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
                    <span class="n">anterior_loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">posterior_loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">posterior_loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">anterior_loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">angle_degrees</span> <span class="o">=</span> <span class="n">angle_degrees</span> <span class="o">+</span> <span class="mi">360</span> <span class="k">if</span> <span class="n">angle_degrees</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">angle_degrees</span>
            <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle_degrees</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.rayleigh"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.rayleigh">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:],)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">rayleigh</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted compute of Rayleigh Z (test of non-uniformity) of single sample of circular data in degrees.</span>

<span class="sd">        .. note:</span>
<span class="sd">           Adapted from ``pingouin.circular.circ_rayleigh`` and ``pycircstat.tests.rayleigh``.</span>

<span class="sd">                The Rayleigh Z score is calculated as follows:</span>

<span class="sd">        .. math::</span>
<span class="sd">           Z = nR^2</span>

<span class="sd">        where :math:`n` is the sample size and :math:`R` is the mean resultant length.</span>

<span class="sd">        The associated p-value is calculated as follows:</span>

<span class="sd">        .. math::</span>
<span class="sd">           p = e^{\\sqrt{1 + 4n + 4(n^2 - R^2)} - (1 + 2n)}</span>

<span class="sd">        :parameter ndarray data: 1D array of size len(frames) representing degrees.</span>
<span class="sd">        :returns Tuple[float, float]: Tuple with Rayleigh Z score and associated probability value.</span>

<span class="sd">        &gt;&gt;&gt; data = np.array([350, 360, 365, 360, 100, 109, 232, 123, 42, 3,4, 145]).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().rayleigh(data=data)</span>
<span class="sd">        &gt;&gt;&gt; (2.3845645695246467, 0.9842236169985417)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">R</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="n">R</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.sliding_rayleigh_z"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.sliding_rayleigh_z">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:], float64[:], float64)&quot;</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">sliding_rayleigh_z</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">time_windows</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted compute of Rayleigh Z (test of non-uniformity) of circular data within sliding time-window.</span>

<span class="sd">        .. note::</span>
<span class="sd">           Adapted from ``pingouin.circular.circ_rayleigh`` and ``pycircstat.tests.rayleigh``.</span>

<span class="sd">        :parameter ndarray data: 1D array of size len(frames) representing degrees.</span>
<span class="sd">        :parameter np.ndarray time_window: Rolling time-window as float in seconds. Two windows of 0.5s and 1s would be represented as np.array([0.5, 1.0])</span>
<span class="sd">        :parameter int fps: fps of the recorded video</span>
<span class="sd">        :returns Tuple[np.ndarray, np.ndarray]: Two 2d arrays with the first representing Rayleigh Z scores and second representing associated p values.</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.random.randint(low=0, high=361, size=(100,)).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().sliding_rayleigh_z(data=data, time_windows=np.array([0.5, 1.0]), fps=10)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">Z_results</span><span class="p">,</span> <span class="n">P_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">win_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_windows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">win_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">data_win</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="n">win_size</span> <span class="p">:</span> <span class="n">j</span><span class="p">]</span>
                <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">data_win</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">data_win</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_win</span><span class="p">)</span>
                <span class="n">Z_results</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_win</span><span class="p">)</span> <span class="o">*</span> <span class="n">R</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">P_results</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_win</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_win</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">R</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_win</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">Z_results</span><span class="p">,</span> <span class="n">P_results</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.circular_correlation"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.circular_correlation">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:], float32[:],)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">circular_correlation</span><span class="p">(</span><span class="n">sample_1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sample_2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted compute of circular correlation coefficient of two samples using the cross-correlation coefficient.</span>
<span class="sd">        Ranges from -1 to 1: 1 indicates perfect positive correlation, -1 indicates perfect negative correlation, 0</span>
<span class="sd">        indicates no correlation.</span>

<span class="sd">        .. note::</span>
<span class="sd">           Adapted from ``astropy.stats.circstats.circcorrcoef``.</span>

<span class="sd">        .. image:: _static/img/circular_correlation.png</span>
<span class="sd">           :width: 700</span>
<span class="sd">           :align: center</span>

<span class="sd">        :parameter np.ndarray sample_1: Angular data for e.g., Animal 1</span>
<span class="sd">        :parameter np.ndarray sample_1: Angular data for e.g., Animal 2</span>
<span class="sd">        :parameter float circular_correlation: The correlation between the two distributions.</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; sample_1 = np.array([50, 90, 20, 60, 20, 90]).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; sample_2 = np.array([50, 90, 70, 60, 20, 90]).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().circular_correlation(sample_1=sample_1, sample_2=sample_2)</span>
<span class="sd">        &gt;&gt;&gt; 0.7649115920066833</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sample_1</span><span class="p">,</span> <span class="n">sample_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">sample_1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">sample_2</span><span class="p">)</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sample_1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sample_1</span><span class="p">)))</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sample_2</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sample_2</span><span class="p">)))</span>
        <span class="n">sin_1</span><span class="p">,</span> <span class="n">sin_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sample_1</span> <span class="o">-</span> <span class="n">m1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sample_2</span> <span class="o">-</span> <span class="n">m2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sin_1</span> <span class="o">*</span> <span class="n">sin_2</span><span class="p">)</span>
            <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sin_1</span> <span class="o">*</span> <span class="n">sin_1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sin_2</span> <span class="o">*</span> <span class="n">sin_2</span><span class="p">))</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.sliding_circular_correlation"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.sliding_circular_correlation">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:], float32[:], float64[:], int64)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">sliding_circular_correlation</span><span class="p">(</span><span class="n">sample_1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sample_2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">time_windows</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted compute of correlations between two angular distributions in sliding time-windows</span>
<span class="sd">        using the cross-correlation coefficient.</span>

<span class="sd">        .. image:: _static/img/cicle_correlation.png</span>
<span class="sd">           :width: 800</span>
<span class="sd">           :align: center</span>

<span class="sd">        .. note::</span>
<span class="sd">           Values prior to the ending of the first time window will be filles with ``0``.</span>

<span class="sd">        :parameter np.ndarray sample_1: Angular data for e.g., Animal 1</span>
<span class="sd">        :parameter np.ndarray sample_1: Angular data for e.g., Animal 2</span>
<span class="sd">        :parameter float time_windows: Size of sliding time window in seconds. E.g., two windows of 0.5s and 1s would be represented as np.array([0.5, 1.0])</span>
<span class="sd">        :parameter int fps: Frame-rate of recorded video.</span>
<span class="sd">        :return np.ndarray: Array of size len(sample_1) x len(time_window) with correlation coefficients.</span>


<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; sample_1 = np.random.randint(0, 361, (200,)).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; sample_2 = np.random.randint(0, 361, (200,)).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().sliding_circular_correlation(sample_1=sample_1, sample_2=sample_2, time_windows=np.array([0.5, 1.0]), fps=10.0)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sample_1</span><span class="p">,</span> <span class="n">sample_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">sample_1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">sample_2</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">sample_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">win_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_windows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">win_size</span><span class="p">,</span> <span class="n">sample_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">data_1_window</span> <span class="o">=</span> <span class="n">sample_1</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="n">win_size</span> <span class="p">:</span> <span class="n">j</span><span class="p">]</span>
                <span class="n">data_2_window</span> <span class="o">=</span> <span class="n">sample_2</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="n">win_size</span> <span class="p">:</span> <span class="n">j</span><span class="p">]</span>
                <span class="n">m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">data_1_window</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">data_1_window</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="n">m2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">data_2_window</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">data_2_window</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="n">sin_1</span><span class="p">,</span> <span class="n">sin_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">data_1_window</span> <span class="o">-</span> <span class="n">m1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">data_2_window</span> <span class="o">-</span> <span class="n">m2</span><span class="p">)</span>
                <span class="n">denominator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sin_1</span> <span class="o">*</span> <span class="n">sin_1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sin_2</span> <span class="o">*</span> <span class="n">sin_2</span><span class="p">))</span>
                <span class="n">numerator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sin_1</span> <span class="o">*</span> <span class="n">sin_2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">denominator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">results</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">results</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.sliding_angular_diff"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.sliding_angular_diff">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:], float64[:], int64)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">sliding_angular_diff</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">time_windows</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the angular difference in the current frame versus N seconds previously.</span>
<span class="sd">        For example, if the current angle is 45 degrees, and the angle N seconds previously was 350 degrees, then the difference</span>
<span class="sd">        is 55 degrees.</span>

<span class="sd">        .. note::</span>
<span class="sd">           Frames where current frame - N seconds prior equal a negative value is populated with ``0``.</span>

<span class="sd">           Results are returned in rounded nearest integer.</span>

<span class="sd">        .. image:: _static/img/sliding_angular_difference.png</span>
<span class="sd">           :width: 600</span>
<span class="sd">           :align: center</span>

<span class="sd">        :parameter ndarray data: 1D array of size len(frames) representing degrees. Can be computed by `CircularStatisticsMixin().direction_three_bps` or `CircularStatisticsMixin().direction_two_bps`.</span>
<span class="sd">        :parameter np.ndarray time_window: Rolling time-window as float in seconds.</span>
<span class="sd">        :parameter int fps: fps of the recorded video</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([350, 350, 1, 1]).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().sliding_angular_diff(data=data, fps=1.0, time_windows=np.array([1.0]))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">time_window_cnt</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">window_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_windows</span><span class="p">[</span><span class="n">time_window_cnt</span><span class="p">]</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">window_size</span><span class="p">)),</span>
                <span class="nb">range</span><span class="p">(</span><span class="n">window_size</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">):</span>
                <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">right</span><span class="p">]))</span>
                <span class="n">results</span><span class="p">[</span><span class="n">right</span><span class="p">][</span><span class="n">time_window_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">distance</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">results</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.agg_angular_diff_timebins"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.agg_angular_diff_timebins">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:], float64[:], int64)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">agg_angular_diff_timebins</span><span class="p">(</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">time_windows</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the difference between the median angle in the current time-window versus the previous time window.</span>
<span class="sd">        For example, computes the difference between the mean angle in the first 1s of the video versus</span>
<span class="sd">        the second 1s of the video, the second 1s of the video versus the third 1s of the video, ... etc.</span>

<span class="sd">        .. note::</span>
<span class="sd">           The first time-bin of the video cannot be compared against the prior time-bin and is populated with `0`.</span>

<span class="sd">        .. image:: _static/img/circular_difference_time_bins.png</span>
<span class="sd">           :width: 800</span>
<span class="sd">           :align: center</span>

<span class="sd">        :parameter ndarray data: 1D array of size len(frames) representing degrees.</span>
<span class="sd">        :parameter np.ndarray time_window: Rolling time-window as float in seconds.</span>
<span class="sd">        :parameter int fps: fps of the recorded video</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.random.normal(loc=45, scale=3, size=20).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().agg_angular_diff_timebins(data=data,time_windows=np.array([1.0]), fps=5.0))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">win_cnt</span><span class="p">,</span> <span class="n">time_window_cnt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">prange</span><span class="p">(</span><span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="n">window_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_windows</span><span class="p">[</span><span class="n">time_window_cnt</span><span class="p">]</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)</span>
            <span class="n">w1_start</span><span class="p">,</span> <span class="n">w1_end</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">window_size</span>
            <span class="n">w2_start</span><span class="p">,</span> <span class="n">w2_end</span> <span class="o">=</span> <span class="n">window_size</span><span class="p">,</span> <span class="n">window_size</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="k">while</span> <span class="n">w2_start</span> <span class="o">&lt;</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">current_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">w2_start</span><span class="p">:</span><span class="n">w2_end</span><span class="p">]</span>
                <span class="n">prior_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">w1_start</span><span class="p">:</span><span class="n">w1_end</span><span class="p">]</span>
                <span class="n">prior_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">prior_data</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">prior_data</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">prior_median</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">prior_median</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">current_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">current_data</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">current_data</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">current_median</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">current_median</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">prior_median</span> <span class="o">-</span> <span class="n">current_median</span><span class="p">))</span>
                <span class="n">results</span><span class="p">[</span><span class="n">w2_start</span><span class="p">:</span><span class="n">w2_end</span><span class="p">,</span> <span class="n">win_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
                <span class="n">w1_start</span><span class="p">,</span> <span class="n">w1_end</span> <span class="o">=</span> <span class="n">w2_start</span><span class="p">,</span> <span class="n">w2_end</span>
                <span class="n">w2_start</span><span class="p">,</span> <span class="n">w2_end</span> <span class="o">=</span> <span class="n">w2_start</span> <span class="o">+</span> <span class="n">window_size</span><span class="p">,</span> <span class="n">w2_end</span> <span class="o">+</span> <span class="n">window_size</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">results</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.rao_spacing"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.rao_spacing">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:],)&quot;</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">rao_spacing</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted compute of Rao&#39;s spacing for angular data.</span>

<span class="sd">        Computes the uniformity of a circular dataset in degrees. Low output values represent concentrated angularity,</span>
<span class="sd">        while high values represent dispersed angularity.</span>

<span class="sd">        :parameter ndarray data: 1D array of size len(frames) with data in degrees.</span>
<span class="sd">        :return int: Rao&#39;s spacing measure, indicating the dispersion or concentration of angular data points.</span>

<span class="sd">        :references:</span>
<span class="sd">        .. [1] `UCSB &lt;https://jammalam.faculty.pstat.ucsb.edu/html/favorite/test.htm&gt;`__.</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.random.randint(0, 360, (5000,)).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin.rao_spacing(data=data)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">Ti</span><span class="p">,</span> <span class="n">TiL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">360</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="n">Ti</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">Ti</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])))</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">Ti</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">TiL</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="n">Ti</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span> <span class="o">-</span> <span class="nb">min</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="n">Ti</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">TiL</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">S</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">U</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.sliding_rao_spacing"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.sliding_rao_spacing">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:], float64[:], int64)&quot;</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">sliding_rao_spacing</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">time_windows</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted compute of the uniformity of a circular dataset in sliding windows.</span>

<span class="sd">        :parameter ndarray data: 1D array of size len(frames) representing degrees.</span>
<span class="sd">        :parameter np.ndarray time_window: Rolling time-window as float in seconds.</span>
<span class="sd">        :parameter int fps: fps of the recorded video</span>
<span class="sd">        :return np.ndarray: representing rao-spacing U in every sliding windows [-window:n]</span>

<span class="sd">        .. image:: _static/img/raospacing.png</span>
<span class="sd">           :width: 800</span>
<span class="sd">           :align: center</span>

<span class="sd">        The Rao&#39;s Spacing (:math:`U`) is calculated as follows:</span>

<span class="sd">        .. math::</span>

<span class="sd">           U = \\frac{1}{2} \\sum_{i=1}^{N} |l - T_i|</span>

<span class="sd">        where :math:`N` is the number of data points in the sliding window, :math:`T_i` is the spacing between adjacent data points, and :math:`l` is the equal angular spacing.</span>

<span class="sd">        .. note::</span>
<span class="sd">           For frames occuring before a complete time window, 0.0 is returned.</span>

<span class="sd">        :references:</span>
<span class="sd">        .. [1] `UCSB &lt;https://jammalam.faculty.pstat.ucsb.edu/html/favorite/test.htm&gt;`__.</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.random.randint(low=0, high=360, size=(500,)).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; result = CircularStatisticsMixin().sliding_rao_spacing(data=data, time_windows=np.array([0.5, 1.0]), fps=10)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">win_cnt</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">window_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_windows</span><span class="p">[</span><span class="n">win_cnt</span><span class="p">]</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">window_size</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">w_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">window_size</span> <span class="p">:</span> <span class="n">i</span><span class="p">])</span>
                <span class="n">Ti</span><span class="p">,</span> <span class="n">TiL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">w_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">w_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">(</span><span class="mi">360</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">w_data</span><span class="p">))</span>
                <span class="n">Ti</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">w_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">w_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))))</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">Ti</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">w_data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">w_data</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))))</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">Ti</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">TiL</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="n">Ti</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span> <span class="o">-</span> <span class="nb">min</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="n">Ti</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">TiL</span><span class="p">)</span>
                <span class="n">U</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">S</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">win_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">U</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.kuipers_two_sample_test"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.kuipers_two_sample_test">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:], float32[:])&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">kuipers_two_sample_test</span><span class="p">(</span><span class="n">sample_1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sample_2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the Kuiper&#39;s two-sample test statistic for circular distributions.</span>

<span class="sd">        Kuiper&#39;s two-sample test is a non-parametric test used to determine if two samples are drawn from the same circular distribution. It is particularly useful for circular data, such as angles or directions.</span>

<span class="sd">        .. note::</span>
<span class="sd">           Adapted from `Kuiper &lt;https://github.com/aarchiba/kuiper/tree/master&gt;`__ by `Anne Archibald &lt;https://github.com/aarchiba&gt;`_.</span>

<span class="sd">        :parameter ndarray data: The first circular sample array in degrees.</span>
<span class="sd">        :parameter ndarray data: The second circular sample array in degrees.</span>
<span class="sd">        :return float: Kuiper&#39;s test statistic.</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; sample_1, sample_2 = np.random.normal(loc=45, scale=1, size=100).astype(np.float32), np.random.normal(loc=180, scale=20, size=100).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().kuipers_two_sample_test(sample_1=sample_1, sample_2=sample_2)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sample_1</span><span class="p">,</span> <span class="n">sample_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">sample_1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">sample_2</span><span class="p">))</span>
        <span class="n">cdfv1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">sample_2</span><span class="p">,</span> <span class="n">sample_1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_2</span><span class="p">))</span>
        <span class="n">cdfv2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">sample_1</span><span class="p">,</span> <span class="n">sample_2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">cdfv1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_1</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_1</span><span class="p">)))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">cdfv2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_2</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_2</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.sliding_kuipers_two_sample_test"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.sliding_kuipers_two_sample_test">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:], float32[:], float64[:], int64)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">sliding_kuipers_two_sample_test</span><span class="p">(</span><span class="n">sample_1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sample_2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">time_windows</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted compute of Kuipers two-sample test comparing two distributions with sliding time window.</span>

<span class="sd">        This function calculates the Kuipers two-sample test statistic for each time window, sliding through the given circular data sequences.</span>

<span class="sd">        :parameter np.ndarray data: The first circular sample array in degrees.</span>
<span class="sd">        :parameter np.ndarray data: The second circular sample array in degrees.</span>
<span class="sd">        :parameter np.ndarray time_windows: An array containing the time window sizes (in seconds) for which the Kuipers two-sample test will be computed.</span>
<span class="sd">        :parameter int fps: The frames per second, representing the sampling rate of the data.</span>
<span class="sd">        :returns np.ndarray: A 2D array containing the Kuipers two-sample test statistics for each time window and each time step.</span>

<span class="sd">        :examples:</span>
<span class="sd">        &gt;&gt;&gt; data = np.random.randint(low=0, high=360, size=(100,)).astype(np.float64)</span>
<span class="sd">        &gt;&gt;&gt; D = CircularStatisticsMixin().sliding_kuipers_two_sample_test(data=data, time_windows=np.array([0.5, 5]), fps=2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sample_1</span><span class="p">,</span> <span class="n">sample_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">sample_1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">sample_2</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">sample_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">time_window_cnt</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">win_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_windows</span><span class="p">[</span><span class="n">time_window_cnt</span><span class="p">]</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">win_size</span><span class="p">,</span> <span class="n">sample_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">sample_1_win</span><span class="p">,</span> <span class="n">sample_2_win</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">sample_1</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">win_size</span> <span class="p">:</span> <span class="n">i</span><span class="p">],</span>
                    <span class="n">sample_2</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">win_size</span> <span class="p">:</span> <span class="n">i</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">cdfv1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">sample_2</span><span class="p">,</span> <span class="n">sample_1_win</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">sample_2_win</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">cdfv2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">sample_1_win</span><span class="p">,</span> <span class="n">sample_2_win</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">sample_1_win</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span>
                    <span class="n">cdfv1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_1_win</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_1_win</span><span class="p">))</span>
                <span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span>
                    <span class="n">cdfv2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_2_win</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_2_win</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">time_window_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span>

        <span class="k">return</span> <span class="n">results</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">sliding_hodges_ajne</span><span class="p">(</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">time_window</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">results</span><span class="p">,</span> <span class="n">window_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_window</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">window_size</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">w_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">window_size</span> <span class="p">:</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">w_data</span><span class="p">)))</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">w_data</span><span class="p">)</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">H</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">hodges_ajne</span><span class="p">(</span><span class="n">sample</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">sample</span><span class="p">)))</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">H</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">watson_williams_test</span><span class="p">(</span><span class="n">sample_1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sample_2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>

        <span class="n">variance1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">sample_1</span><span class="p">)))</span>
        <span class="n">variance2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">sample_2</span><span class="p">)))</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="p">(</span><span class="n">variance1</span> <span class="o">+</span> <span class="n">variance2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="n">variance1</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_1</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">variance2</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_2</span><span class="p">))</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>
        <span class="k">return</span> <span class="n">F</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">watsons_u</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">mean_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mean_vector</span><span class="p">))</span>

<div class="viewcode-block" id="CircularStatisticsMixin.circular_range"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.circular_range">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:],)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">circular_range</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted compute of circular range in degrees. The range is defined as the angular span of the</span>
<span class="sd">        shortest arc that can contain all the data points. A smaller range indicates a more concentrated</span>
<span class="sd">        distribution, while a larger range suggests a more dispersed distribution.</span>

<span class="sd">        .. image:: _static/img/circular_range.png</span>
<span class="sd">           :width: 600</span>
<span class="sd">           :align: center</span>

<span class="sd">        :parameter ndarray data: 1D array of circular data measured in degrees</span>
<span class="sd">        :return np.ndarray: The circular range in degrees.</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().circular_range([350, 20, 60, 100])</span>
<span class="sd">        &gt;&gt;&gt; 110.0</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().circular_range([110, 20, 60, 100])</span>
<span class="sd">        &gt;&gt;&gt; 90.0</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="n">angular_diffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">circular_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">angular_diffs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">circular_range</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.sliding_circular_range"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.sliding_circular_range">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:], float64[:], int64)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">sliding_circular_range</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">time_windows</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted compute of sliding circular range for a time series of circular data. The range is defined as the angular span of the</span>
<span class="sd">        shortest arc that can contain all the data points. Measures the circular spread of data within sliding time windows of specified duration.</span>

<span class="sd">        .. image:: _static/img/sliding_circular_range.png</span>
<span class="sd">           :width: 600</span>
<span class="sd">           :align: center</span>

<span class="sd">        .. note::</span>
<span class="sd">           Output data in the beginning of the series where a full time-window is not satisfied (e.g., first 9 observations when</span>
<span class="sd">           fps equals 10 and time_windows = [1.0], will be populated by ``0``.</span>

<span class="sd">        :parameter np.ndarray data: 1D array of circular data measured in degrees</span>
<span class="sd">        :parameter np.ndarray time_windows: Size of sliding time window in seconds. E.g., two windows of 0.5s and 1s would be represented as np.array([0.5, 1.0])</span>
<span class="sd">        :parameter int fps: Frame-rate of recorded video.</span>
<span class="sd">        :return np.ndarray: Array of size len(sample_1) x len(time_window) with angular ranges in degrees.</span>

<span class="sd">        :examples:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([260, 280, 300, 340, 360, 0, 10, 350, 0, 15]).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().sliding_circular_range(data=data, time_windows=np.array([0.5]), fps=10)</span>
<span class="sd">        &gt;&gt;&gt; [[ -1.],[ -1.],[ -1.],[ -1.],[100.],[80],[70],[30],[20],[25]]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">time_window_cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">time_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">win_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_windows</span><span class="p">[</span><span class="n">time_window_cnt</span><span class="p">]</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">win_size</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">win_size</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                <span class="n">sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">left</span> <span class="p">:</span> <span class="n">right</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
                <span class="n">angular_diffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
                <span class="n">circular_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">angular_diffs</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="n">right</span><span class="p">][</span><span class="n">time_window_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">circular_range</span><span class="p">,</span> <span class="n">sample</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">sample</span><span class="p">[</span><span class="mi">0</span><span class="p">]))))</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.circular_hotspots"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.circular_hotspots">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:], int64[:, :],)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">circular_hotspots</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the proportion of data points falling within circular bins.</span>

<span class="sd">        .. image:: _static/img/circular_hotspots.png</span>
<span class="sd">           :width: 700</span>
<span class="sd">           :align: center</span>

<span class="sd">        .. warning:</span>
<span class="sd">           Make sure the ``bins`` argument do not contain overlapping bin edge definitions. E.g.,</span>
<span class="sd">           bins = np.array([[270, 0], [1, 90], [91, 180], [181, 269]]) is accepted but</span>
<span class="sd">           bins = np.array([[270, 0], [0, 90], [90, 180], [180, 270]]) is not.</span>

<span class="sd">        :parameter ndarray data: 1D array of circular data measured in degrees.</span>
<span class="sd">        :parameter ndarray bins: 2D array of shape representing circular bins defining [start_degree, end_degree] inclusive.</span>
<span class="sd">        :return np.ndarray: 1D array containing the proportion of data points that fall within each specified circular bin.</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([270, 360, 10, 90, 91, 180, 185, 260]).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; bins = np.array([[270, 90], [91, 269]])</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().circular_hotspots(data=data, bins=bins)</span>
<span class="sd">        &gt;&gt;&gt; [0.5, 0.5]</span>
<span class="sd">        &gt;&gt;&gt; bins = np.array([[270, 0], [1, 90], [91, 180], [181, 269]])</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().circular_hotspots(data=data, bins=bins)</span>
<span class="sd">        &gt;&gt;&gt; [0.25, 0.25, 0.25, 0.25]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">bins</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bin_cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bins</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">bins</span><span class="p">[</span><span class="n">bin_cnt</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bins</span><span class="p">[</span><span class="n">bin_cnt</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">data</span> <span class="o">&gt;=</span> <span class="n">bins</span><span class="p">[</span><span class="n">bin_cnt</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="mi">360</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">data</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="n">bins</span><span class="p">[</span><span class="n">bin_cnt</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">&gt;=</span> <span class="n">bins</span><span class="p">[</span><span class="n">bin_cnt</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="n">bins</span><span class="p">[</span><span class="n">bin_cnt</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">results</span><span class="p">[</span><span class="n">bin_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.sliding_circular_hotspots"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.sliding_circular_hotspots">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(float32[:], int64[:, :], float64, float64)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">sliding_circular_hotspots</span><span class="p">(</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">time_window</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted compute of sliding circular hotspots in a dataset. Calculates circular hotspots in a time-series dataset by sliding a time window</span>
<span class="sd">        across the data and computing hotspot statistics for specified circular bins.</span>

<span class="sd">        :parameter ndarray data: 1D array of circular data measured in degrees.</span>
<span class="sd">        :parameter ndarray bins: 2D array of shape representing circular bins defining [start_degree, end_degree] inclusive.</span>
<span class="sd">        :parameter float time_window: The size of the sliding window in seconds.</span>
<span class="sd">        :parameter float fps: The frame-rate of the video.</span>

<span class="sd">        :return np.ndarray: A 2D numpy array where each row corresponds to a time point in `data`, and each column represents a circular bin. The values in the array represent the proportion of data points within each bin at each time point.</span>

<span class="sd">        .. note::</span>
<span class="sd">           - The function utilizes the Numba JIT compiler for improved performance.</span>
<span class="sd">           - Circular bin definitions should follow the convention where angles are specified in degrees</span>
<span class="sd">             within the range [0, 360], and the bins are defined using start and end angles inclusive.</span>
<span class="sd">             For example, (0, 90) represents the first quadrant in a circular space.</span>

<span class="sd">             For example, bins = np.array([[270, 90], [91, 269]]) divides the space into a top and bottom circular space.</span>

<span class="sd">              bins = np.array([[0, 179], [180, 364]]) divides the space into a left and right circular space.</span>


<span class="sd">             Output data in the beginning of the series where a full time-window is not satisfied (e.g., first 9 observations when</span>
<span class="sd">             fps equals 10 and time_windows = [1.0], will be populated by ``0``.</span>

<span class="sd">        .. warning::</span>
<span class="sd">          Note that ``0`` is noted as a bin-edge, ``360`` should not be a bin-edge. Instead, use ``0`` and ``359`` or ``1`` and ``360``.</span>

<span class="sd">        .. image:: _static/img/sliding_circular_hotspot.png</span>
<span class="sd">           :width: 600</span>
<span class="sd">           :align: center</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([270, 360, 10, 20, 90, 91, 180, 185, 260, 265]).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; bins = np.array([[270, 90], [91, 269]])</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().sliding_circular_hotspots(data=data, bins=bins, time_window=0.5, fps=10)</span>
<span class="sd">        &gt;&gt;&gt; [[-1. , -1. ],</span>
<span class="sd">        &gt;&gt;&gt;  [-1. , -1. ],</span>
<span class="sd">        &gt;&gt;&gt;  [-1. , -1. ],</span>
<span class="sd">        &gt;&gt;&gt;  [-1. , -1. ],</span>
<span class="sd">        &gt;&gt;&gt;  [ 0.5,  0. ],</span>
<span class="sd">        &gt;&gt;&gt;  [ 0.4,  0.1],</span>
<span class="sd">        &gt;&gt;&gt;  [ 0.3,  0.2],</span>
<span class="sd">        &gt;&gt;&gt;  [ 0.2,  0.3],</span>
<span class="sd">        &gt;&gt;&gt;  [ 0.1,  0.4],</span>
<span class="sd">        &gt;&gt;&gt;  [ 0. ,  0.5]]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bins</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">win_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_window</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">prange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">win_size</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">prange</span><span class="p">(</span><span class="n">win_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">left</span> <span class="p">:</span> <span class="n">right</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">bin_cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bins</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">bins</span><span class="p">[</span><span class="n">bin_cnt</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bins</span><span class="p">[</span><span class="n">bin_cnt</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">sample</span> <span class="o">&gt;=</span> <span class="n">bins</span><span class="p">[</span><span class="n">bin_cnt</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sample</span> <span class="o">&lt;=</span> <span class="mi">360</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">sample</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sample</span> <span class="o">&lt;=</span> <span class="n">bins</span><span class="p">[</span><span class="n">bin_cnt</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">sample</span> <span class="o">&gt;=</span> <span class="n">bins</span><span class="p">[</span><span class="n">bin_cnt</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sample</span> <span class="o">&lt;=</span> <span class="n">bins</span><span class="p">[</span><span class="n">bin_cnt</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">results</span><span class="p">[</span><span class="n">right</span><span class="p">][</span><span class="n">bin_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">sample</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.rotational_direction"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.rotational_direction">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">([(</span><span class="n">float32</span><span class="p">[:],</span> <span class="n">int64</span><span class="p">),</span> <span class="p">(</span><span class="n">float32</span><span class="p">[:],</span> <span class="n">types</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">Omitted</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">))])</span>
    <span class="k">def</span> <span class="nf">rotational_direction</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">stride</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jitted compute of frame-by-frame rotational direction within a 1D timeseries array of angular data.</span>

<span class="sd">        :parameter ndarray data: 1D array of size len(frames) representing degrees.</span>
<span class="sd">        :return numpy.ndarray: An array of directional indicators.</span>
<span class="sd">           - 0 indicates no rotational change relative to prior frame.</span>
<span class="sd">           - 1 indicates a clockwise rotational change relative to prior frame.</span>
<span class="sd">           - 2 indicates a counter-clockwise rotational change relative to prior frame.</span>

<span class="sd">        .. note::</span>
<span class="sd">           * For the first frame, no rotation is possible so is populated with -1.</span>
<span class="sd">           * Frame-by-frame rotations of 180° degrees are denoted as clockwise rotations.</span>

<span class="sd">        .. image:: _static/img/rotational_direction.png</span>
<span class="sd">           :width: 600</span>
<span class="sd">           :align: center</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([45, 50, 35, 50, 80, 350, 350, 0 , 180]).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().rotational_direction(data)</span>
<span class="sd">        &gt;&gt;&gt; [-1.,  1.,  2.,  1.,  1.,  2.,  0.,  1.,  1.]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">%</span> <span class="mi">360</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">prior_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">),</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">stride</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">prior_angle</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">prior_idx</span><span class="p">]</span>
            <span class="n">current_angle</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">angle_diff</span> <span class="o">=</span> <span class="n">current_angle</span> <span class="o">-</span> <span class="n">prior_angle</span>

            <span class="k">if</span> <span class="n">angle_diff</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
                <span class="n">angle_diff</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="k">elif</span> <span class="n">angle_diff</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
                <span class="n">angle_diff</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

            <span class="k">if</span> <span class="n">angle_diff</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">angle_diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">prior_idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircularStatisticsMixin.fit_circle"><a class="viewcode-back" href="../../../simba.mixins.html#simba.mixins.circular_statistics.CircularStatisticsMixin.fit_circle">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">(</span>
        <span class="p">[(</span><span class="n">float64</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">int64</span><span class="p">),</span> <span class="p">(</span><span class="n">float64</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">types</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">Omitted</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">400</span><span class="p">))]</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit_circle</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">max_iterations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit a circle to a dataset using the least squares method.</span>

<span class="sd">        This function fits a circle to a dataset using the least squares method. The circle is defined</span>
<span class="sd">        by the equation:</span>

<span class="sd">        .. math::</span>
<span class="sd">           X^2 + Y^2 = R^2</span>

<span class="sd">        .. note::</span>
<span class="sd">           Adapted to numba JIT from `circle-fit &lt;https://github.com/AlliedToasters/circle-fit&gt;`_ ``hyperLSQ`` method.</span>

<span class="sd">        .. image:: _static/img/fit_circle.png</span>
<span class="sd">           :width: 600</span>
<span class="sd">           :align: center</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        .. [1] Kanatani, Rangarajan, Hyper least squares fitting of circles and ellipses, `Computational Statistics &amp; Data Analysis`,</span>
<span class="sd">               vol. 55, pp. 2197-2208, 2011.</span>
<span class="sd">        .. [2] Lapp, Salazar, Champagne. Automated maternal behavior during early life in rodents (AMBER) pipeline, `Scientific Reports`,</span>
<span class="sd">               13:18277, 2023.</span>

<span class="sd">        :parameter np.ndarray data: A 3D NumPy array with shape (N, M, 2). N represent frames, M represents the number of body-parts, and 2 represents x and y coordinates.</span>
<span class="sd">        :parameter int max_iterations: The maximum number of iterations for fitting the circle.</span>
<span class="sd">        :returns np.ndarray: Array with shape (N, 3) with N representing frame and 3 representing (i) X-coordinate of the circle center, (ii) Y-coordinate of the circle center, and (iii) Radius of the circle</span>

<span class="sd">        :example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([[[5, 10], [10, 5], [15, 10], [10, 15]]])</span>
<span class="sd">        &gt;&gt;&gt; CircularStatisticsMixin().fit_circle(data=data, iter_max=88)</span>
<span class="sd">        &gt;&gt;&gt; [[10, 10, 5]]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">frm_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">frm_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">frm_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">frm_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">Xi</span><span class="p">,</span> <span class="n">Yi</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">Zi</span> <span class="o">=</span> <span class="n">Xi</span> <span class="o">*</span> <span class="n">Xi</span> <span class="o">+</span> <span class="n">Yi</span> <span class="o">*</span> <span class="n">Yi</span>
            <span class="n">Mxx</span><span class="p">,</span> <span class="n">Mxy</span><span class="p">,</span> <span class="n">Mxz</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">Xi</span> <span class="o">*</span> <span class="n">Xi</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">n</span><span class="p">,</span>
                <span class="p">(</span><span class="n">Xi</span> <span class="o">*</span> <span class="n">Yi</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">n</span><span class="p">,</span>
                <span class="p">(</span><span class="n">Xi</span> <span class="o">*</span> <span class="n">Zi</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">n</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">Myy</span><span class="p">,</span> <span class="n">Myz</span> <span class="o">=</span> <span class="p">(</span><span class="n">Yi</span> <span class="o">*</span> <span class="n">Yi</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">Yi</span> <span class="o">*</span> <span class="n">Zi</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">n</span>
            <span class="n">Mzz</span> <span class="o">=</span> <span class="p">(</span><span class="n">Zi</span> <span class="o">*</span> <span class="n">Zi</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">n</span>

            <span class="n">Mz</span> <span class="o">=</span> <span class="n">Mxx</span> <span class="o">+</span> <span class="n">Myy</span>
            <span class="n">Var_z</span> <span class="o">=</span> <span class="n">Mzz</span> <span class="o">-</span> <span class="n">Mz</span> <span class="o">*</span> <span class="n">Mz</span>
            <span class="n">Cov_xy</span> <span class="o">=</span> <span class="n">Mxx</span> <span class="o">*</span> <span class="n">Myy</span> <span class="o">-</span> <span class="n">Mxy</span> <span class="o">*</span> <span class="n">Mxy</span>

            <span class="n">A2</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">Cov_xy</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">Mz</span> <span class="o">*</span> <span class="n">Mz</span> <span class="o">-</span> <span class="n">Mzz</span>
            <span class="n">A1</span> <span class="o">=</span> <span class="n">Var_z</span> <span class="o">*</span> <span class="n">Mz</span> <span class="o">+</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">Cov_xy</span> <span class="o">*</span> <span class="n">Mz</span> <span class="o">-</span> <span class="n">Mxz</span> <span class="o">*</span> <span class="n">Mxz</span> <span class="o">-</span> <span class="n">Myz</span> <span class="o">*</span> <span class="n">Myz</span>
            <span class="n">A0</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">Mxz</span> <span class="o">*</span> <span class="p">(</span><span class="n">Mxz</span> <span class="o">*</span> <span class="n">Myy</span> <span class="o">-</span> <span class="n">Myz</span> <span class="o">*</span> <span class="n">Mxy</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">Myz</span> <span class="o">*</span> <span class="p">(</span><span class="n">Myz</span> <span class="o">*</span> <span class="n">Mxx</span> <span class="o">-</span> <span class="n">Mxz</span> <span class="o">*</span> <span class="n">Mxy</span><span class="p">)</span>
                <span class="o">-</span> <span class="n">Var_z</span> <span class="o">*</span> <span class="n">Cov_xy</span>
            <span class="p">)</span>
            <span class="n">A22</span> <span class="o">=</span> <span class="n">A2</span> <span class="o">+</span> <span class="n">A2</span>

            <span class="n">Y</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">A0</span><span class="p">,</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iterations</span><span class="p">):</span>
                <span class="n">Dy</span> <span class="o">=</span> <span class="n">A1</span> <span class="o">+</span> <span class="n">X</span> <span class="o">*</span> <span class="p">(</span><span class="n">A22</span> <span class="o">+</span> <span class="mf">16.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
                <span class="n">xnew</span> <span class="o">=</span> <span class="n">X</span> <span class="o">-</span> <span class="n">Y</span> <span class="o">/</span> <span class="n">Dy</span>
                <span class="k">if</span> <span class="n">xnew</span> <span class="o">==</span> <span class="n">X</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">xnew</span><span class="p">):</span>
                    <span class="k">break</span>
                <span class="n">ynew</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">+</span> <span class="n">xnew</span> <span class="o">*</span> <span class="p">(</span><span class="n">A1</span> <span class="o">+</span> <span class="n">xnew</span> <span class="o">*</span> <span class="p">(</span><span class="n">A2</span> <span class="o">+</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">xnew</span> <span class="o">*</span> <span class="n">xnew</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ynew</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Y</span><span class="p">):</span>
                    <span class="k">break</span>
                <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span>

            <span class="n">det</span> <span class="o">=</span> <span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">X</span> <span class="o">*</span> <span class="n">Mz</span> <span class="o">+</span> <span class="n">Cov_xy</span>
            <span class="n">Xcenter</span> <span class="o">=</span> <span class="p">(</span><span class="n">Mxz</span> <span class="o">*</span> <span class="p">(</span><span class="n">Myy</span> <span class="o">-</span> <span class="n">X</span><span class="p">)</span> <span class="o">-</span> <span class="n">Myz</span> <span class="o">*</span> <span class="n">Mxy</span><span class="p">)</span> <span class="o">/</span> <span class="n">det</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">Ycenter</span> <span class="o">=</span> <span class="p">(</span><span class="n">Myz</span> <span class="o">*</span> <span class="p">(</span><span class="n">Mxx</span> <span class="o">-</span> <span class="n">X</span><span class="p">)</span> <span class="o">-</span> <span class="n">Mxz</span> <span class="o">*</span> <span class="n">Mxy</span><span class="p">)</span> <span class="o">/</span> <span class="n">det</span> <span class="o">/</span> <span class="mf">2.0</span>

            <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">Xcenter</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                    <span class="n">Ycenter</span> <span class="o">+</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Xcenter</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ycenter</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Mz</span><span class="p">)),</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div></div>



<span class="c1"># data = np.array([260, 280, 300, 340, 360, 0, 10, 350, 0, 15]).astype(np.float32)</span>
<span class="c1"># CircularStatisticsMixin().sliding_circular_range(data=data, time_windows=np.array([0.5]), fps=10)</span>

<span class="c1"># data_sizes = [1, 10, 100, 1000, 10000, 100000, 1000000, 10000000, 100000000]</span>
<span class="c1"># # #</span>
<span class="c1"># # for data_size in data_sizes:</span>
<span class="c1"># #     data = np.random.randint(low=0, high=360, size=(data_size,)).astype(np.float32)</span>
<span class="c1"># #     start = time.time()</span>
<span class="c1"># #     CircularStatisticsMixin().rayleigh(data=data)</span>
<span class="c1"># #     print(time.time() - start)</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># for data_size in data_sizes:</span>
<span class="c1">#     data = np.random.randint(low=0, high=360, size=(data_size,)).astype(np.float32)</span>
<span class="c1">#     start = time.time()</span>
<span class="c1">#     CircularStatisticsMixin().rolling_rayleigh_z(data=data, fps=10, time_windows=np.array([0.5, 1.0]))</span>
<span class="c1">#     print(time.time() - start)</span>


<span class="c1"># for data_size in data_sizes:</span>
<span class="c1">#     data = np.random.randint(low=0, high=360, size=(data_size,)).astype(np.float32)</span>
<span class="c1">#     start = time.time()</span>
<span class="c1">#     CircularStatisticsMixin().degrees_to_cardinal(degree_angles=data)</span>
<span class="c1">#     print(time.time() - start)</span>


<span class="c1"># for data_size in data_sizes:</span>
<span class="c1">#     nose_loc = np.random.randint(low=0, high=500, size=(data_size, 2)).astype(np.float32)</span>
<span class="c1">#     left_ear_loc = np.random.randint(low=0, high=500, size=(data_size, 2)).astype(np.float32)</span>
<span class="c1">#     right_ear_loc = np.random.randint(low=0, high=500, size=(data_size, 2)).astype(np.float32)</span>
<span class="c1">#     start = time.time()</span>
<span class="c1">#     results = CircularStatisticsMixin().direction_two_bps(swim_bladder_loc=nose_loc,tail_loc=left_ear_loc)</span>
<span class="c1">#     print(time.time() - start)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, sronilsson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
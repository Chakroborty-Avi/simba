<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>simba.utils.read_write &mdash; SimBA 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/simba_theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />

  
    <link rel="shortcut icon" href="../../../_static/readthedocs_logo.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            SimBA
              <img src="../../../_static/readthedocs_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">API REFERENCE:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">NOTEBOOKS:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks.html">Notebooks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">USER GUIDE / TUTORIALS:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">WALKTHROUGHS:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../walkthroughs.html">Walkthroughs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">LABELLING TUTORIALS:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../labelling.html">Labelling</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials_rst/FAQ.html">Friendly Asked Questions (FAQ)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DOCS:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/workflow.html">SimBA basic workflow</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ABOUT:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../credits.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../credits.html#who-writes-this-stuff">Who writes this stuff??</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../links.html">Links</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">SimBA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">simba.utils.read_write</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for simba.utils.read_write</h1><div class="highlight"><pre>
<span></span><span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Simon Nilsson&quot;</span>

<span class="kn">import</span> <span class="nn">configparser</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">webbrowser</span>
<span class="kn">from</span> <span class="nn">configparser</span> <span class="kn">import</span> <span class="n">ConfigParser</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span>

<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>

<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pkg_resources</span>
<span class="kn">import</span> <span class="nn">pyarrow</span> <span class="k">as</span> <span class="nn">pa</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span><span class="p">,</span> <span class="n">prange</span>
<span class="kn">from</span> <span class="nn">pyarrow</span> <span class="kn">import</span> <span class="n">csv</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="p">(</span><span class="n">LineString</span><span class="p">,</span> <span class="n">MultiLineString</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span>
                              <span class="n">Polygon</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">simba.utils.checks</span> <span class="kn">import</span> <span class="p">(</span><span class="n">check_file_exist_and_readable</span><span class="p">,</span> <span class="n">check_float</span><span class="p">,</span>
                                <span class="n">check_if_dir_exists</span><span class="p">,</span>
                                <span class="n">check_if_filepath_list_is_empty</span><span class="p">,</span>
                                <span class="n">check_if_string_value_is_valid_video_timestamp</span><span class="p">,</span>
                                <span class="n">check_instance</span><span class="p">,</span> <span class="n">check_int</span><span class="p">,</span>
                                <span class="n">check_nvidea_gpu_available</span><span class="p">,</span> <span class="n">check_str</span><span class="p">,</span>
                                <span class="n">check_valid_dataframe</span><span class="p">,</span> <span class="n">check_valid_lst</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">simba.utils.enums</span> <span class="kn">import</span> <span class="n">ConfigKey</span><span class="p">,</span> <span class="n">Dtypes</span><span class="p">,</span> <span class="n">Formats</span><span class="p">,</span> <span class="n">Keys</span><span class="p">,</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">simba.utils.errors</span> <span class="kn">import</span> <span class="p">(</span><span class="n">DataHeaderError</span><span class="p">,</span> <span class="n">DuplicationError</span><span class="p">,</span>
                                <span class="n">FFMPEGCodecGPUError</span><span class="p">,</span> <span class="n">FileExistError</span><span class="p">,</span>
                                <span class="n">FrameRangeError</span><span class="p">,</span> <span class="n">IntegerError</span><span class="p">,</span>
                                <span class="n">InvalidFilepathError</span><span class="p">,</span> <span class="n">InvalidFileTypeError</span><span class="p">,</span>
                                <span class="n">InvalidInputError</span><span class="p">,</span> <span class="n">InvalidVideoFileError</span><span class="p">,</span>
                                <span class="n">MissingProjectConfigEntryError</span><span class="p">,</span> <span class="n">NoDataError</span><span class="p">,</span>
                                <span class="n">NoFilesFoundError</span><span class="p">,</span> <span class="n">NotDirectoryError</span><span class="p">,</span>
                                <span class="n">ParametersFileError</span><span class="p">,</span> <span class="ne">PermissionError</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">simba.utils.printing</span> <span class="kn">import</span> <span class="n">SimbaTimer</span><span class="p">,</span> <span class="n">stdout_success</span>
<span class="kn">from</span> <span class="nn">simba.utils.warnings</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FileExistWarning</span><span class="p">,</span> <span class="n">InvalidValueWarning</span><span class="p">,</span> <span class="n">NoDataFoundWarning</span><span class="p">,</span>
    <span class="n">NoFileFoundWarning</span><span class="p">,</span> <span class="n">ThirdPartyAnnotationsInvalidFileFormatWarning</span><span class="p">)</span>

<span class="c1"># from simba.utils.keyboard_listener import KeyboardListener</span>


<span class="n">PARSE_OPTIONS</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">ParseOptions</span><span class="p">(</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">READ_OPTIONS</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">ReadOptions</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="read_df"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.read_df">[docs]</a><span class="k">def</span> <span class="nf">read_df</span><span class="p">(</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">file_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">has_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">remove_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">usecols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">anipose_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">check_multiindex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">multi_index_headers_to_keep</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read single tabular data file or pickle</span>

<span class="sd">    .. note::</span>
<span class="sd">       For improved runtime, defaults to :external:py:meth:`pyarrow.csv.write_cs` if file type is ``csv``.</span>

<span class="sd">    :parameter str file_path: Path to data file</span>
<span class="sd">    :parameter str file_type: Type of data. OPTIONS: &#39;parquet&#39;, &#39;csv&#39;, &#39;pickle&#39;.</span>
<span class="sd">    :parameter Optional[bool]: If the input file has an initial index column. Default: True.</span>
<span class="sd">    :parameter Optional[List[str]] remove_columns: If not None, then remove columns in lits.</span>
<span class="sd">    :parameter Optional[List[str]] usecols: If not None, then keep columns in list.</span>
<span class="sd">    :parameter bool check_multiindex: check file is multi-index headers. Default: False.</span>
<span class="sd">    :parameter int multi_index_headers_to_keep: If reading multi-index file, and we want to keep one of the dropped multi-index levels as the header in the output file, specify the index of the multiindex hader as int.</span>
<span class="sd">    :return pd.DataFrame</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; read_df(file_path=&#39;project_folder/csv/input_csv/Video_1.csv&#39;, file_type=&#39;csv&#39;, check_multiindex=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="n">Formats</span><span class="o">.</span><span class="n">CSV</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
                <span class="n">file_path</span><span class="p">,</span> <span class="n">parse_options</span><span class="o">=</span><span class="n">PARSE_OPTIONS</span><span class="p">,</span> <span class="n">read_options</span><span class="o">=</span><span class="n">READ_OPTIONS</span>
            <span class="p">)</span>
            <span class="n">duplicate_headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">column_names</span> <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">column_names</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">duplicate_headers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">new_headers</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">duplicate_headers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">column_names</span><span class="p">))</span>
                <span class="p">]</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename_columns</span><span class="p">(</span><span class="n">new_headers</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">anipose_data</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
                <span class="n">has_index</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">check_multiindex</span><span class="p">:</span>
                <span class="n">header_col_cnt</span> <span class="o">=</span> <span class="n">get_number_of_header_columns_in_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">multi_index_headers_to_keep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">multi_index_headers_to_keep</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">header_col_cnt</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span>
                            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;The selected multi-header index column </span><span class="si">{</span><span class="n">multi_index_headers_to_keep</span><span class="si">}</span><span class="s2"> does not exist in the multi-index header columns: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">header_col_cnt</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">source</span><span class="o">=</span><span class="n">read_df</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_header</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                            <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">multi_index_headers_to_keep</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span>
                        <span class="p">)</span>
                        <span class="n">new_header_xy</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">new_header</span><span class="p">)):</span>
                            <span class="n">new_header_xy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2">_x&quot;</span><span class="p">)</span>
                            <span class="n">new_header_xy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2">_y&quot;</span><span class="p">),</span> <span class="n">new_header_xy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2">_likelihood&quot;</span>
                            <span class="p">)</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">header_col_cnt</span><span class="p">))])</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                            <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span>
                        <span class="p">)</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">new_header_xy</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">header_col_cnt</span><span class="p">))])</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                        <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_index</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">InvalidFileTypeError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> is not a valid CSV file&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">read_df</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">remove_columns</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">remove_columns</span><span class="p">)]]</span>
        <span class="k">if</span> <span class="n">usecols</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">usecols</span><span class="p">)]]</span>
    <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="n">Formats</span><span class="o">.</span><span class="n">PARQUET</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check_multiindex</span><span class="p">:</span>
            <span class="n">header_col_cnt</span> <span class="o">=</span> <span class="n">get_number_of_header_columns_in_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">header_col_cnt</span><span class="p">))])</span>
                <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">)</span>
                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="n">Formats</span><span class="o">.</span><span class="n">PICKLE</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidFileTypeError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2"> is not a valid filetype OPTIONS: [pickle, csv, parquet]&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">read_df</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="write_df"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.write_df">[docs]</a><span class="k">def</span> <span class="nf">write_df</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">save_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">multi_idx_header</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write single tabular data file.</span>

<span class="sd">    .. note::</span>
<span class="sd">       For improved runtime, defaults to ``pyarrow.csv`` if file_type == ``csv``.</span>

<span class="sd">    :parameter pd.DataFrame df: Pandas dataframe to save to disk.</span>
<span class="sd">    :parameter str file_type: Type of data. OPTIONS: ``parquet``, ``csv``,  ``pickle``.</span>
<span class="sd">    :parameter str save_path: Location where to store the data.</span>
<span class="sd">    :parameter bool check_multiindex: check if input file is multi-index headers. Default: False.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; write_df(df=df, file_type=&#39;csv&#39;, save_path=&#39;project_folder/csv/input_csv/Video_1.csv&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="n">Formats</span><span class="o">.</span><span class="n">CSV</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">multi_idx_header</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;scorer&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;__index_level_0__&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">column_names</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">remove_column</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">column_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;__index_level_0__&quot;</span><span class="p">))</span>
            <span class="n">csv</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;scorer&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="n">Formats</span><span class="o">.</span><span class="n">PARQUET</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="n">Formats</span><span class="o">.</span><span class="n">PICKLE</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">raise</span> <span class="n">InvalidFileTypeError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Data could not be saved as a pickle.&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">write_df</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidFileTypeError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2"> is not a valid filetype OPTIONS: [csv, pickle, parquet]&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">write_df</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="get_fn_ext"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.get_fn_ext">[docs]</a><span class="k">def</span> <span class="nf">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split file path into three components: (i) directory, (ii) file name, and (iii) file extension.</span>

<span class="sd">    :parameter str filepath: Path to file.</span>
<span class="sd">    :return str: File directory name</span>
<span class="sd">    :return str: File name</span>
<span class="sd">    :return str: File extension</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; get_fn_ext(filepath=&#39;C:/My_videos/MyVideo.mp4&#39;)</span>
<span class="sd">    &gt;&gt;&gt; (&#39;My_videos&#39;, &#39;MyVideo&#39;, &#39;.mp4&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_extension</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filepath</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">file_extension</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidFilepathError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2"> is not a valid filepath&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">get_fn_ext</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">dir_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_extension</span></div>


<div class="viewcode-block" id="read_config_entry"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.read_config_entry">[docs]</a><span class="k">def</span> <span class="nf">read_config_entry</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">,</span>
    <span class="n">section</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">option</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">default_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper to read entry in SimBA project_config.ini parsed by configparser.ConfigParser.</span>

<span class="sd">    :param configparser.ConfigParser config: Parsed SimBA project_config.ini. Use :meth:`simba.utils.read_config_file` to parse file.</span>
<span class="sd">    :param str section: Section name of entry to parse.</span>
<span class="sd">    :param str option: Option name of entry to parse.</span>
<span class="sd">    :param str data_type: Type of data to parse. E.g., `str`, `int`, `float`.</span>
<span class="sd">    :param Optional[Any] default_value: If no matching entry can be found in the project_config.ini, use this as default.</span>
<span class="sd">    :param Optional[List] or None options: List of valid options. If not None, checks that the returned entry value exists in this list.</span>
<span class="sd">    :return Any</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; read_config_entry(config=&#39;project_folder/project_config.ini&#39;, section=&#39;General settings&#39;, option=&#39;project_name&#39;, data_type=&#39;str&#39;)</span>
<span class="sd">    &gt;&gt;&gt; &#39;two_animals_14_bps&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="n">Dtypes</span><span class="o">.</span><span class="n">FLOAT</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="n">Dtypes</span><span class="o">.</span><span class="n">INT</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="n">Dtypes</span><span class="o">.</span><span class="n">STR</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="n">Dtypes</span><span class="o">.</span><span class="n">FOLDER</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">NotDirectoryError</span><span class="p">(</span>
                        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;The SimBA config file includes paths to a folder (</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">) that does not exist.&quot;</span><span class="p">,</span>
                        <span class="n">source</span><span class="o">=</span><span class="n">read_config_entry</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="n">options</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span>
                        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">option</span><span class="si">}</span><span class="s2"> is set to </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2"> in SimBA, but this is not among the valid options: (</span><span class="si">{</span><span class="n">options</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                        <span class="n">source</span><span class="o">=</span><span class="n">read_config_entry</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">value</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">elif</span> <span class="n">default_value</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MissingProjectConfigEntryError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SimBA could not find an entry for option </span><span class="si">{</span><span class="n">option</span><span class="si">}</span><span class="s2"> under section </span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="s2"> in the project_config.ini. Please specify the settings in the settings menu and make sure the path to your project config is correct&quot;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">read_config_entry</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">default_value</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MissingProjectConfigEntryError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SimBA could not find an entry for option </span><span class="si">{</span><span class="n">option</span><span class="si">}</span><span class="s2"> under section </span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="s2"> in the project_config.ini. Please specify the settings in the settings menu.&quot;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">read_config_entry</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="read_project_path_and_file_type"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.read_project_path_and_file_type">[docs]</a><span class="k">def</span> <span class="nf">read_project_path_and_file_type</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper to read the path and file type of the SimBA project from the project_config.ini.</span>

<span class="sd">    :param configparser.ConfigParser config: parsed SimBA config in configparser.ConfigParser format</span>
<span class="sd">    :return str: The path of the project ``project_folder``.</span>
<span class="sd">    :return str: The set file type of the project (i.e., ``csv`` or ``parquet``).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">project_path</span> <span class="o">=</span> <span class="n">read_config_entry</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
        <span class="n">section</span><span class="o">=</span><span class="n">ConfigKey</span><span class="o">.</span><span class="n">GENERAL_SETTINGS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">option</span><span class="o">=</span><span class="n">ConfigKey</span><span class="o">.</span><span class="n">PROJECT_PATH</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">data_type</span><span class="o">=</span><span class="n">ConfigKey</span><span class="o">.</span><span class="n">FOLDER_PATH</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">file_type</span> <span class="o">=</span> <span class="n">read_config_entry</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
        <span class="n">section</span><span class="o">=</span><span class="n">ConfigKey</span><span class="o">.</span><span class="n">GENERAL_SETTINGS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">option</span><span class="o">=</span><span class="n">ConfigKey</span><span class="o">.</span><span class="n">FILE_TYPE</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">data_type</span><span class="o">=</span><span class="n">Dtypes</span><span class="o">.</span><span class="n">STR</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">default_value</span><span class="o">=</span><span class="n">Formats</span><span class="o">.</span><span class="n">CSV</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">project_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">NotDirectoryError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;The project config file </span><span class="si">{</span><span class="n">config</span><span class="si">}</span><span class="s2"> has project path </span><span class="si">{</span><span class="n">project_path</span><span class="si">}</span><span class="s2"> that does not exist&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">read_project_path_and_file_type</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">project_path</span><span class="p">,</span> <span class="n">file_type</span></div>


<div class="viewcode-block" id="read_video_info_csv"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.read_video_info_csv">[docs]</a><span class="k">def</span> <span class="nf">read_video_info_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the project_folder/logs/video_info.csv of the SimBA project as a pd.DataFrame</span>

<span class="sd">    :parameter str file_path: Path to the SimBA project ``project_folder/logs/video_info.csv`` file</span>
<span class="sd">    :return pd.DataFrame</span>
<span class="sd">    :raise ParametersFileError: Invalid format of ``project_folder/logs/video_info.csv``.</span>
<span class="sd">    :raise InvalidValueWarning: Some videos are registered with FPS &gt;= 1.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; read_video_info_csv(file_path=&#39;project_folder/logs/video_info.csv&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">info_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">&quot;Video&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fps&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Resolution_width&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Resolution_height&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Distance_in_mm&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pixels/mm&quot;</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">info_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParametersFileError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The project &quot;project_folder/logs/video_info.csv&quot; does not not have an anticipated header (</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">). Please re-create the file and make sure each video has a </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1"> value&#39;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">read_video_info_csv</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="n">info_df</span><span class="p">[</span><span class="s2">&quot;Video&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info_df</span><span class="p">[</span><span class="s2">&quot;Video&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">&quot;fps&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Resolution_width&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Resolution_height&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Distance_in_mm&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pixels/mm&quot;</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">info_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">info_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParametersFileError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;One or more values in the </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1"> column of the &quot;project_folder/logs/video_info.csv&quot; file could not be interpreted as a numeric value. Please re-create the file and make sure the entries in the </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1"> column are all numeric.&#39;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">read_video_info_csv</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">if</span> <span class="n">info_df</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">InvalidValueWarning</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Videos in your SimBA project have an FPS of 1 or less. Please use videos with more than one frame per second, or correct the inaccurate fps inside the `project_folder/logs/videos_info.csv` file&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">read_video_info_csv</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">info_df</span></div>


<div class="viewcode-block" id="read_config_file"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.read_config_file">[docs]</a><span class="k">def</span> <span class="nf">read_config_file</span><span class="p">(</span><span class="n">config_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper to parse SimBA project project_config.ini file</span>

<span class="sd">    :parameter str config_path: Path to project_config.ini file</span>
<span class="sd">    :return configparser.ConfigParser: parsed project_config.ini file</span>
<span class="sd">    :raise MissingProjectConfigEntryError: Invalid file format.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; read_config_file(config_path=&#39;project_folder/project_config.ini&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">MissingProjectConfigEntryError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2"> is not a valid project_config file. Please check the project_config.ini path.&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">read_config_entry</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span></div>


<div class="viewcode-block" id="get_video_meta_data"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.get_video_meta_data">[docs]</a><span class="k">def</span> <span class="nf">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">],</span> <span class="n">fps_as_int</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read video metadata (fps, resolution, frame cnt etc.) from video file (e.g., mp4).</span>

<span class="sd">    :parameter str video_path: Path to a video file.</span>
<span class="sd">    :parameter bool fps_as_int: If True, force video fps to int through floor rounding, else float. Default = True.</span>
<span class="sd">    :return dict: Video file meta data.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; get_video_meta_data(&#39;test_data/video_tests/Video_1.avi&#39;)</span>
<span class="sd">    {&#39;video_name&#39;: &#39;Video_1&#39;, &#39;fps&#39;: 30, &#39;width&#39;: 400, &#39;height&#39;: 600, &#39;frame_count&#39;: 300, &#39;resolution_str&#39;: &#39;400 x 600&#39;, &#39;video_length_s&#39;: 10}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">video_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">video_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
        <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">video_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">):</span>
        <span class="n">cap</span> <span class="o">=</span> <span class="n">video_path</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;video_path is neither a file path or a cv2.VideoCapture: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">get_video_meta_data</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">video_data</span><span class="p">[</span><span class="s2">&quot;video_name&quot;</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">video_data</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FPS</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fps_as_int</span><span class="p">:</span>
        <span class="n">video_data</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">video_data</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">])</span>
    <span class="n">video_data</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">))</span>
    <span class="n">video_data</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">))</span>
    <span class="n">video_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_COUNT</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_CHANNEL</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">video_data</span><span class="p">[</span><span class="s2">&quot;color_format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;rgb&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">video_data</span><span class="p">[</span><span class="s2">&quot;color_format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;grey&#39;</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">video_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidVideoFileError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Video </span><span class="si">{</span><span class="n">video_data</span><span class="p">[</span><span class="s2">&quot;video_name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> either does not exist or has </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"> of </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s1"> (full error video path: </span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1">).&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">get_video_meta_data</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">video_data</span><span class="p">[</span><span class="s2">&quot;resolution_str&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">video_data</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">video_data</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">video_data</span><span class="p">[</span><span class="s2">&quot;video_length_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">video_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">video_data</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">video_data</span></div>


<div class="viewcode-block" id="remove_a_folder"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.remove_a_folder">[docs]</a><span class="k">def</span> <span class="nf">remove_a_folder</span><span class="p">(</span><span class="n">folder_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper to remove a directory&quot;&quot;&quot;</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">folder_dir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="concatenate_videos_in_folder"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.concatenate_videos_in_folder">[docs]</a><span class="k">def</span> <span class="nf">concatenate_videos_in_folder</span><span class="p">(</span><span class="n">in_folder</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                                 <span class="n">save_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                                 <span class="n">file_paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                 <span class="n">video_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mp4&quot;</span><span class="p">,</span>
                                 <span class="n">substring</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                 <span class="n">remove_splits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                 <span class="n">gpu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                 <span class="n">fps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Concatenate (temporally) all video files in a folder into a single video.</span>

<span class="sd">    .. important::</span>
<span class="sd">       Input video parts will be joined in alphanumeric order, should ideally have to have sequential numerical ordered file names, e.g., ``1.mp4``, ``2.mp4``....</span>

<span class="sd">    .. note::</span>
<span class="sd">       If substring and file_paths are both not None, then file_paths with be sliced and only file paths with substring will be retained.</span>

<span class="sd">    :parameter Union[str, os.PathLike] in_folder: Path to folder holding un-concatenated video files.</span>
<span class="sd">    :parameter Union[str, os.PathLike] save_path: Path to the saved the output file. Note: If the path exist, it will be overwritten</span>
<span class="sd">    :parameter Optional[List[Union[str, os.PathLike]]] file_paths: If not None, then the files that should be joined. If None, then all files. Default None.</span>
<span class="sd">    :parameter Optional[str] video_format: The format of the video clips that should be concatenated. Default: mp4.</span>
<span class="sd">    :parameter Optional[str] substring: If a string, then only videos in in_folder with a filename that contains substring will be joined. If None, then all are joined. Default: None.</span>
<span class="sd">    :parameter Optional[str] video_format: Format of the input video files in ``in_folder``. Default: ``mp4``.</span>
<span class="sd">    :parameter Optional[bool] remove_splits: If true, the input splits in the ``in_folder`` will be removed following concatenation. Default: True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_nvidea_gpu_available</span><span class="p">()</span> <span class="ow">and</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FFMPEGCodecGPUError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;No FFMpeg GPU codec found.&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">concatenate_videos_in_folder</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_paths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">in_folder</span> <span class="o">+</span> <span class="s2">&quot;/*.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">video_format</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">:</span>
            <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">file_paths</span>
    <span class="n">check_if_filepath_list_is_empty</span><span class="p">(</span><span class="n">filepaths</span><span class="o">=</span><span class="n">files</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA ERROR: Cannot join videos in directory </span><span class="si">{</span><span class="n">in_folder</span><span class="si">}</span><span class="s2">. The directory contain ZERO files in format </span><span class="si">{</span><span class="n">video_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">substring</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sliced_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">substring</span> <span class="ow">in</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">sliced_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">check_if_filepath_list_is_empty</span><span class="p">(</span>
            <span class="n">filepaths</span><span class="o">=</span><span class="n">sliced_paths</span><span class="p">,</span>
            <span class="n">error_msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA ERROR: Cannot join videos in directory </span><span class="si">{</span><span class="n">in_folder</span><span class="si">}</span><span class="s2">. The directory contain ZERO files in format </span><span class="si">{</span><span class="n">video_format</span><span class="si">}</span><span class="s2"> with substring </span><span class="si">{</span><span class="n">substring</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">sliced_paths</span>
    <span class="n">files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;\D&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">)))</span>
    <span class="n">temp_txt_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">in_folder</span><span class="p">,</span> <span class="s2">&quot;files.txt&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">temp_txt_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">temp_txt_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_txt_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;file &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">out_fps</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">fps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;fps&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">int_fps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fps</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fps</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">int_fps</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;If FPS is a string it represents the video index (</span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s1">) which is more than the number of videos in the input directory (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">concatenate_videos_in_folder</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="n">out_fps</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">files</span><span class="p">[</span><span class="n">int_fps</span><span class="p">])[</span><span class="s1">&#39;fps&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fps</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">out_fps</span> <span class="o">=</span> <span class="n">fps</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FPS of the output video has to be None, or a string index, or a float, or an integer&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">concatenate_videos_in_folder</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">fps</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">check_nvidea_gpu_available</span><span class="p">()</span> <span class="ow">and</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">returned</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -f concat -safe 0 -i &quot;</span><span class="si">{</span><span class="n">temp_txt_path</span><span class="si">}</span><span class="s1">&quot; -c copy -hide_banner -loglevel info &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -y&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">returned</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ffmpeg -hwaccel auto -c:v h264_cuvid -f concat -safe 0 -i &quot;</span><span class="si">{</span><span class="n">temp_txt_path</span><span class="si">}</span><span class="s1">&quot; -r </span><span class="si">{</span><span class="n">out_fps</span><span class="si">}</span><span class="s1"> -c:v h264_nvenc -c:a copy -hide_banner -loglevel info &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -y&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">returned</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ffmpeg -f concat -safe 0 -i &quot;</span><span class="si">{</span><span class="n">temp_txt_path</span><span class="si">}</span><span class="s1">&quot; &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -c copy -hide_banner -loglevel info -y&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">returned</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ffmpeg -f concat -safe 0 -i &quot;</span><span class="si">{</span><span class="n">temp_txt_path</span><span class="si">}</span><span class="s1">&quot; -r </span><span class="si">{</span><span class="n">out_fps</span><span class="si">}</span><span class="s1"> -c:v libx264 -c:a copy -hide_banner -loglevel info &quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&quot; -y&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">returned</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">remove_splits</span><span class="p">:</span>
                <span class="n">remove_a_folder</span><span class="p">(</span><span class="n">folder_dir</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">in_folder</span><span class="p">))</span>
            <span class="k">break</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Video concatenated&quot;</span><span class="p">,</span>
        <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">concatenate_videos_in_folder</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="get_bp_headers"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.get_bp_headers">[docs]</a><span class="k">def</span> <span class="nf">get_bp_headers</span><span class="p">(</span><span class="n">body_parts_lst</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper to create ordered list of all column header fields from body-part names for SimBA project dataframes.</span>

<span class="sd">    :parameter List[str] body_parts_lst: Body-part names in the SimBA prject</span>
<span class="sd">    :return List[str]: Body-part headers</span>

<span class="sd">    :examaple:</span>
<span class="sd">    &gt;&gt;&gt; get_bp_headers(body_parts_lst=[&#39;Nose&#39;])</span>
<span class="sd">    &gt;&gt;&gt; [&#39;Nose_x&#39;, &#39;Nose_y&#39;, &#39;Nose_p&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">bp_headers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">bp</span> <span class="ow">in</span> <span class="n">body_parts_lst</span><span class="p">:</span>
        <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bp</span><span class="si">}</span><span class="s2">_x&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bp</span><span class="si">}</span><span class="s2">_y&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bp</span><span class="si">}</span><span class="s2">_p&quot;</span><span class="p">)</span>
        <span class="n">bp_headers</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">bp_headers</span></div>


<div class="viewcode-block" id="read_video_info"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.read_video_info">[docs]</a><span class="k">def</span> <span class="nf">read_video_info</span><span class="p">(</span><span class="n">vid_info_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                    <span class="n">video_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">raise_error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper to read the metadata (pixels per mm, resolution, fps etc) from the video_info.csv for a single input file/video</span>

<span class="sd">    :parameter pd.DataFrame vid_info_df: Parsed ``project_folder/logs/video_info.csv`` file. This file can be parsed by :meth:`simba.utils.read_write.read_video_info_csv`.</span>
<span class="sd">    :parameter str video_name: Name of the video as represented in the ``Video`` column of the ``project_folder/logs/video_info.csv`` file.</span>
<span class="sd">    :parameter Optional[bool] raise_error: If True, raises error if the video cannot be found in the ``vid_info_df`` file. If False, returns None if the video cannot be found.</span>
<span class="sd">    :returns Tuple[pd.DataFrame, float, float]: One row DataFrame representing the video in the ``project_folder/logs/video_info.csv`` file, the frame rate of the video, and the the pixels per millimeter of the video</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; video_info_df = read_video_info_csv(file_path=&#39;project_folder/logs/video_info.csv&#39;)</span>
<span class="sd">    &gt;&gt;&gt; read_video_info(vid_info_df=vid_info_df, video_name=&#39;Together_1&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">video_settings</span> <span class="o">=</span> <span class="n">vid_info_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">vid_info_df</span><span class="p">[</span><span class="s2">&quot;Video&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">video_name</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">video_settings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DuplicationError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SimBA found multiple rows in the project_folder/logs/video_info.csv named </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">video_name</span><span class="p">)</span><span class="si">}</span><span class="s2">. Please make sure that each video name is represented ONCE in the video_info.csv&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">read_video_info</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">video_settings</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">raise_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParametersFileError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot; SimBA could not find </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">video_name</span><span class="p">)</span><span class="si">}</span><span class="s2"> in the video_info.csv file. Make sure all videos analyzed are represented in the project_folder/logs/video_info.csv file.&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">read_video_info</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">px_per_mm</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">video_settings</span><span class="p">[</span><span class="s2">&quot;pixels/mm&quot;</span><span class="p">])</span>
            <span class="n">fps</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">video_settings</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">video_settings</span><span class="p">,</span> <span class="n">px_per_mm</span><span class="p">,</span> <span class="n">fps</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParametersFileError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Make sure the videos that are going to be analyzed are represented with APPROPRIATE VALUES inside the project_folder/logs/video_info.csv file in your SimBA project. Could not interpret the fps, pixels per millimeter and/or fps as numerical values for video </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">read_video_info</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>


<div class="viewcode-block" id="find_all_videos_in_directory"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.find_all_videos_in_directory">[docs]</a><span class="k">def</span> <span class="nf">find_all_videos_in_directory</span><span class="p">(</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">as_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">raise_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">video_formats</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;.avi&quot;</span><span class="p">,</span> <span class="s2">&quot;.mp4&quot;</span><span class="p">,</span> <span class="s2">&quot;.mov&quot;</span><span class="p">,</span> <span class="s2">&quot;.flv&quot;</span><span class="p">,</span> <span class="s2">&quot;.m4v&quot;</span><span class="p">,</span> <span class="s1">&#39;.webm&#39;</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all video file paths within a directory</span>

<span class="sd">    :param str directory: Directory to search for video files.</span>
<span class="sd">    :param bool as_dict: If True, returns dictionary with the video name as key and file path as value.</span>
<span class="sd">    :param bool raise_error: If True, raise error if no videos are found. Else, NoFileFoundWarning.</span>
<span class="sd">    :param Tuple[str] video_formats: Acceptable video formats. Default: &#39;.avi&#39;, &#39;.mp4&#39;, &#39;.mov&#39;, &#39;.flv&#39;, &#39;.m4v&#39;.</span>
<span class="sd">    :return List[str] or Dict[str, str]</span>
<span class="sd">    :raises NoFilesFoundError: If ``raise_error`` and ``directory`` has no files in formats ``video_formats``.</span>

<span class="sd">    :examples:</span>
<span class="sd">    &gt;&gt;&gt; find_all_videos_in_directory(directory=&#39;project_folder/videos&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">video_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">video_formats</span><span class="p">):</span>
            <span class="n">video_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">video_lst</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">raise_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No videos found in directory </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> in formats </span><span class="si">{</span><span class="n">video_formats</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">video_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;No videos found&quot;</span><span class="p">)</span>
            <span class="n">NoFileFoundWarning</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;No videos found in directory (</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">find_all_videos_in_directory</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">video_lst</span> <span class="ow">and</span> <span class="n">as_dict</span><span class="p">:</span>
        <span class="n">video_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">video_name</span> <span class="ow">in</span> <span class="n">video_lst</span><span class="p">:</span>
            <span class="n">video_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">video_name</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
            <span class="n">video_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">video_path</span>
        <span class="k">return</span> <span class="n">video_dict</span>

    <span class="k">return</span> <span class="n">video_lst</span></div>


<div class="viewcode-block" id="read_frm_of_video"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.read_frm_of_video">[docs]</a><span class="k">def</span> <span class="nf">read_frm_of_video</span><span class="p">(</span><span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">],</span>
                      <span class="n">frame_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="n">opacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">greyscale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">clahe</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads single image from video file.</span>

<span class="sd">    :param Union[str, os.PathLike] video_path: Path to video file, or cv2.VideoCapture object.</span>
<span class="sd">    :param int frame_index: The frame of video to return. Default: 1. Note, if frame index -1 is passed, the last frame of the video is read in.</span>
<span class="sd">    :param Optional[int] opacity: Value between 0 and 100 or None. If float value, returns image with opacity. 100 fully opaque. 0.0 fully transparant.</span>
<span class="sd">    :param Optional[Tuple[int, int]] size: If tuple, resizes the image to size. Else, returns original image size.</span>
<span class="sd">    :param Optional[bool] greyscale: If true, returns the greyscale image. Default False.</span>
<span class="sd">    :param Optional[bool] clahe: If true, returns clahe enhanced image. Default False.</span>
<span class="sd">    :return np.ndarray: Image as numpy array.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; img = read_frm_of_video(video_path=&#39;/Users/simon/Desktop/envs/platea_featurizer/data/video/3D_Mouse_5-choice_MouseTouchBasic_s9_a4_grayscale.mp4&#39;, clahe=True)</span>
<span class="sd">    &gt;&gt;&gt; cv2.imshow(&#39;img&#39;, img)</span>
<span class="sd">    &gt;&gt;&gt; cv2.waitKey(5000)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_instance</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">read_frm_of_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">video_path</span><span class="p">,</span> <span class="n">accepted_types</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
        <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">video_meta_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;frame_count&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">video_path</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_COUNT</span><span class="p">))}</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;frame_index&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">frame_index</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">frame_index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">frame_index</span> <span class="o">=</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">frame_index</span> <span class="o">&gt;</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">frame_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">FrameRangeError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Frame </span><span class="si">{</span><span class="n">frame_index</span><span class="si">}</span><span class="s1"> is out of range: The video </span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s1"> contains </span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> frames.&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">read_frm_of_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">capture</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">capture</span> <span class="o">=</span> <span class="n">video_path</span>
    <span class="n">capture</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_POS_FRAMES</span><span class="p">,</span> <span class="n">frame_index</span><span class="p">)</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">img</span> <span class="o">=</span> <span class="n">capture</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">opacity</span><span class="p">:</span>
            <span class="n">opacity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">opacity</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
            <span class="n">check_float</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Opacity&quot;</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
                <span class="n">min_value</span><span class="o">=</span><span class="mf">0.00</span><span class="p">,</span>
                <span class="n">max_value</span><span class="o">=</span><span class="mf">1.00</span><span class="p">,</span>
                <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">opacity</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">opacity</span>
            <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">clr</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">opacity_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">clr</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="n">opacity</span><span class="p">)</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">addWeighted</span><span class="p">(</span>
                <span class="n">img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span>
                <span class="mi">1</span> <span class="o">-</span> <span class="n">opacity</span><span class="p">,</span>
                <span class="n">opacity_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span>
                <span class="n">opacity</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">size</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">greyscale</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clahe</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">createCLAHE</span><span class="p">(</span><span class="n">clipLimit</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tileGridSize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">NoDataFoundWarning</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Frame </span><span class="si">{</span><span class="n">frame_index</span><span class="si">}</span><span class="s2"> for video </span><span class="si">{</span><span class="n">video_path</span><span class="si">}</span><span class="s2"> could not be read.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span></div>


<div class="viewcode-block" id="find_video_of_file"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.find_video_of_file">[docs]</a><span class="k">def</span> <span class="nf">find_video_of_file</span><span class="p">(</span><span class="n">video_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                       <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                       <span class="n">raise_error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">warning</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper to find the video file with the SimBA project that represents a known data file path.</span>

<span class="sd">    :param str video_dir: Directory holding putative video file.</span>
<span class="sd">    :param str filename: Data file name, e.g., ``Video_1``.</span>
<span class="sd">    :param Optional[bool] raise_error: If True, raise error if no file can be found. If False, returns None if no file can be found. Default: False</span>
<span class="sd">    :param Optional[bool] warning: If True, print warning if no file can be found. If False, no warning is printed if file cannot be found. Default: False</span>
<span class="sd">    :return str: Video path.</span>

<span class="sd">    :examples:</span>
<span class="sd">    &gt;&gt;&gt; find_video_of_file(video_dir=&#39;project_folder/videos&#39;, filename=&#39;Together_1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; &#39;project_folder/videos/Together_1.avi&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">all_files_in_video_folder</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">next</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">video_dir</span><span class="p">))[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">raise_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;No files found in the </span><span class="si">{</span><span class="n">video_dir</span><span class="si">}</span><span class="s2"> directory&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">find_video_of_file</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">warning</span><span class="p">:</span>
            <span class="n">NoFileFoundWarning</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SimBA could not find a video file representing </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> in the project video directory </span><span class="si">{</span><span class="n">video_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">find_video_of_file</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">all_files_in_video_folder</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">video_dir</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_files_in_video_folder</span><span class="p">]</span>
    <span class="n">return_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">all_files_in_video_folder</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">video_filename</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">video_filename</span> <span class="o">==</span> <span class="n">filename</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Options</span><span class="o">.</span><span class="n">ALL_VIDEO_FORMAT_OPTIONS</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
            <span class="n">return_path</span> <span class="o">=</span> <span class="n">file_path</span>

    <span class="k">if</span> <span class="n">return_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">raise_error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SimBA could not find a video file representing </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> in the project video directory </span><span class="si">{</span><span class="n">video_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">find_video_of_file</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">return_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">warning</span><span class="p">:</span>
        <span class="n">NoFileFoundWarning</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SimBA could not find a video file representing </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> in the project video directory </span><span class="si">{</span><span class="n">video_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">find_video_of_file</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">return_path</span></div>


<div class="viewcode-block" id="find_files_of_filetypes_in_directory"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.find_files_of_filetypes_in_directory">[docs]</a><span class="k">def</span> <span class="nf">find_files_of_filetypes_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                         <span class="n">extensions</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                                         <span class="n">raise_warning</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                         <span class="n">raise_error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find all files in a directory of specified extensions/types.</span>

<span class="sd">    :param str directory: Directory holding files.</span>
<span class="sd">    :param List[str] extensions: Accepted file extensions.</span>
<span class="sd">    :param bool raise_warning: If True, raise error if no files are found.</span>

<span class="sd">    :return List[str]: All files in ``directory`` with extensions.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; find_files_of_filetypes_in_directory(directory=&#39;project_folder/videos&#39;, extensions=[&#39;mp4&#39;, &#39;avi&#39;, &#39;png&#39;], raise_warning=False)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">all_files_in_folder</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">next</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">))[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span>
        <span class="p">]</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">raise_warning</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;No files found in the </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> directory with accepted extensions </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">extensions</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">find_files_of_filetypes_in_directory</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_files_in_folder</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">pass</span>
    <span class="n">all_files_in_folder</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_files_in_folder</span><span class="p">]</span>
    <span class="n">accepted_file_paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">all_files_in_folder</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
            <span class="n">accepted_file_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">accepted_file_paths</span> <span class="ow">and</span> <span class="n">raise_warning</span><span class="p">:</span>
        <span class="n">NoFileFoundWarning</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SimBA could not find any files with accepted extensions </span><span class="si">{</span><span class="n">extensions</span><span class="si">}</span><span class="s2"> in the </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> directory&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">find_files_of_filetypes_in_directory</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">accepted_file_paths</span> <span class="ow">and</span> <span class="n">raise_error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoDataError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SimBA could not find any files with accepted extensions </span><span class="si">{</span><span class="n">extensions</span><span class="si">}</span><span class="s2"> in the </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> directory&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">find_files_of_filetypes_in_directory</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">accepted_file_paths</span></div>


<div class="viewcode-block" id="convert_parquet_to_csv"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.convert_parquet_to_csv">[docs]</a><span class="k">def</span> <span class="nf">convert_parquet_to_csv</span><span class="p">(</span><span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert all parquet files in a directory to csv format.</span>

<span class="sd">    :param str directory: Path to directory holding parquet files</span>
<span class="sd">    :raise NoFilesFoundError: The directory has no ``parquet`` files.</span>

<span class="sd">    :examples:</span>
<span class="sd">    &gt;&gt;&gt; convert_parquet_to_csv(directory=&#39;project_folder/csv/input_csv&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">NotDirectoryError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;SIMBA ERROR: </span><span class="si">{}</span><span class="s2"> is not a valid directory&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directory</span><span class="p">),</span>
            <span class="n">source</span><span class="o">=</span><span class="n">convert_parquet_to_csv</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">files_found</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">directory</span> <span class="o">+</span> <span class="s2">&quot;/*.parquet&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files_found</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span>
            <span class="s2">&quot;SIMBA ERROR: No parquet files (with .parquet file ending) found in the </span><span class="si">{}</span><span class="s2"> directory&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">directory</span>
            <span class="p">),</span>
            <span class="n">source</span><span class="o">=</span><span class="n">convert_parquet_to_csv</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files_found</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading in </span><span class="si">{}</span><span class="s2"> ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)))</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">new_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">directory</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;scorer&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;scorer&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">new_file_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saved </span><span class="si">{}</span><span class="s2">...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_file_path</span><span class="p">))</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">files_found</span><span class="p">))</span><span class="si">}</span><span class="s2"> parquet files in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> converted to csv&quot;</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">convert_parquet_to_csv</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="convert_csv_to_parquet"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.convert_csv_to_parquet">[docs]</a><span class="k">def</span> <span class="nf">convert_csv_to_parquet</span><span class="p">(</span><span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert all csv files in a folder to parquet format.</span>

<span class="sd">    :param str directory: Path to directory holding csv files.</span>
<span class="sd">    :raise NoFilesFoundError: The directory has no ``csv`` files.</span>

<span class="sd">    :examples:</span>
<span class="sd">    &gt;&gt;&gt; convert_parquet_to_csv(directory=&#39;project_folder/csv/input_csv&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">NotDirectoryError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;SIMBA ERROR: </span><span class="si">{}</span><span class="s2"> is not a valid directory&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directory</span><span class="p">),</span>
            <span class="n">source</span><span class="o">=</span><span class="n">convert_csv_to_parquet</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">files_found</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">directory</span> <span class="o">+</span> <span class="s2">&quot;/*.csv&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files_found</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;SIMBA ERROR: No parquet files (with .csv file ending) found in the </span><span class="si">{}</span><span class="s2"> directory&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">directory</span>
            <span class="p">),</span>
            <span class="n">source</span><span class="o">=</span><span class="n">convert_csv_to_parquet</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Converting </span><span class="si">{}</span><span class="s2"> files...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">files_found</span><span class="p">))))</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files_found</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading in </span><span class="si">{}</span><span class="s2"> ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)))</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">new_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">directory</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;.parquet&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">new_file_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saved </span><span class="si">{}</span><span class="s2">...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_file_path</span><span class="p">))</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">files_found</span><span class="p">))</span><span class="si">}</span><span class="s2"> csv files in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> converted to parquet&quot;</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">convert_csv_to_parquet</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="get_file_name_info_in_directory"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.get_file_name_info_in_directory">[docs]</a><span class="k">def</span> <span class="nf">get_file_name_info_in_directory</span><span class="p">(</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span> <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get dict of all file paths in a directory with specified extension as values and file base names as keys.</span>

<span class="sd">    :param str directory: Directory containing files.</span>
<span class="sd">    :param str file_type: File-type in ``directory`` of interest</span>
<span class="sd">    :return dict: All found files as values and file base names as keys.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; get_file_name_info_in_directory(directory=&#39;C:\project_folder\csv\machine_results&#39;, file_type=&#39;csv&#39;)</span>
<span class="sd">    &gt;&gt;&gt; {&#39;Video_1&#39;: &#39;C:\project_folder\csv\machine_results\Video_1&#39;}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">file_paths</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">directory</span> <span class="o">+</span> <span class="s2">&quot;/*.&quot;</span> <span class="o">+</span> <span class="n">file_type</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="n">file_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_path</span>

    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="archive_processed_files"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.archive_processed_files">[docs]</a><span class="k">def</span> <span class="nf">archive_processed_files</span><span class="p">(</span>
    <span class="n">config_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span> <span class="n">archive_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Archive files within a SimBA project.</span>

<span class="sd">    :param str config_path: Path to SimBA project ``project_config.ini``.</span>
<span class="sd">    :param str archive_name: Name of archive.</span>

<span class="sd">    .. seealso::</span>
<span class="sd">       `Tutorial &lt;https://github.com/sgoldenlab/simba/blob/master/docs/Scenario4_new.md&gt;`_</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; archive_processed_files(config_path=&#39;project_folder/project_config.ini&#39;, archive_name=&#39;my_archive&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">read_config_file</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="n">config_path</span><span class="p">)</span>
    <span class="n">file_type</span> <span class="o">=</span> <span class="n">read_config_entry</span><span class="p">(</span>
        <span class="n">config</span><span class="p">,</span>
        <span class="n">ConfigKey</span><span class="o">.</span><span class="n">GENERAL_SETTINGS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">ConfigKey</span><span class="o">.</span><span class="n">FILE_TYPE</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="s2">&quot;str&quot;</span><span class="p">,</span>
        <span class="s2">&quot;csv&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">project_path</span> <span class="o">=</span> <span class="n">read_config_entry</span><span class="p">(</span>
        <span class="n">config</span><span class="p">,</span>
        <span class="n">ConfigKey</span><span class="o">.</span><span class="n">GENERAL_SETTINGS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">ConfigKey</span><span class="o">.</span><span class="n">PROJECT_PATH</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">data_type</span><span class="o">=</span><span class="n">ConfigKey</span><span class="o">.</span><span class="n">FOLDER_PATH</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">videos_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;videos&quot;</span><span class="p">)</span>
    <span class="n">csv_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">config_path</span><span class="p">),</span> <span class="s2">&quot;csv&quot;</span><span class="p">)</span>
    <span class="n">log_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">)</span>
    <span class="n">video_info_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_path</span><span class="p">,</span> <span class="s2">&quot;video_info.csv&quot;</span><span class="p">)</span>
    <span class="n">csv_subdirs</span><span class="p">,</span> <span class="n">file_lst</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">content_name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">csv_dir</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_dir</span><span class="p">,</span> <span class="n">content_name</span><span class="p">)):</span>
            <span class="n">csv_subdirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_dir</span><span class="p">,</span> <span class="n">content_name</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">subdirectory</span> <span class="ow">in</span> <span class="n">csv_subdirs</span><span class="p">:</span>
        <span class="n">subdirectory_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">subdirectory</span> <span class="o">+</span> <span class="s2">&quot;/*&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">subdirectory_files</span><span class="p">:</span>
            <span class="n">directory</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdirectory</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_type</span><span class="p">):</span>
                <span class="n">file_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdirectory</span><span class="p">,</span> <span class="n">file_path</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_lst</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;SIMBA ERROR: No data files located in your project_folder/csv sub-directories in the worflow file format </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">file_type</span>
            <span class="p">),</span>
            <span class="n">source</span><span class="o">=</span><span class="n">archive_processed_files</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_lst</span><span class="p">:</span>
        <span class="n">file_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">save_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_folder</span><span class="p">,</span> <span class="n">archive_name</span><span class="p">)</span>
        <span class="n">save_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_directory</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_directory</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">save_directory</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Moving file </span><span class="si">{}</span><span class="s2">...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">save_file_path</span><span class="p">)</span>

    <span class="n">log_archive_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_path</span><span class="p">,</span> <span class="n">archive_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">log_archive_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">log_archive_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">video_info_path</span><span class="p">):</span>
        <span class="n">save_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_archive_path</span><span class="p">,</span> <span class="s2">&quot;video_info.csv&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Moving file </span><span class="si">{}</span><span class="s2">...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">video_info_path</span><span class="p">))</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">video_info_path</span><span class="p">,</span> <span class="n">save_file_path</span><span class="p">)</span>

    <span class="n">videos_file_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">videos_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span>
    <span class="n">video_archive_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">videos_dir</span><span class="p">,</span> <span class="n">archive_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">video_archive_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">video_archive_path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">video_file</span> <span class="ow">in</span> <span class="n">videos_file_paths</span><span class="p">:</span>
        <span class="n">save_video_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">video_archive_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">video_file</span><span class="p">))</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">video_file</span><span class="p">,</span> <span class="n">save_video_path</span><span class="p">)</span>
    <span class="n">stdout_success</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Archiving completed&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">archive_processed_files</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>


<div class="viewcode-block" id="str_2_bool"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.str_2_bool">[docs]</a><span class="k">def</span> <span class="nf">str_2_bool</span><span class="p">(</span><span class="n">input_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper to convert string representation of bool to bool.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; str_2_bool(input_str=&#39;yes&#39;)</span>
<span class="sd">    &gt;&gt;&gt; True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">input_str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="tabulate_clf_info"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.tabulate_clf_info">[docs]</a><span class="k">def</span> <span class="nf">tabulate_clf_info</span><span class="p">(</span><span class="n">clf_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print the hyperparameters and creation date of a pickled classifier.</span>

<span class="sd">    :param str clf_path: Path to classifier</span>
<span class="sd">    :raise InvalidFilepathError: The file is not a pickle or not a scikit-learn RF classifier.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">clf_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">clf_path</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">clf_path</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">clf_obj</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">clf_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidFilepathError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">clf_path</span><span class="si">}</span><span class="s2"> file is not a pickle file&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">tabulate_clf_info</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">clf_features_no</span> <span class="o">=</span> <span class="n">clf_obj</span><span class="o">.</span><span class="n">n_features_</span>
        <span class="n">clf_criterion</span> <span class="o">=</span> <span class="n">clf_obj</span><span class="o">.</span><span class="n">criterion</span>
        <span class="n">clf_estimators</span> <span class="o">=</span> <span class="n">clf_obj</span><span class="o">.</span><span class="n">n_estimators</span>
        <span class="n">clf_min_samples_leaf</span> <span class="o">=</span> <span class="n">clf_obj</span><span class="o">.</span><span class="n">min_samples_split</span>
        <span class="n">clf_n_jobs</span> <span class="o">=</span> <span class="n">clf_obj</span><span class="o">.</span><span class="n">n_jobs</span>
        <span class="n">clf_verbose</span> <span class="o">=</span> <span class="n">clf_obj</span><span class="o">.</span><span class="n">verbose</span>
        <span class="k">if</span> <span class="n">clf_verbose</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">clf_verbose</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">clf_verbose</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">clf_verbose</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidFilepathError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">clf_path</span><span class="si">}</span><span class="s2"> file is not an scikit-learn RF classifier&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">tabulate_clf_info</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">creation_time</span> <span class="o">=</span> <span class="s2">&quot;Unknown&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
            <span class="n">creation_time</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getctime</span><span class="p">(</span><span class="n">clf_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span>
            <span class="n">creation_time</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">clf_path</span><span class="p">)</span>
            <span class="n">creation_time</span> <span class="o">=</span> <span class="n">creation_time</span><span class="o">.</span><span class="n">st_birthtime</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">if</span> <span class="n">creation_time</span> <span class="o">!=</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">:</span>
        <span class="n">creation_time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">creation_time</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">clf_name</span><span class="p">),</span> <span class="s2">&quot;CLASSIFIER INFORMATION&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;NUMBER OF FEATURES&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NUMBER OF TREES&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CLASSIFIER CRITERION&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CLASSIFIER_MIN_SAMPLE_LEAF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CLASSIFIER_N_JOBS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CLASSIFIER VERBOSE SETTING&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CLASSIFIER PATH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CLASSIFIER CREATION TIME&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="n">clf_features_no</span><span class="p">,</span>
            <span class="n">clf_estimators</span><span class="p">,</span>
            <span class="n">clf_criterion</span><span class="p">,</span>
            <span class="n">clf_min_samples_leaf</span><span class="p">,</span>
            <span class="n">clf_n_jobs</span><span class="p">,</span>
            <span class="n">clf_verbose</span><span class="p">,</span>
            <span class="n">clf_path</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">creation_time</span><span class="p">),</span>
        <span class="p">],</span>
    <span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span></div>


<div class="viewcode-block" id="get_all_clf_names"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.get_all_clf_names">[docs]</a><span class="k">def</span> <span class="nf">get_all_clf_names</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">,</span> <span class="n">target_cnt</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all classifier names in a SimBA project.</span>

<span class="sd">    :param configparser.ConfigParser config: Parsed SimBA project_config.ini</span>
<span class="sd">    :param int target_cnt: Count of models in SimBA project</span>
<span class="sd">    :return List[str]: Classifier model names</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; get_all_clf_names(config=config, target_cnt=2)</span>
<span class="sd">    &gt;&gt;&gt; [&#39;Attack&#39;, &#39;Sniffing&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">target_cnt</span><span class="p">):</span>
        <span class="n">entry_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;target_name_</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">model_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_config_entry</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">ConfigKey</span><span class="o">.</span><span class="n">SML_SETTINGS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">entry_name</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">Dtypes</span><span class="o">.</span><span class="n">STR</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">model_names</span></div>


<div class="viewcode-block" id="read_meta_file"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.read_meta_file">[docs]</a><span class="k">def</span> <span class="nf">read_meta_file</span><span class="p">(</span><span class="n">meta_file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in single SimBA modelconfig meta file CSV to python dictionary.</span>

<span class="sd">    :param str meta_file_path: Path to SimBA config meta file</span>
<span class="sd">    :return dict: Dictionary holding model parameters.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; read_meta_file(&#39;project_folder/configs/Attack_meta_0.csv&#39;)</span>
<span class="sd">    &gt;&gt;&gt; {&#39;Classifier_name&#39;: &#39;Attack&#39;, &#39;RF_n_estimators&#39;: 2000, &#39;RF_max_features&#39;: &#39;sqrt&#39;, &#39;RF_criterion&#39;: &#39;gini&#39;, ...}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">meta_file_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">meta_file_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="read_simba_meta_files"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.read_simba_meta_files">[docs]</a><span class="k">def</span> <span class="nf">read_simba_meta_files</span><span class="p">(</span><span class="n">folder_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">raise_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in paths of SimBA model config files directory (`project_folder/configs&#39;). Consider files that have `meta` suffix only.</span>

<span class="sd">    :param str folder_path: directory with SimBA model config meta files</span>
<span class="sd">    :param bool raise_error: If True, raise error if no files are found with ``meta`` suffix. Else, print warning. Default: False.</span>
<span class="sd">    :return List[str]: List of paths to  SimBA model config meta files.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; read_simba_meta_files(folder_path=&#39;/project_folder/configs&#39;)</span>
<span class="sd">    &gt;&gt;&gt; [&#39;project_folder/configs/Attack_meta_1.csv&#39;, &#39;project_folder/configs/Attack_meta_0.csv&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_paths</span> <span class="o">=</span> <span class="n">find_files_of_filetypes_in_directory</span><span class="p">(</span>
        <span class="n">directory</span><span class="o">=</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;.csv&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">meta_file_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="s2">&quot;meta&quot;</span><span class="p">):</span>
            <span class="n">meta_file_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta_file_lst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">raise_error</span><span class="p">:</span>
        <span class="n">NoFileFoundWarning</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The training meta-files folder in your project (</span><span class="si">{</span><span class="n">folder_path</span><span class="si">}</span><span class="s1">) does not have any meta files inside it (no files in this folder has the &quot;meta&quot; substring in the filename)&#39;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">read_simba_meta_files</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta_file_lst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">raise_error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The training meta-files folder in your project (</span><span class="si">{</span><span class="n">folder_path</span><span class="si">}</span><span class="s1">) does not have any meta files inside it (no files in this folder has the &quot;meta&quot; substring in the filename)&#39;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">read_simba_meta_files</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">meta_file_lst</span></div>


<div class="viewcode-block" id="find_core_cnt"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.find_core_cnt">[docs]</a><span class="k">def</span> <span class="nf">find_core_cnt</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the local cpu count and quarter of the cpu counts.</span>

<span class="sd">    :return int: The local cpu count</span>
<span class="sd">    :return int: The local cpu count // 4</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; find_core_cnt()</span>
<span class="sd">    &gt;&gt;&gt; (8, 2)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cpu_cnt</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
    <span class="n">cpu_cnt_to_use</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cpu_cnt</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cpu_cnt_to_use</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cpu_cnt_to_use</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">cpu_cnt</span><span class="p">,</span> <span class="n">cpu_cnt_to_use</span></div>


<div class="viewcode-block" id="get_number_of_header_columns_in_df"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.get_number_of_header_columns_in_df">[docs]</a><span class="k">def</span> <span class="nf">get_number_of_header_columns_in_df</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the count of non-numerical header rows in dataframe. E.g., can be helpful to determine if dataframe is multi-index columns.</span>

<span class="sd">    :param pd.DataFrame df: Dataframe to check the count of non-numerical header rows for.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; get_number_of_header_columns_in_df(df=&#39;project_folder/csv/input_csv/Video_1.csv&#39;)</span>
<span class="sd">    &gt;&gt;&gt; 3</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">i</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">raise</span> <span class="n">DataHeaderError</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Could find the count of header columns in dataframe, all rows appear non-numeric&quot;</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">get_number_of_header_columns_in_df</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="get_memory_usage_of_df"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.get_memory_usage_of_df">[docs]</a><span class="k">def</span> <span class="nf">get_memory_usage_of_df</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the RAM memory usage of a dataframe.</span>

<span class="sd">    :param pd.DataFrame df: Parsed dataframe</span>
<span class="sd">    :return dict: The memory usage of the dataframe in bytes, mb, and gb.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame(np.random.randint(0,100,size=(100, 4)), columns=list(&#39;ABCD&#39;))</span>
<span class="sd">    &gt;&gt;&gt; {&#39;bytes&#39;: 3328, &#39;megabytes&#39;: 0.003328, &#39;gigabytes&#39;: 3e-06}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;bytes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;megabytes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;bytes&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;gigabytes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;bytes&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="copy_single_video_to_project"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.copy_single_video_to_project">[docs]</a><span class="k">def</span> <span class="nf">copy_single_video_to_project</span><span class="p">(</span>
    <span class="n">simba_ini_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">source_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">symlink</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">allowed_video_formats</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;avi&quot;</span><span class="p">,</span> <span class="s2">&quot;mp4&quot;</span><span class="p">),</span>
    <span class="n">overwrite</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Import single video file to SimBA project</span>

<span class="sd">    :param Union[str, os.PathLike] simba_ini_path: path to SimBA project config file in Configparser format</span>
<span class="sd">    :param Union[str, os.PathLike] source_path: Path to video file outside SimBA project.</span>
<span class="sd">    :param Optional[bool] symlink: If True, creates soft copy rather than hard copy. Default: False.</span>
<span class="sd">    :param Optional[Tuple[str]] allowed_video_formats: Allowed video formats. DEFAULT: avi or mp4</span>
<span class="sd">    :param Optional[bool] overwrite: If True, overwrites existing video if it exists in SimBA project. Else, raise FileExistError.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">source_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Copying video </span><span class="si">{}</span><span class="s2"> file...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">file_ext</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_video_formats</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidFileTypeError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;SimBA works best with avi and mp4 video-files. Or please convert your videos to mp4 or avi to continue before importing it.&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">copy_single_video_to_project</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">new_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_name</span> <span class="o">+</span> <span class="n">file_ext</span><span class="p">)</span>
    <span class="n">destination</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">simba_ini_path</span><span class="p">),</span> <span class="s2">&quot;videos&quot;</span><span class="p">,</span> <span class="n">new_filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FileExistError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> already exist in SimBA project. To import, delete this video file before importing the new video file with the same name.&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">copy_single_video_to_project</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">symlink</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">destination</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span>
                    <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Symbolic link privilege not held. Try running SimBA in terminal opened in admin mode&quot;</span><span class="p">,</span>
                    <span class="n">source</span><span class="o">=</span><span class="n">copy_single_video_to_project</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">symlink</span><span class="p">:</span>
            <span class="n">stdout_success</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> imported to SimBA project (project_folder/videos directory&quot;</span><span class="p">,</span>
                <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">copy_single_video_to_project</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stdout_success</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Video </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">  SYMLINK imported to SimBA project (project_folder/videos directory&quot;</span><span class="p">,</span>
                <span class="n">elapsed_time</span><span class="o">=</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">copy_single_video_to_project</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="copy_multiple_videos_to_project"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.copy_multiple_videos_to_project">[docs]</a><span class="k">def</span> <span class="nf">copy_multiple_videos_to_project</span><span class="p">(</span>
    <span class="n">config_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">source</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">symlink</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">allowed_video_formats</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;avi&quot;</span><span class="p">,</span> <span class="s2">&quot;mp4&quot;</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Import directory of videos to SimBA project.</span>

<span class="sd">    :param Union[str, os.PathLike] simba_ini_path: path to SimBA project config file in Configparser format</span>
<span class="sd">    :param Union[str, os.PathLike] source_path: Path to directory with video files outside SimBA project.</span>
<span class="sd">    :param str file_type: Video format of imported videos (i.e.,: mp4 or avi)</span>
<span class="sd">    :param Optional[bool] symlink: If True, creates soft copies rather than hard copies. Default: False.</span>
<span class="sd">    :param Optional[Tuple[str]] allowed_video_formats: Allowed video formats. DEFAULT: avi or mp4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">multiple_video_timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_video_formats</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidFileTypeError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;SimBA only works with avi and mp4 video files (Please enter mp4 or avi in entrybox). Or convert your videos to mp4 or avi to continue.&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">copy_multiple_videos_to_project</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">video_path_lst</span> <span class="o">=</span> <span class="n">find_all_videos_in_directory</span><span class="p">(</span>
        <span class="n">directory</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">video_formats</span><span class="o">=</span><span class="p">(</span><span class="n">file_type</span><span class="p">),</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">video_path_lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">video_path_lst</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">video_path_lst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA ERROR: No videos found in </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2"> directory of file-type </span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">copy_multiple_videos_to_project</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">destination_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">config_path</span><span class="p">),</span> <span class="s2">&quot;videos&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_path_lst</span><span class="p">):</span>
        <span class="n">timer</span> <span class="o">=</span> <span class="n">SimbaTimer</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dir_name</span><span class="p">,</span> <span class="n">filebasename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">file_extension</span> <span class="o">=</span> <span class="n">file_extension</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">newFileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filebasename</span> <span class="o">+</span> <span class="n">file_extension</span><span class="p">)</span>
        <span class="n">dest1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">,</span> <span class="n">newFileName</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dest1</span><span class="p">):</span>
            <span class="n">FileExistWarning</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filebasename</span><span class="si">}</span><span class="s2"> already exist in SimBA project. Skipping video...&quot;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">copy_multiple_videos_to_project</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">symlink</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">dest1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">dest1</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Symbolic link privilege not held. Try running SimBA in terminal opened in admin mode&quot;</span><span class="p">)</span>
            <span class="n">timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">symlink</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filebasename</span><span class="si">}</span><span class="s2"> copied to project (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_path_lst</span><span class="p">)</span><span class="si">}</span><span class="s2">, elapsed timer </span><span class="si">{</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="si">}</span><span class="s2">s)...&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filebasename</span><span class="si">}</span><span class="s2"> copied to project (SYMLINK) (Video </span><span class="si">{</span><span class="n">file_cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_path_lst</span><span class="p">)</span><span class="si">}</span><span class="s2">, elapsed timer </span><span class="si">{</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="si">}</span><span class="s2">s)...&quot;</span>
                <span class="p">)</span>

    <span class="n">multiple_video_timer</span><span class="o">.</span><span class="n">stop_timer</span><span class="p">()</span>
    <span class="n">stdout_success</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">video_path_lst</span><span class="p">)</span><span class="si">}</span><span class="s2"> videos copied to project.&quot;</span><span class="p">,</span>
        <span class="n">elapsed_time</span><span class="o">=</span><span class="n">multiple_video_timer</span><span class="o">.</span><span class="n">elapsed_time_str</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">copy_multiple_videos_to_project</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="find_all_videos_in_project"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.find_all_videos_in_project">[docs]</a><span class="k">def</span> <span class="nf">find_all_videos_in_project</span><span class="p">(</span>
    <span class="n">videos_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span> <span class="n">basename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get filenames of .avi and .mp4 files within a directory</span>

<span class="sd">    :param str videos_dir: Directory holding video files.</span>
<span class="sd">    :param bool basename: If true returns basenames, else file paths.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; find_all_videos_in_project(videos_dir=&#39;project_folder/videos&#39;)</span>
<span class="sd">    &gt;&gt;&gt; [&#39;project_folder/videos/Together_2.avi&#39;, &#39;project_folder/videos/Together_3.avi&#39;, &#39;project_folder/videos/Together_1.avi&#39;]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">video_paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">file_paths_in_folder</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">next</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">videos_dir</span><span class="p">))[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">]</span>
    <span class="n">file_paths_in_folder</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">videos_dir</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">file_paths_in_folder</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_paths_in_folder</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidFilepathError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> is not a valid filepath&quot;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">find_all_videos_in_project</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">file_ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.mp4&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">file_ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.avi&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">basename</span><span class="p">:</span>
                <span class="n">video_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">video_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">video_paths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;No videos in mp4 or avi format found imported to SimBA project in the </span><span class="si">{</span><span class="n">videos_dir</span><span class="si">}</span><span class="s2"> directory&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">find_all_videos_in_project</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">video_paths</span></div>


<div class="viewcode-block" id="check_if_hhmmss_timestamp_is_valid_part_of_video"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.check_if_hhmmss_timestamp_is_valid_part_of_video">[docs]</a><span class="k">def</span> <span class="nf">check_if_hhmmss_timestamp_is_valid_part_of_video</span><span class="p">(</span><span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper to check that a timestamp in HH:MM:SS format is a valid timestamp in a video file.</span>

<span class="sd">    :param str timestamp: Timestamp in HH:MM:SS format.</span>
<span class="sd">    :param str video_path: Path to a video file.</span>
<span class="sd">    :raises FrameRangeError: If timestamp is not in the video file. E.g., timestamp 00:01:00 will raise FrameRangeError if the video is 59s long.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; check_if_hhmmss_timestamp_is_valid_part_of_video(timestamp=&#39;01:00:05&#39;, video_path=&#39;/Users/simon/Desktop/video_tests/Together_1.avi&#39;)</span>
<span class="sd">    &gt;&gt;&gt; &quot;FrameRangeError: The timestamp &#39;01:00:05&#39; does not occur in video Together_1.avi, the video has length 10s&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">check_if_string_value_is_valid_video_timestamp</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Timestamp&quot;</span><span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
    <span class="n">time_stamp_in_seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;video_length_s&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">time_stamp_in_seconds</span><span class="p">:</span>
        <span class="n">video_length_str</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;video_length_s&quot;</span><span class="p">])</span>
        <span class="k">raise</span> <span class="n">FrameRangeError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The timestamp </span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s1"> does not occur in video </span><span class="si">{</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;video_name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, the video has length </span><span class="si">{</span><span class="n">video_length_str</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">check_if_hhmmss_timestamp_is_valid_part_of_video</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="timestamp_to_seconds"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.timestamp_to_seconds">[docs]</a><span class="k">def</span> <span class="nf">timestamp_to_seconds</span><span class="p">(</span><span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the number of seconds into the video given a timestamp in HH:MM:SS format.</span>
<span class="sd">    :raises FrameRangeError: If timestamp is not a valid format.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; timestamp_to_seconds(timestamp=&#39;00:00:05&#39;)</span>
<span class="sd">    &gt;&gt;&gt; 5</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_if_string_value_is_valid_video_timestamp</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Timestamp&quot;</span><span class="p">)</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>




<div class="viewcode-block" id="find_time_stamp_from_frame_numbers"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.find_time_stamp_from_frame_numbers">[docs]</a><span class="k">def</span> <span class="nf">find_time_stamp_from_frame_numbers</span><span class="p">(</span>
    <span class="n">start_frame</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end_frame</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given start and end frame numbers and frames per second (fps), return a list of formatted time stamps</span>
<span class="sd">    corresponding to the frame range start and end time.</span>

<span class="sd">    :param int start_frame: The starting frame index.</span>
<span class="sd">    :param int end_frame: The ending frame index.</span>
<span class="sd">    :param float fps: Frames per second.</span>
<span class="sd">    :return List[str]: A list of time stamps in the format &#39;HH:MM:SS:MS&#39;.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; find_time_stamp_from_frame_numbers(start_frame=11, end_frame=20, fps=3.4)</span>
<span class="sd">    &gt;&gt;&gt; [&#39;00:00:03:235&#39;, &#39;00:00:05:882&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_time</span><span class="p">(</span><span class="n">frame_index</span><span class="p">,</span> <span class="n">fps</span><span class="p">):</span>
        <span class="n">total_seconds</span> <span class="o">=</span> <span class="n">frame_index</span> <span class="o">/</span> <span class="n">fps</span>
        <span class="n">milliseconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">total_seconds</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">total_seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_seconds</span><span class="p">)</span>
        <span class="n">seconds</span> <span class="o">=</span> <span class="n">total_seconds</span> <span class="o">%</span> <span class="mi">60</span>
        <span class="n">total_seconds</span> <span class="o">//=</span> <span class="mi">60</span>
        <span class="n">minutes</span> <span class="o">=</span> <span class="n">total_seconds</span> <span class="o">%</span> <span class="mi">60</span>
        <span class="n">hours</span> <span class="o">=</span> <span class="n">total_seconds</span> <span class="o">//</span> <span class="mi">60</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">:</span><span class="si">{:02d}</span><span class="s2">:</span><span class="si">{:02d}</span><span class="s2">.</span><span class="si">{:03d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span><span class="p">,</span> <span class="n">milliseconds</span>
        <span class="p">)</span>

    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;start_frame&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">start_frame</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;end_frame&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">end_frame</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">check_float</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;FPS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">start_frame</span> <span class="o">&gt;</span> <span class="n">end_frame</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FrameRangeError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Start frame (</span><span class="si">{</span><span class="n">start_frame</span><span class="si">}</span><span class="s2">) cannot be before end frame (</span><span class="si">{</span><span class="n">end_frame</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">get_time</span><span class="p">(</span><span class="n">start_frame</span><span class="p">,</span> <span class="n">fps</span><span class="p">),</span> <span class="n">get_time</span><span class="p">(</span><span class="n">end_frame</span><span class="p">,</span> <span class="n">fps</span><span class="p">)]</span></div>


<div class="viewcode-block" id="read_roi_data"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.read_roi_data">[docs]</a><span class="k">def</span> <span class="nf">read_roi_data</span><span class="p">(</span>
    <span class="n">roi_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to read in ROI definitions from SimBA project</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">roi_path</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">rectangles_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">roi_path</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">Keys</span><span class="o">.</span><span class="n">ROI_RECTANGLES</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span>
        <span class="p">)</span>
        <span class="n">circles_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">roi_path</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">Keys</span><span class="o">.</span><span class="n">ROI_CIRCLES</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>
        <span class="n">polygon_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">roi_path</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">Keys</span><span class="o">.</span><span class="n">ROI_POLYGONS</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidFileTypeError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">roi_path</span><span class="si">}</span><span class="s2"> is not a valid SimBA ROI definitions file&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">read_roi_data</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;Center_XCenter_Y&quot;</span> <span class="ow">in</span> <span class="n">polygon_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">polygon_df</span> <span class="o">=</span> <span class="n">polygon_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;Center_XCenter_Y&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">polygon_df</span> <span class="o">=</span> <span class="n">polygon_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">rectangles_df</span><span class="p">,</span> <span class="n">circles_df</span><span class="p">,</span> <span class="n">polygon_df</span></div>


<div class="viewcode-block" id="create_directory"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.create_directory">[docs]</a><span class="k">def</span> <span class="nf">create_directory</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="find_max_vertices_coordinates"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.find_max_vertices_coordinates">[docs]</a><span class="k">def</span> <span class="nf">find_max_vertices_coordinates</span><span class="p">(</span>
    <span class="n">shapes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">LineString</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">Point</span><span class="p">]],</span>
    <span class="n">buffer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the maximum x and y coordinates among the vertices of a list of Shapely geometries.</span>

<span class="sd">    Can be useful for plotting puposes, to dtermine the rquired size of the canvas to fit all geometries.</span>

<span class="sd">    :param List[Union[Polygon, LineString, MultiPolygon, Point]] shapes: A list of Shapely geometries including Polygons, LineStrings, MultiPolygons, and Points.</span>
<span class="sd">    :param Optional[int] buffer: If int, adds to maximum x and y.</span>
<span class="sd">    :returns Tuple[int, int]: A tuple containing the maximum x and y coordinates found among the vertices.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; polygon = Polygon([(0, 0), (1, 0), (1, 1), (0, 1)])</span>
<span class="sd">    &gt;&gt;&gt; line = LineString([(1, 1), (2, 2), (3, 1), (4, 0)])</span>
<span class="sd">    &gt;&gt;&gt; multi_polygon = MultiPolygon([Polygon([(0, 0), (1, 0), (1, 1), (0, 1)]), Polygon([(1, 1), (2, 1), (2, 2), (1, 2)])])</span>
<span class="sd">    &gt;&gt;&gt; point = Point(3, 4)</span>
<span class="sd">    &gt;&gt;&gt; find_max_vertices_coordinates([polygon, line, multi_polygon, point])</span>
<span class="sd">    &gt;&gt;&gt; (4, 4)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
        <span class="n">check_instance</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="n">find_max_vertices_coordinates</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="n">instance</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
            <span class="n">accepted_types</span><span class="o">=</span><span class="p">(</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">LineString</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">MultiLineString</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">shape</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
                <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">vertex</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_y</span><span class="p">,</span> <span class="n">vertex</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="n">shape</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">polygon</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
                    <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">vertex</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_y</span><span class="p">,</span> <span class="n">vertex</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">LineString</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">shape</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
                <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">vertex</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_y</span><span class="p">,</span> <span class="n">vertex</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">Point</span><span class="p">):</span>
            <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">shape</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span>
                <span class="n">max_y</span><span class="p">,</span> <span class="n">shape</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">MultiLineString</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">shape</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
                    <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">vertex</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_y</span><span class="p">,</span> <span class="n">vertex</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">buffer</span><span class="p">:</span>
        <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Buffer&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">buffer</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">max_x</span> <span class="o">+=</span> <span class="n">buffer</span>
        <span class="n">max_y</span> <span class="o">+=</span> <span class="n">buffer</span>

    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_y</span><span class="p">)</span></div>

<div class="viewcode-block" id="clean_sleap_file_name"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.clean_sleap_file_name">[docs]</a><span class="k">def</span> <span class="nf">clean_sleap_file_name</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clean a SLEAP input filename by removing &#39;.analysis&#39; suffix, the video number, and project name prefix, to match orginal video name.</span>

<span class="sd">     .. note::</span>
<span class="sd">       Modified from `vtsai881 &lt;https://github.com/vtsai881&gt;`_.</span>

<span class="sd">    :param str filename: The original filename to be cleaned to match video name.</span>
<span class="sd">    :returns str: The cleaned filename.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; clean_sleap_file_name(&quot;projectname.v00x.00x_videoname.analysis.csv&quot;)</span>
<span class="sd">    &gt;&gt;&gt; &#39;videoname.csv&#39;</span>
<span class="sd">    &gt;&gt;&gt; clean_sleap_file_name(&quot;projectname.v00x.00x_videoname.analysis.h5&quot;)</span>
<span class="sd">    &gt;&gt;&gt; &#39;videoname.h5&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;.analysis&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">filename_parts</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">video_num_name</span> <span class="o">=</span> <span class="n">filename_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">video_num_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">video_num_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">filename</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">filename</span></div>


<div class="viewcode-block" id="clean_sleap_filenames_in_directory"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.clean_sleap_filenames_in_directory">[docs]</a><span class="k">def</span> <span class="nf">clean_sleap_filenames_in_directory</span><span class="p">(</span><span class="nb">dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clean up SLEAP input filenames in the specified directory by removing a prefix</span>
<span class="sd">    and a suffix, and renaming the files to match the names of the original video files.</span>

<span class="sd">    .. note::</span>
<span class="sd">       Modified from `vtsai881 &lt;https://github.com/vtsai881&gt;`_.</span>

<span class="sd">    :param Union[str, os.PathLike] dir: The directory path where the SLEAP CSV or H5 files are located.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; clean_sleap_filenames_in_directory(dir=&#39;/Users/simon/Desktop/envs/troubleshooting/Hornet_SLEAP/import/&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SLEAP_CSV_SUBSTR</span> <span class="o">=</span> <span class="s2">&quot;.analysis&quot;</span>
    <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="nb">dir</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span>
        <span class="nb">dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;/*.</span><span class="si">{</span><span class="n">Formats</span><span class="o">.</span><span class="n">CSV</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;/*.</span><span class="si">{</span><span class="n">Formats</span><span class="o">.</span><span class="n">H5</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">):</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">SLEAP_CSV_SUBSTR</span> <span class="ow">in</span> <span class="n">file_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">file_name</span><span class="p">):</span>
            <span class="n">new_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="nb">dir</span><span class="p">,</span>
                <span class="n">file_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="n">SLEAP_CSV_SUBSTR</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="copy_files_in_directory"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.copy_files_in_directory">[docs]</a><span class="k">def</span> <span class="nf">copy_files_in_directory</span><span class="p">(</span>
    <span class="n">in_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">out_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">raise_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">filetype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Copy files from the specified input directory to the output directory.</span>

<span class="sd">    :param Union[str, os.PathLike] in_dir: The input directory from which files will be copied.</span>
<span class="sd">    :param Union[str, os.PathLike] out_dir: The output directory where files will be copied to.</span>
<span class="sd">    :param bool raise_error: If True, raise an error if no files are found in the input directory. Default is True.</span>
<span class="sd">    :param Optional[str] filetype: If specified, only copy files with the given file extension. Default is None, meaning all files will be copied.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; copy_files_in_directory(&#39;/input_dir&#39;, &#39;/output_dir&#39;, raise_error=True, filetype=&#39;txt&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">in_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">out_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filetype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">in_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;/*.</span><span class="si">{</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">in_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;/*.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">raise_error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;No files found in </span><span class="si">{</span><span class="n">in_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">copy_files_in_directory</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">)</span></div>


<div class="viewcode-block" id="remove_files"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.remove_files">[docs]</a><span class="k">def</span> <span class="nf">remove_files</span><span class="p">(</span>
    <span class="n">file_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]],</span> <span class="n">raise_error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete (remove) the files specified within a list of filepaths.</span>

<span class="sd">    :param Union[str, os.PathLike] file_paths: A list of file paths to be removed.</span>
<span class="sd">    :param Optional[bool] raise_error: If True, raise exceptions for errors during file deletion. Else, pass. Defaults to False.</span>

<span class="sd">    :examples:</span>
<span class="sd">    &gt;&gt;&gt; file_paths = [&#39;/path/to/file1.txt&#39;, &#39;/path/to/file2.txt&#39;]</span>
<span class="sd">    &gt;&gt;&gt; remove_files(file_paths, raise_error=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">raise_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Cannot delete </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">. File does not exist&quot;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">remove_files</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">raise_error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span>
                        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Cannot read </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">. Is the file open in an alternative app?&quot;</span><span class="p">,</span>
                        <span class="n">source</span><span class="o">=</span><span class="n">remove_files</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span></div>


<div class="viewcode-block" id="web_callback"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.web_callback">[docs]</a><span class="k">def</span> <span class="nf">web_callback</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open_new</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="c1"># return all([result.scheme, result.netloc])</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Invalid URL: </span><span class="si">{url}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">web_callback</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_pkg_version"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.get_pkg_version">[docs]</a><span class="k">def</span> <span class="nf">get_pkg_version</span><span class="p">(</span><span class="n">pkg</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper to get the version of a package in the current python environment.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; get_pkg_version(pkg=&#39;simba-uw-tf-dev&#39;)</span>
<span class="sd">    &gt;&gt;&gt; 1.82.7</span>
<span class="sd">    &gt;&gt;&gt; get_pkg_version(pkg=&#39;bla-bla&#39;)</span>
<span class="sd">    &gt;&gt;&gt; None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">get_distribution</span><span class="p">(</span><span class="n">pkg</span><span class="p">)</span><span class="o">.</span><span class="n">version</span>
    <span class="k">except</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">DistributionNotFound</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="write_pickle"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.write_pickle">[docs]</a><span class="k">def</span> <span class="nf">write_pickle</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">save_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write a single object as pickle.</span>

<span class="sd">    :param str data_path: Pickled file path.</span>
<span class="sd">    :param str save_path: Location of saved pickle.</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; write_pickle(data=my_model, save_path=&#39;/test/unsupervised/cluster_models/My_model.pickle&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">save_path</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">raise</span> <span class="n">InvalidFileTypeError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Data could not be saved as a pickle.&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">write_pickle</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="read_pickle"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.read_pickle">[docs]</a><span class="k">def</span> <span class="nf">read_pickle</span><span class="p">(</span>
    <span class="n">data_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span> <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a single or directory of pickled objects. If directory, returns dict with numerical sequential integer keys for</span>
<span class="sd">    each object.</span>

<span class="sd">    :param str data_path: Pickled file path, or directory of pickled files.</span>
<span class="sd">    :param Optional[bool] verbose: If True, prints progress. Default False.</span>
<span class="sd">    :returns dict</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; data = read_pickle(data_path=&#39;/test/unsupervised/cluster_models&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">data_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading in data directory </span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">files_found</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">data_path</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;/*.</span><span class="si">{</span><span class="n">Formats</span><span class="o">.</span><span class="n">PICKLE</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files_found</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SIMBA ERROR: Zero pickle files found in </span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">read_pickle</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">file_cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files_found</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading in data file </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">file_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">InvalidFileTypeError</span><span class="p">(</span>
                        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Could not decompress file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> - invalid pickle&quot;</span><span class="p">,</span>
                        <span class="n">source</span><span class="o">=</span><span class="n">read_pickle</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">data_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">data_path</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading in data file </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">InvalidFileTypeError</span><span class="p">(</span>
                    <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Could not decompress file </span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s2"> - invalid pickle&quot;</span><span class="p">,</span>
                    <span class="n">source</span><span class="o">=</span><span class="n">read_pickle</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidFilepathError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;The path </span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s2"> is neither a valid file or directory path&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">read_pickle</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="drop_df_fields"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.drop_df_fields">[docs]</a><span class="k">def</span> <span class="nf">drop_df_fields</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">raise_error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drops specified fields in dataframe.</span>

<span class="sd">    :param pd.DataFrame: Data in pandas format.</span>
<span class="sd">    :param  List[str] fields: Columns to drop.</span>
<span class="sd">    :return pd.DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_instance</span><span class="p">(</span>
        <span class="n">source</span><span class="o">=</span><span class="n">drop_df_fields</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">accepted_types</span><span class="o">=</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,)</span>
    <span class="p">)</span>
    <span class="n">check_valid_lst</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">drop_df_fields</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="n">valid_dtypes</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,),</span>
        <span class="n">min_len</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">raise_error</span><span class="o">=</span><span class="n">raise_error</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">raise_error</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_unique_values_in_iterable"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.get_unique_values_in_iterable">[docs]</a><span class="k">def</span> <span class="nf">get_unique_values_in_iterable</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nb">min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nb">max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper to get and check the number of unique variables in iterable. E.g., check the number of unique identified clusters.</span>

<span class="sd">    :param np.ndarray data: 1D iterable.</span>
<span class="sd">    :param Optional[str] name: Arbitrary name of iterable for informative error messaging.</span>
<span class="sd">    :param Optional[int] min: Optional minimum number of unique variables. Default 1.</span>
<span class="sd">    :param Optional[int] max: Optional maximum number of unique variables. Default None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_instance</span><span class="p">(</span>
        <span class="n">source</span><span class="o">=</span><span class="n">get_unique_values_in_iterable</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="n">instance</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">accepted_types</span><span class="o">=</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
            <span class="nb">list</span><span class="p">,</span>
            <span class="nb">tuple</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">check_instance</span><span class="p">(</span>
        <span class="n">source</span><span class="o">=</span><span class="n">get_unique_values_in_iterable</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="n">instance</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">accepted_types</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,),</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
        <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span>
    <span class="p">):</span>
        <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">)]</span>
        <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Data </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> contains invalid dtypes </span><span class="si">{</span><span class="n">dtypes</span><span class="si">}</span><span class="s2">. Accepted dtypes: int, float, str&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">get_unique_values_in_iterable</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">cnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="nb">min</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">IntegerError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> has </span><span class="si">{</span><span class="n">cnt</span><span class="si">}</span><span class="s2"> unique observations, but </span><span class="si">{</span><span class="nb">min</span><span class="si">}</span><span class="s2"> unique observations is required for the operation.&quot;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">get_unique_values_in_iterable</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">if</span> <span class="nb">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="nb">max</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cnt</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">IntegerError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> has </span><span class="si">{</span><span class="n">cnt</span><span class="si">}</span><span class="s2"> unique observations, but no more than </span><span class="si">{</span><span class="nb">max</span><span class="si">}</span><span class="s2"> unique observations is allowed for the operation.&quot;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">get_unique_values_in_iterable</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">cnt</span></div>


<div class="viewcode-block" id="copy_files_to_directory"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.copy_files_to_directory">[docs]</a><span class="k">def</span> <span class="nf">copy_files_to_directory</span><span class="p">(</span><span class="n">file_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]],</span>
                            <span class="nb">dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                            <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="n">integer_save_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Copy a list of files to a specified directory.</span>

<span class="sd">    :param List[Union[str, os.PathLike]] file_paths: List of paths to the files to be copied.</span>
<span class="sd">    :param Union[str, os.PathLike] dir: Path to the directory where files will be copied.</span>
<span class="sd">    :param Optional[bool] verbose: If True, prints progress information. Default True.</span>
<span class="sd">    :param Optional[bool] integer_save_names: If True, saves files with integer names. E.g., file one in ``file_paths`` will be saved as dir/0.</span>
<span class="sd">    :return List[Union[str, os.PathLike]]: List of paths to the copied files</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_valid_lst</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">copy_files_to_directory</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">]</span>
    <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="nb">dir</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">copy_files_to_directory</span><span class="p">)</span>
    <span class="n">destinations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_paths</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Copying file </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2">)...&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">integer_save_names</span><span class="p">:</span>
            <span class="n">destination</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">destination</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cnt</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">destination</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Not allowed to overwrite file </span><span class="si">{</span><span class="n">destination</span><span class="si">}</span><span class="s2">. Try running SimBA in terminal opened in admin mode or delete existing file before copying.&quot;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">copy_files_to_directory</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">destinations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">destinations</span></div>


<div class="viewcode-block" id="seconds_to_timestamp"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.seconds_to_timestamp">[docs]</a><span class="k">def</span> <span class="nf">seconds_to_timestamp</span><span class="p">(</span><span class="n">seconds</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert an integer number representing seconds to a HH:MM:SS format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">seconds_to_timestamp</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">seconds</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seconds</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">)</span>
    <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">seconds</span> <span class="o">%</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seconds</span> <span class="o">%</span> <span class="mi">60</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">:</span><span class="si">{:02d}</span><span class="s2">:</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_data_paths"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.read_data_paths">[docs]</a><span class="k">def</span> <span class="nf">read_data_paths</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
                    <span class="n">default</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]],</span>
                    <span class="n">default_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">file_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;csv&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper to flexibly read in a set of file-paths.</span>

<span class="sd">    :param Union[str, os.PathLike] path: None or path to a file or a folder or list of paths to files.</span>
<span class="sd">    :param List[Union[str, os.PathLike]] default: If ``path`` is None. Use this passed list of file paths.</span>
<span class="sd">    :param Optional[str] default_name: A readable name representing the ``default`` for interpretable error msgs. Defaults to empty string.</span>
<span class="sd">    :param Optional[str] file_type: If path is a directory, read in all files in directory with this file extension. Default: ``csv``.</span>
<span class="sd">    :return List[str]: List of file paths.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">default</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;No files in format found in </span><span class="si">{</span><span class="n">default_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">read_data_paths</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">default</span><span class="p">:</span>
                <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="n">data_paths</span> <span class="o">=</span> <span class="n">default</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
            <span class="n">data_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">data_paths</span> <span class="o">=</span> <span class="n">find_files_of_filetypes_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_paths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;No files in format </span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2"> found in </span><span class="si">{</span><span class="n">default_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">read_data_paths</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> is not a valid path string (it&#39;s nether a file or a folder)&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">read_data_paths</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">check_valid_lst</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">read_data_paths</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> path&quot;</span><span class="p">,</span> <span class="n">valid_dtypes</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,),</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">data_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="n">data_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoFilesFoundError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not a valid type for path&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">read_data_paths</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data_paths</span></div>

<div class="viewcode-block" id="img_stack_to_greyscale"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.img_stack_to_greyscale">[docs]</a><span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;(uint8[:, :, :, :],)&quot;</span><span class="p">,</span> <span class="n">fastmath</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">img_stack_to_greyscale</span><span class="p">(</span><span class="n">imgs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Jitted conversion of a 4D stack of color images (RGB format) to grayscale.</span>
<span class="sd">    .. image:: _static/img/img_stack_to_greyscale.png</span>
<span class="sd">       :width: 600</span>
<span class="sd">       :align: center</span>
<span class="sd">    :parameter np.ndarray imgs: A 4D array representing color images. It should have the shape (num_images, height, width, 3) where the last dimension represents the color channels (R, G, B).</span>
<span class="sd">    :returns np.ndarray: A 3D array containing the grayscale versions of the input images. The shape of the output array is (num_images, height, width).</span>
<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; imgs = ImageMixin().read_img_batch_from_video( video_path=&#39;/Users/simon/Desktop/envs/troubleshooting/two_black_animals_14bp/videos/Together_1.avi&#39;, start_frm=0, end_frm=100)</span>
<span class="sd">    &gt;&gt;&gt; imgs = np.stack(list(imgs.values()))</span>
<span class="sd">    &gt;&gt;&gt; imgs_gray = ImageMixin.img_stack_to_greyscale(imgs=imgs)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">imgs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">imgs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">imgs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">imgs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.07</span> <span class="o">*</span> <span class="n">imgs</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.72</span> <span class="o">*</span> <span class="n">imgs</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.21</span> <span class="o">*</span> <span class="n">imgs</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="read_img_batch_from_video_gpu"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.read_img_batch_from_video_gpu">[docs]</a><span class="k">def</span> <span class="nf">read_img_batch_from_video_gpu</span><span class="p">(</span><span class="n">video_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                                  <span class="n">start_frm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">end_frm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                  <span class="n">greyscale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                  <span class="n">out_format</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;dict&#39;</span><span class="p">,</span> <span class="s1">&#39;array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dict&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a batch of frames from a video file using GPU acceleration.</span>

<span class="sd">    This function uses FFmpeg with CUDA acceleration to read frames from a specified range in a video file.</span>
<span class="sd">    It supports both RGB and greyscale video formats. Frames are returned as a dictionary where the keys are</span>
<span class="sd">    frame indices and the values are NumPy arrays representing the image data.</span>

<span class="sd">    :param video_path: Path to the video file. Can be a string or an os.PathLike object.</span>
<span class="sd">    :param start_frm: The starting frame index to read. If None, starts from the beginning of the video.</span>
<span class="sd">    :param end_frm: The ending frame index to read. If None, reads until the end of the video.</span>
<span class="sd">    :param verbose: If True, prints progress information to the console.</span>
<span class="sd">    :return: A dictionary where keys are frame indices (integers) and values are NumPy arrays containing the image data of each frame.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">video_meta_data</span> <span class="o">=</span> <span class="n">get_video_meta_data</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="n">video_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">start_frm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">read_img_batch_from_video_gpu</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">start_frm</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">start_frm</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">end_frm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">read_img_batch_from_video_gpu</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">end_frm</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">max_value</span><span class="o">=</span><span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">])</span>
        <span class="n">end_frm</span> <span class="o">=</span> <span class="n">end_frm</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">end_frm</span> <span class="o">=</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;frame_count&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span> <span class="o">=</span> <span class="n">start_frm</span> <span class="o">/</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">],</span> <span class="n">end_frm</span> <span class="o">/</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">]</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="n">frame_width</span> <span class="o">=</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span>
    <span class="n">frame_height</span> <span class="o">=</span> <span class="n">video_meta_data</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>
    <span class="n">frame_size</span> <span class="o">=</span> <span class="n">frame_width</span> <span class="o">*</span> <span class="n">frame_height</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="n">color_format</span> <span class="o">=</span> <span class="s1">&#39;bgr24&#39;</span>
    <span class="n">ffmpeg_cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ffmpeg&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;-hwaccel&#39;</span><span class="p">,</span> <span class="s1">&#39;cuda&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;-ss&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">start_time</span><span class="si">:</span><span class="s1">.10f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="n">video_path</span><span class="p">,</span>
                  <span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s1">.10f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;rawvideo&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;-pix_fmt&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">color_format</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;-&#39;</span><span class="p">]</span>


    <span class="n">ffmpeg_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">ffmpeg_cmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">out_format</span> <span class="o">==</span> <span class="s1">&#39;dict&#39;</span><span class="p">:</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">end_frm</span><span class="o">-</span><span class="n">start_frm</span><span class="p">,</span> <span class="n">frame_height</span><span class="p">,</span> <span class="n">frame_width</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">frm_cnt</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">start_frm</span><span class="p">)</span>
    <span class="n">video_name</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">video_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">iteration_frm_cnt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">frm_cnt</span> <span class="o">&lt;</span> <span class="n">end_frm</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reading frame </span><span class="si">{</span><span class="n">frm_cnt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> / </span><span class="si">{</span><span class="n">end_frm</span><span class="si">}</span><span class="s1"> ... (</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="n">raw_frame</span> <span class="o">=</span> <span class="n">ffmpeg_process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">frame_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_frame</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">color_format</span> <span class="o">==</span> <span class="s1">&#39;bgr24&#39;</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">raw_frame</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">frame_height</span><span class="p">,</span> <span class="n">frame_width</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">raw_frame</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">frame_height</span><span class="p">,</span> <span class="n">frame_width</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">out_format</span> <span class="o">==</span> <span class="s1">&#39;dict&#39;</span><span class="p">:</span>
            <span class="n">frames</span><span class="p">[</span><span class="n">frm_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">img</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frames</span><span class="p">[</span><span class="n">iteration_frm_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">img</span>
        <span class="n">frm_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">iteration_frm_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">greyscale</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">out_format</span> <span class="o">==</span> <span class="s1">&#39;dict&#39;</span><span class="p">:</span>
            <span class="n">greyscale_imgs</span> <span class="o">=</span> <span class="n">img_stack_to_greyscale</span><span class="p">(</span><span class="n">imgs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">frames</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start_frm</span><span class="p">,</span> <span class="n">end_frm</span><span class="p">)):</span>
                <span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">greyscale_imgs</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frames</span> <span class="o">=</span> <span class="n">img_stack_to_greyscale</span><span class="p">(</span><span class="n">imgs</span><span class="o">=</span><span class="n">frames</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">frames</span></div>


<div class="viewcode-block" id="find_largest_blob_location"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.find_largest_blob_location">[docs]</a><span class="k">def</span> <span class="nf">find_largest_blob_location</span><span class="p">(</span><span class="n">imgs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">video_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>



    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">frm_idx</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imgs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">video_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Finding blob in image </span><span class="si">{</span><span class="n">frm_idx</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Finding blob in image </span><span class="si">{</span><span class="n">frm_idx</span><span class="si">}</span><span class="s1"> (Video </span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">)...&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">num_labels</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">centroids</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_labels</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">frm_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">largest_blob_label</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CC_STAT_AREA</span><span class="p">])</span>
                <span class="n">results</span><span class="p">[</span><span class="n">frm_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">centroids</span><span class="p">[</span><span class="n">largest_blob_label</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="n">frm_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">results</span></div>



<div class="viewcode-block" id="bento_file_reader"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.bento_file_reader">[docs]</a><span class="k">def</span> <span class="nf">bento_file_reader</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                      <span class="n">fps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">orient</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span>
                      <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">raise_error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">log_setting</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a BENTO annotation file and processes it into a dictionary of DataFrames, each representing a classified behavior.</span>
<span class="sd">    Optionally, the results can be saved to a specified path.</span>

<span class="sd">    The function handles both frame-based and second-based annotations, converting the latter to frame-based</span>
<span class="sd">    annotations if the frames-per-second (FPS) is provided or can be inferred from the file.</span>

<span class="sd">    :param Union[str, os.PathLike] file_path: Path to the BENTO annotation file.</span>
<span class="sd">    :param Optional[float] fps: Frames per second (FPS) for converting second-based annotations to frames. If not provided, the function  will attempt to infer FPS from the file. If FPS is required and cannot be inferred, an error is raised.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike]] save_path: Path to save the processed results as a pickle file. If None, results are returned instead of saved.</span>
<span class="sd">    :return: A dictionary where the keys are classifier names and the values are DataFrames with &#39;START&#39; and &#39;STOP&#39;  columns representing the start and stop frames of each behavior.</span>
<span class="sd">    :rtype: Dict[str, pd.DataFrame]</span>

<span class="sd">    :example:</span>
<span class="sd">    &gt;&gt;&gt; bento_file_reader(file_path=r&quot;C:\troubleshooting\bento_test\bento_files\20240812_crumpling3.annot&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_orient_columns_melt</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;START&#39;</span><span class="p">,</span> <span class="s1">&#39;STOP&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;BEHAVIOR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clf_name</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;EVENT&quot;</span><span class="p">,</span> <span class="s2">&quot;FRAME&quot;</span><span class="p">,</span> <span class="s1">&#39;BEHAVIOR&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;FRAME&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)[[</span><span class="s1">&#39;BEHAVIOR&#39;</span><span class="p">,</span> <span class="s2">&quot;EVENT&quot;</span><span class="p">,</span> <span class="s2">&quot;FRAME&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">bento_file_reader</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> orient&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">orient</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">fps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">bento_file_reader</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> fps&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">video_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pat</span><span class="o">=</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">raise_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoDataError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> is not a valid BENTO file. See the docs for expected file format.&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">bento_file_reader</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ThirdPartyAnnotationsInvalidFileFormatWarning</span><span class="p">(</span><span class="n">annotation_app</span><span class="o">=</span><span class="s2">&quot;BENTO&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">bento_file_reader</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">log_status</span><span class="o">=</span><span class="n">log_setting</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">results</span>
    <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
    <span class="n">idx_mod</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">idx</span> <span class="o">+</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">clf_dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx_mod</span><span class="p">[</span><span class="n">n</span><span class="p">]:</span><span class="n">idx_mod</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_mod</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">clf_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clf_dfs</span><span class="p">)):</span>
        <span class="n">clf_df</span> <span class="o">=</span> <span class="n">clf_dfs</span><span class="p">[</span><span class="n">clf_idx</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">clf_name</span> <span class="o">=</span> <span class="n">clf_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">clf_df</span> <span class="o">=</span> <span class="n">clf_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">out_clf_df</span> <span class="o">=</span> <span class="n">clf_df</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out_clf_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">raise_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidFileTypeError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;SimBA found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">out_clf_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s1"> columns for file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> and classifier </span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1"> when trying to split the data by tabs.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ThirdPartyAnnotationsInvalidFileFormatWarning</span><span class="p">(</span><span class="n">annotation_app</span><span class="o">=</span><span class="s2">&quot;BENTO&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">bento_file_reader</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">log_status</span><span class="o">=</span><span class="n">log_setting</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">results</span>
        <span class="n">numeric_check</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">out_clf_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()))</span>
        <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">numeric_check</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">raise_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;SimBA found values in the annotation data for behavior </span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1"> in file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> that could not be interpreted as numeric values (seconds or frame numbers)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ThirdPartyAnnotationsInvalidFileFormatWarning</span><span class="p">(</span><span class="n">annotation_app</span><span class="o">=</span><span class="s2">&quot;BENTO&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">bento_file_reader</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">log_status</span><span class="o">=</span><span class="n">log_setting</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">results</span>
        <span class="n">out_clf_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;START&#39;</span><span class="p">,</span> <span class="s1">&#39;STOP&#39;</span><span class="p">,</span> <span class="s1">&#39;DURATION&#39;</span><span class="p">]</span>
        <span class="n">out_clf_df</span> <span class="o">=</span> <span class="n">out_clf_df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">int_check</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">out_clf_df</span><span class="p">,</span> <span class="n">out_clf_df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">int_check</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">orient</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">clf_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">out_clf_df</span><span class="p">[[</span><span class="s1">&#39;START&#39;</span><span class="p">,</span> <span class="s1">&#39;STOP&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">clf_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_orient_columns_melt</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">out_clf_df</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">fps_idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pat</span><span class="o">=</span><span class="s1">&#39;Annotation framerate&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">fps_str</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">fps_idx</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">fps_idx</span><span class="p">])][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">fps</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fps_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">FrameRangeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The annotations are in seconds and FPS was not passed. FPS could also not be read from the BENTO file&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">bento_file_reader</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="n">out_clf_df</span><span class="p">[</span><span class="s2">&quot;START&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out_clf_df</span><span class="p">[</span><span class="s2">&quot;START&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">fps</span>
            <span class="n">out_clf_df</span><span class="p">[</span><span class="s2">&quot;STOP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out_clf_df</span><span class="p">[</span><span class="s2">&quot;STOP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">fps</span>
            <span class="k">if</span> <span class="n">orient</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">clf_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">out_clf_df</span><span class="p">[[</span><span class="s1">&#39;START&#39;</span><span class="p">,</span> <span class="s1">&#39;STOP&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">clf_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_orient_columns_melt</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">out_clf_df</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">results</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">write_pickle</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">_is_new_boris_version</span><span class="p">(</span><span class="n">pd_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check the format of a boris annotation file.</span>

<span class="sd">    In the new version, additional column names are present, while</span>
<span class="sd">    others have slightly different name. Here, we check for the presence</span>
<span class="sd">    of a column name present only in the newer version.</span>

<span class="sd">    :return: True if newer version</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;Media file name&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pd_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<div class="viewcode-block" id="read_boris_file"><a class="viewcode-back" href="../../../simba.utils.html#simba.utils.read_write.read_boris_file">[docs]</a><span class="k">def</span> <span class="nf">read_boris_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                    <span class="n">fps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">orient</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span>
                    <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">raise_error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">log_setting</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a BORIS behavioral annotation file, processes the data, and optionally saves the results to a file.</span>

<span class="sd">    :param Union[str, os.PathLike] file_path: The path to the BORIS file to be read. The file should be a CSV containing behavioral annotations.</span>
<span class="sd">    :param Optional[Union[int, float]] fps: Frames per second (FPS) to convert time annotations into frame numbers. If not provided, it will be extracted from the BORIS file if available.</span>
<span class="sd">    :param Optional[Literal[&#39;index&#39;, &#39;columns&#39;]] orient: Determines the orientation of the results. &#39;index&#39; will organize data with start and stop times as indices, while &#39;columns&#39; will store data in columns.</span>
<span class="sd">    :param Optional[Union[str, os.PathLike] save_path: The path where the processed results should be saved as a pickle file. If not provided, the results will be returned instead.</span>
<span class="sd">    :param Optional[bool] raise_error: Whether to raise errors if the file format or content is invalid. If False, warnings will be logged instead of raising exceptions.</span>
<span class="sd">    :param Optional[bool] log_setting: Whether to log warnings and errors.  This is relevant when `raise_error` is set to False.</span>
<span class="sd">    :return: If `save_path` is None, returns a dictionary where keys are behaviors and values are dataframes  containing start and stop frames for each behavior. If `save_path` is provided, the results are saved and nothing is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">MEDIA_FILE_NAME</span> <span class="o">=</span> <span class="s2">&quot;Media file name&quot;</span>
    <span class="n">BEHAVIOR_TYPE</span> <span class="o">=</span> <span class="s1">&#39;Behavior type&#39;</span>
    <span class="n">OBSERVATION_ID</span> <span class="o">=</span> <span class="s2">&quot;Observation id&quot;</span>
    <span class="n">TIME</span> <span class="o">=</span> <span class="s2">&quot;Time&quot;</span>
    <span class="n">FPS</span> <span class="o">=</span> <span class="s1">&#39;FPS&#39;</span>
    <span class="n">EVENT</span> <span class="o">=</span> <span class="s1">&#39;EVENT&#39;</span>
    <span class="n">BEHAVIOR</span> <span class="o">=</span> <span class="s2">&quot;Behavior&quot;</span>
    <span class="n">START</span> <span class="o">=</span> <span class="s1">&#39;START&#39;</span>
    <span class="n">FRAME</span> <span class="o">=</span> <span class="s1">&#39;FRAME&#39;</span>
    <span class="n">STOP</span> <span class="o">=</span> <span class="s1">&#39;STOP&#39;</span>
    <span class="n">STATUS</span> <span class="o">=</span> <span class="s2">&quot;Status&quot;</span>
    <span class="n">MEDIA_FILE_PATH</span> <span class="o">=</span> <span class="s2">&quot;Media file path&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">check_file_exist_and_readable</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_int</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">read_boris_file</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> fps&#39;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">fps</span><span class="p">)</span>
    <span class="n">check_str</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">read_boris_file</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> orient&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">orient</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_if_dir_exists</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">save_path</span><span class="p">))</span>
    <span class="n">boris_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_new_boris_version</span><span class="p">(</span><span class="n">boris_df</span><span class="p">):</span>
        <span class="n">expected_headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">TIME</span><span class="p">,</span> <span class="n">MEDIA_FILE_PATH</span><span class="p">,</span> <span class="n">BEHAVIOR</span><span class="p">,</span> <span class="n">STATUS</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">OBSERVATION_ID</span> <span class="ow">in</span> <span class="n">boris_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">raise_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidFileTypeError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> is not a valid BORIS file&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">read_boris_file</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ThirdPartyAnnotationsInvalidFileFormatWarning</span><span class="p">(</span><span class="n">annotation_app</span><span class="o">=</span><span class="s2">&quot;BORIS&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">read_boris_file</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">log_status</span><span class="o">=</span><span class="n">log_setting</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">results</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="n">boris_df</span><span class="p">[</span><span class="n">boris_df</span><span class="p">[</span><span class="n">OBSERVATION_ID</span><span class="p">]</span> <span class="o">==</span> <span class="n">TIME</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">start_idx</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">raise_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidFileTypeError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> is not a valid BORIS file&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">read_boris_file</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ThirdPartyAnnotationsInvalidFileFormatWarning</span><span class="p">(</span><span class="n">annotation_app</span><span class="o">=</span><span class="s2">&quot;BORIS&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">read_boris_file</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">log_status</span><span class="o">=</span><span class="n">log_setting</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">results</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">MEDIA_FILE_PATH</span><span class="p">,</span> <span class="n">STATUS</span> <span class="o">=</span> <span class="n">MEDIA_FILE_NAME</span><span class="p">,</span> <span class="n">BEHAVIOR_TYPE</span>
        <span class="n">expected_headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">TIME</span><span class="p">,</span> <span class="n">MEDIA_FILE_PATH</span><span class="p">,</span> <span class="n">BEHAVIOR</span><span class="p">,</span> <span class="n">STATUS</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">check_valid_dataframe</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">read_boris_file</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">required_fields</span><span class="o">=</span><span class="n">expected_headers</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">video_base_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_fn_ext</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">MEDIA_FILE_PATH</span><span class="p">])</span>
    <span class="n">numeric_check</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">TIME</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">numeric_check</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">raise_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;SimBA found TIME DATA annotation in file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> that could not be interpreted as numeric values (seconds or frame numbers)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ThirdPartyAnnotationsInvalidFileFormatWarning</span><span class="p">(</span><span class="n">annotation_app</span><span class="o">=</span><span class="s2">&quot;BORIS&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">read_boris_file</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">log_status</span><span class="o">=</span><span class="n">log_setting</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">results</span>
    <span class="n">df</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">fps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">FPS</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">raise_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FrameRangeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The annotations are in seconds and FPS was not passed. FPS could also not be read from the BORIS file&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">bento_file_reader</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ThirdPartyAnnotationsInvalidFileFormatWarning</span><span class="p">(</span><span class="n">annotation_app</span><span class="o">=</span><span class="s2">&quot;BORIS&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">read_boris_file</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">log_status</span><span class="o">=</span><span class="n">log_setting</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">results</span>
        <span class="n">fps</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">FPS</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fps</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">raise_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FrameRangeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The annotations are in seconds and FPS was not passed. FPS could also not be read from the BORIS file&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">bento_file_reader</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ThirdPartyAnnotationsInvalidFileFormatWarning</span><span class="p">(</span><span class="n">annotation_app</span><span class="o">=</span><span class="s2">&quot;BORIS&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">read_boris_file</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">log_status</span><span class="o">=</span><span class="n">log_setting</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">results</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">expected_headers</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;FRAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">TIME</span><span class="p">,</span> <span class="n">MEDIA_FILE_PATH</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">BEHAVIOR</span><span class="p">:</span> <span class="s1">&#39;BEHAVIOR&#39;</span><span class="p">,</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">EVENT</span><span class="p">})</span>

    <span class="k">for</span> <span class="n">clf</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;BEHAVIOR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">clf_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;BEHAVIOR&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">clf</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">orient</span> <span class="o">==</span> <span class="s1">&#39;column&#39;</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">clf</span><span class="p">]</span> <span class="o">=</span> <span class="n">clf_df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_clf</span><span class="p">,</span> <span class="n">stop_clf</span> <span class="o">=</span> <span class="n">clf_df</span><span class="p">[</span><span class="n">clf_df</span><span class="p">[</span><span class="n">EVENT</span><span class="p">]</span> <span class="o">==</span> <span class="n">START</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">clf_df</span><span class="p">[</span><span class="n">clf_df</span><span class="p">[</span><span class="n">EVENT</span><span class="p">]</span> <span class="o">==</span> <span class="n">STOP</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">start_clf</span> <span class="o">=</span> <span class="n">start_clf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">FRAME</span><span class="p">:</span> <span class="n">START</span><span class="p">})</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">EVENT</span><span class="p">,</span> <span class="s1">&#39;BEHAVIOR&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">stop_clf</span> <span class="o">=</span> <span class="n">stop_clf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">FRAME</span><span class="p">:</span> <span class="n">STOP</span><span class="p">})</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">EVENT</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">start_clf</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stop_clf</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">raise_error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">FrameRangeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;In file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">, the number of start events (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">start_clf</span><span class="p">)</span><span class="si">}</span><span class="s1">) and stop events (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stop_clf</span><span class="p">)</span><span class="si">}</span><span class="s1">) for behavior </span><span class="si">{</span><span class="n">clf</span><span class="si">}</span><span class="s1"> is not equal&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">bento_file_reader</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ThirdPartyAnnotationsInvalidFileFormatWarning</span><span class="p">(</span><span class="n">annotation_app</span><span class="o">=</span><span class="s2">&quot;BORIS&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">read_boris_file</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">log_status</span><span class="o">=</span><span class="n">log_setting</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">results</span>
            <span class="n">clf_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">start_clf</span><span class="p">,</span> <span class="n">stop_clf</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[[</span><span class="s1">&#39;BEHAVIOR&#39;</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">STOP</span><span class="p">]]</span>
            <span class="n">results</span><span class="p">[</span><span class="n">clf</span><span class="p">]</span> <span class="o">=</span> <span class="n">clf_df</span>
    <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">results</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">write_pickle</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, sronilsson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>